<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=../../../../assets/favicon.png rel=icon><meta content="mkdocs-1.3.1, mkdocs-material-8.3.9" name=generator><title>Secret - Tech Learning</title><link href=../../../../assets/stylesheets/main.1d29e8d0.min.css rel=stylesheet><link href=../../../../assets/stylesheets/palette.cbb835fc.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>html.glightbox-open { overflow: initial; height: 100%; }</style><script src=../../../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent=red data-md-color-primary=indigo data-md-color-scheme=default dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#secret> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Tech Learning" class="md-header__button md-logo" data-md-component=logo href=../../../.. title="Tech Learning"> <svg viewbox="0 0 89 89" xmlns=http://www.w3.org/2000/svg> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z></path> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"></path> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z></path> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"></path> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tech Learning </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Secret </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=red data-md-color-media data-md-color-primary=indigo data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=brown data-md-color-scheme=slate id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <a aria-label=Share class="md-search__icon md-icon" data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg> </a> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a class=md-tabs__link href=../../../..> Home </a> </li> <li class=md-tabs__item> <a href=../../../../coding/dotnet/backend/base/web-api-base/ class=md-tabs__link> Coding </a> </li> <li class=md-tabs__item> <a href=../../../01-getting-started/learning-env/k3d/k3s-kubernetes-cluster-setup-with-k3d/ class="md-tabs__link md-tabs__link--active"> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../../prometheus/prometheus/overview/ class=md-tabs__link> Prometheus </a> </li> <li class=md-tabs__item> <a href=../../../../argocd/tutorial/ class=md-tabs__link> ArgoCD </a> </li> <li class=md-tabs__item> <a href=../../../../vault/docs/auth/overview/ class=md-tabs__link> Vault </a> </li> <li class=md-tabs__item> <a href=../../../../ansible/vagrant-intro/ class=md-tabs__link> Ansible </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Tech Learning" class="md-nav__button md-logo" data-md-component=logo href=../../../.. title="Tech Learning"> <svg viewbox="0 0 89 89" xmlns=http://www.w3.org/2000/svg> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z></path> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"></path> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z></path> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"></path> </svg> </a> Tech Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 id=__nav_1 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../..>Home</a> <label for=__nav_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label=Home class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 id=__nav_1_2 type=checkbox> <label class=md-nav__link for=__nav_1_2> Networking Basics <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Networking Basics" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Networking Basics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../networking/cidr/cidr-intro/ class=md-nav__link> 無類別區隔路由 CIDR </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_3 id=__nav_1_3 type=checkbox> <label class=md-nav__link for=__nav_1_3> YAML <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=YAML class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> YAML </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../yaml/yaml-intro/ class=md-nav__link> YAML 入門教程 </a> </li> <li class=md-nav__item> <a href=../../../../yaml/yaml-tutorial/ class=md-nav__link> Learn YAML </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_4 id=__nav_1_4 type=checkbox> <label class=md-nav__link for=__nav_1_4> CI/CD <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=CI/CD class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_4> <span class="md-nav__icon md-icon"></span> CI/CD </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cicd/gitops/ class=md-nav__link> GitOps 的概念 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2> Coding <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Coding class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1 id=__nav_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_1> C# <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=C# class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> C# </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_1 id=__nav_2_1_1 type=checkbox> <label class=md-nav__link for=__nav_2_1_1> 後端 API <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="後端 API" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_1_1> <span class="md-nav__icon md-icon"></span> 後端 API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../coding/dotnet/backend/base/web-api-base/ class=md-nav__link> 使用 ASP.NET Core 創建 Web API </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 id=__nav_3 type=checkbox> <label class=md-nav__link for=__nav_3> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Kubernetes class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 id=__nav_3_1 type=checkbox> <label class=md-nav__link for=__nav_3_1> Getting started <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Getting started" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Getting started </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1_1 id=__nav_3_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_1_1> 學習環境 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=學習環境 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> 學習環境 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1_1_1 id=__nav_3_1_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_1_1_1> K3D <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=K3D class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_1_1_1> <span class="md-nav__icon md-icon"></span> K3D </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../01-getting-started/learning-env/k3d/k3s-kubernetes-cluster-setup-with-k3d/ class=md-nav__link> 使用 K3D 設置 Kubernetes 集群 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1_1_2 id=__nav_3_1_1_2 type=checkbox> <label class=md-nav__link for=__nav_3_1_1_2> Minikube <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Minikube class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_1_1_2> <span class="md-nav__icon md-icon"></span> Minikube </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../01-getting-started/learning-env/minikube/how-to-install-minikube-on-ubuntu/ class=md-nav__link> 如何在 Ubuntu 20.04 上安裝 Minikube </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 id=__nav_3_2 type=checkbox> <label class=md-nav__link for=__nav_3_2> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Concepts class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_1 id=__nav_3_2_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1> 概述 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=概述 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> 概述 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01-overview/k8s-intro/ class=md-nav__link> K8S 介詔 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_2 id=__nav_3_2_2 type=checkbox> <label class=md-nav__link for=__nav_3_2_2> Kubernetes 架構 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Kubernetes 架構" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> Kubernetes 架構 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../02-cluster-architecture/k8s-architecture/ class=md-nav__link> K8S 架構解析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_3 id=__nav_3_2_3 type=checkbox> <label class=md-nav__link for=__nav_3_2_3> Serivce, 負載均衡與網路 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Serivce, 負載均衡與網路" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> Serivce, 負載均衡與網路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../05-svc-lb-network/k8s-network-intro/ class=md-nav__link> K8S 網絡通信介紹 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_4 id=__nav_3_2_4 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../06-storage/ >存儲</a> </div> <nav aria-label=存儲 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_2_4> <span class="md-nav__icon md-icon"></span> 存儲 </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_5 id=__nav_3_2_5 type=checkbox> <label class=md-nav__link for=__nav_3_2_5> 配置 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=配置 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_2_5> <span class="md-nav__icon md-icon"></span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> 配置最佳實踐 </a> </li> <li class=md-nav__item> <a href=../configmap/ class=md-nav__link> ConfigMap </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> Secret <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Secret </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#secret_1> Secret 的使用 </a> <nav aria-label="Secret 的使用" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#secret_2> Secret 的替代方案 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_3> 使用 Secret </a> <nav aria-label="使用 Secret" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#secret_4> 創建 Secret </a> <nav aria-label="創建 Secret" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#secret_5> 對 Secret 名稱與數據的約束 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#_1> 尺寸限制 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_6> 編輯 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_7> 使用 Secret </a> <nav aria-label="使用 Secret" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#optional-secret> 可選的(Optional) Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pod-secret> 在 Pod 中以文件形式使用 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_8> 將 Secret 鍵投射到特定目錄 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_9> Secret 文件的訪問權限 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_10> 使用來自卷中的 Secret 值 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_11> 掛載的 Secret 是被自動更新的 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_12> 以環境變量的方式使用 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#_2> 非法環境變量 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_13> 通過環境變量使用 Secret 值 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_14> 容器鏡像拉取 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pod-secret_1> 在靜態 Pod 中使用 Secret </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#_3> 使用場景 </a> <nav aria-label=使用場景 class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#_4> 使用場景：作為容器環境變量 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#ssh-pod> 使用場景：帶 SSH 密鑰的 Pod </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pod> 使用場景：帶有生產、測試環境憑據的 Pod </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_15> 使用場景：在 Secret 卷中帶句點的文件 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pod-secret_2> 使用場景：僅對 Pod 中一個容器可見的 Secret </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_16> Secret 的類型 </a> <nav aria-label="Secret 的類型" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#opaque-secret> Opaque Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_17> 服務賬號令牌 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#docker-secret> Docker 配置 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_18> 基本身份認證 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#ssh-secret> SSH 身份認證 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#tls-secret> TLS Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_19> 啟動引導令牌 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_20> 不可更改的 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_21> 將 Secret 標記為不可更改 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_22> Secret 的信息安全問題 </a> <nav aria-label="Secret 的信息安全問題" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#_5> 針對開發人員的安全性建議 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#_6> 針對集群管理員的安全性建議 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_6 id=__nav_3_2_6 type=checkbox> <label class=md-nav__link for=__nav_3_2_6> 集群管理 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=集群管理 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_2_6> <span class="md-nav__icon md-icon"></span> 集群管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../11-cluster-adm/logging/ class=md-nav__link> 日誌架構 </a> </li> <li class=md-nav__item> <a href=../../11-cluster-adm/kubernetes-logging/ class=md-nav__link> 日誌完整指南 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 id=__nav_3_3 type=checkbox> <label class=md-nav__link for=__nav_3_3> Tasks <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Tasks class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Tasks </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_1 id=__nav_3_3_1 type=checkbox> <label class=md-nav__link for=__nav_3_3_1> 管理 Kubernetes 对象 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="管理 Kubernetes 对象" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_3_1> <span class="md-nav__icon md-icon"></span> 管理 Kubernetes 对象 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../03-tasks/manage-kubernetes-objects/kustomization/ class=md-nav__link> 使用 Kustomize 對 Kubernetes 對象進行聲明式管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_2 id=__nav_3_3_2 type=checkbox> <label class=md-nav__link for=__nav_3_3_2> 監控、日誌和除錯 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=監控、日誌和除錯 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> 監控、日誌和除錯 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_2_1 id=__nav_3_3_2_1 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../03-tasks/debug/debug-application/ >應用程序故障排查</a> </div> <nav aria-label=應用程序故障排查 class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_3_2_1> <span class="md-nav__icon md-icon"></span> 應用程序故障排查 </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3_2_2 id=__nav_3_3_2_2 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../03-tasks/debug/debug-cluster/ >集群故障排查</a> </div> <nav aria-label=集群故障排查 class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_3_2_2> <span class="md-nav__icon md-icon"></span> 集群故障排查 </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 id=__nav_3_4 type=checkbox> <label class=md-nav__link for=__nav_3_4> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Tutorials class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../04-tutorials/hello-k3d/ class=md-nav__link> 你好, K3D </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4_2 id=__nav_3_4_2 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../04-tutorials/kubernetes-basics/ >學習 Kubernetes 基礎知識</a> <label for=__nav_3_4_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label="學習 Kubernetes 基礎知識" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_4_2> <span class="md-nav__icon md-icon"></span> 學習 Kubernetes 基礎知識 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/create-cluster/ class=md-nav__link> 創建集群 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/deploy-app/ class=md-nav__link> 部署應用 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/explore/ class=md-nav__link> 了解應用 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/expose/ class=md-nav__link> 公開曝露應用 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/scale/ class=md-nav__link> 縮放你的應用 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/update/ class=md-nav__link> 更新你的應用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4_3 id=__nav_3_4_3 type=checkbox> <label class=md-nav__link for=__nav_3_4_3> 配置 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=配置 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_4_3> <span class="md-nav__icon md-icon"></span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../04-tutorials/configuration/configmap-secrets/ class=md-nav__link> ConfigMap 與 Secret </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4_4 id=__nav_3_4_4 type=checkbox> <label class=md-nav__link for=__nav_3_4_4> 存儲 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=存儲 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_4_4> <span class="md-nav__icon md-icon"></span> 存儲 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../04-tutorials/volume/volume-pv-pvc/ class=md-nav__link> 存儲管理 volume、PV/PVC </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 id=__nav_3_5 type=checkbox> <label class=md-nav__link for=__nav_3_5> Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Reference class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_1 id=__nav_3_5_1 type=checkbox> <label class=md-nav__link for=__nav_3_5_1> API 概述 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="API 概述" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> API 概述 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../05-reference/using-api/working-with-k8s-api/ class=md-nav__link> 使用 K8S API </a> </li> <li class=md-nav__item> <a href=../../../05-reference/using-api/kubernetes-api-structure-and-terminology/ class=md-nav__link> K8S API 基礎 </a> </li> <li class=md-nav__item> <a href=../../../05-reference/using-api/kubernetes-api-call-simple-http-client/ class=md-nav__link> 用 HTTP 客戶端調用 K8S API </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_2 id=__nav_3_5_2 type=checkbox> <label class=md-nav__link for=__nav_3_5_2> API 存取權限控制 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="API 存取權限控制" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_5_2> <span class="md-nav__icon md-icon"></span> API 存取權限控制 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../05-reference/access-authn-authz/rbac-intro/ class=md-nav__link> Kubernetes RBAC 介詔 </a> </li> <li class=md-nav__item> <a href=../../../05-reference/access-authn-authz/k8s-authorization-of-sa-with-rbac/ class=md-nav__link> 使用 RBAC 設置服務帳戶權限 </a> </li> <li class=md-nav__item> <a href=../../../05-reference/access-authn-authz/k8s-sa-jwt-rbac/ class=md-nav__link> ServiceAccounts、JWT-tokens、身份驗證和 RBAC 授權 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 id=__nav_3_6 type=checkbox> <label class=md-nav__link for=__nav_3_6> Observability <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Observability class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Observability </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_1 id=__nav_3_6_1 type=checkbox> <label class=md-nav__link for=__nav_3_6_1> Day2 運營 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Day2 運營" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_6_1> <span class="md-nav__icon md-icon"></span> Day2 運營 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../observability/day2-ops/day2-definition/ class=md-nav__link> Day2 的定義 </a> </li> <li class=md-nav__item> <a href=../../../observability/day2-ops/day2-challenges/ class=md-nav__link> Day2 的挑戰 </a> </li> <li class=md-nav__item> <a href=../../../observability/day2-ops/k8s-day2-problem/ class=md-nav__link> Kubernetes Day2 運營 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_2 id=__nav_3_6_2 type=checkbox> <label class=md-nav__link for=__nav_3_6_2> 概念 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=概念 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> 概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../observability/concept/fullstack-monitoring/ class=md-nav__link> Kubernetes 可觀察性 </a> </li> <li class=md-nav__item> <a href=../../../observability/concept/kubernetes-observability-for-humans/ class=md-nav__link> 監控 Kubernetes 的挑戰 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_3 id=__nav_3_6_3 type=checkbox> <label class=md-nav__link for=__nav_3_6_3> Observability 學習指南 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Observability 學習指南" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_6_3> <span class="md-nav__icon md-icon"></span> Observability 學習指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../observability/concept/observability-prometheus-guide-part1/ class=md-nav__link> Part 1. 學習指南說明 </a> </li> <li class=md-nav__item> <a href=../../../observability/concept/observability-prometheus-guide-part2/ class=md-nav__link> Part 2. Prometheus, Alertmanager &amp; Grafana 架構介詔 </a> </li> <li class=md-nav__item> <a href=../../../observability/concept/observability-prometheus-guide-part3/ class=md-nav__link> Part 3. Prometheus &amp; Alertmanager 基本概念 </a> </li> <li class=md-nav__item> <a href=../../../observability/concept/observability-prometheus-guide-part4/ class=md-nav__link> Part 4. PromQL 介詔 </a> </li> <li class=md-nav__item> <a href=../../../observability/concept/observability-prometheus-guide-part5/ class=md-nav__link> Part 5. Alerts 最佳實踐 </a> </li> <li class=md-nav__item> <a href=../../../observability/concept/observability-prometheus-guide-part6/ class=md-nav__link> Part 6. Kubernetes 中安裝設定 Prometheus 指南 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_4 id=__nav_3_6_4 type=checkbox> <label class=md-nav__link for=__nav_3_6_4> 日誌 Logging <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="日誌 Logging" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_6_4> <span class="md-nav__icon md-icon"></span> 日誌 Logging </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_4_1 id=__nav_3_6_4_1 type=checkbox> <label class=md-nav__link for=__nav_3_6_4_1> Loki <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Loki class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_6_4_1> <span class="md-nav__icon md-icon"></span> Loki </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../observability/logging/loki/logging-with-loki-and-plg/ class=md-nav__link> 使用 Loki 做為 Kubernetes 的日誌聚合亓件 </a> </li> <li class=md-nav__item> <a href=../../../observability/logging/loki/loki-nginx/ class=md-nav__link> 使用 Logging Operator 將 Nginx 日誌存儲在 Grafana Loki </a> </li> <li class=md-nav__item> <a href=../../../observability/logging/loki/loki-ql/ class=md-nav__link> Loki 查詢語言 LogQL </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_4_2 id=__nav_3_6_4_2 type=checkbox> <label class=md-nav__link for=__nav_3_6_4_2> Logging Operator <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Logging Operator" class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_6_4_2> <span class="md-nav__icon md-icon"></span> Logging Operator </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../observability/logging/operator/logging-operator/ class=md-nav__link> Logging Operator 日誌管理方案 </a> </li> <li class=md-nav__item> <a href=../../../observability/logging/operator/logging-operator-extensions/ class=md-nav__link> Logging Operator 的擴展 </a> </li> <li class=md-nav__item> <a href=../../../observability/logging/operator/rancher-logging-quickstart-01/ class=md-nav__link> Rancher 2.6 全新 Logging 快速入門 </a> </li> <li class=md-nav__item> <a href=../../../observability/logging/operator/rancher-logging-quickstart-02/ class=md-nav__link> Rancher 2.6 全新 Logging 快速入門(2) </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_5 id=__nav_3_6_5 type=checkbox> <label class=md-nav__link for=__nav_3_6_5> 指標 Metrics <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="指標 Metrics" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_6_5> <span class="md-nav__icon md-icon"></span> 指標 Metrics </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_5_1 id=__nav_3_6_5_1 type=checkbox> <label class=md-nav__link for=__nav_3_6_5_1> Prometheus Operator <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Prometheus Operator" class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_6_5_1> <span class="md-nav__icon md-icon"></span> Prometheus Operator </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../observability/metrics/kube-prometheus-stack/setup-prometheus-and-grafana-on-kubernetes/ class=md-nav__link> Prometheus-operator 介绍和配置解析 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_6 id=__nav_3_6_6 type=checkbox> <label class=md-nav__link for=__nav_3_6_6> 追踪 Traces <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="追踪 Traces" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_6_6> <span class="md-nav__icon md-icon"></span> 追踪 Traces </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_6_1 id=__nav_3_6_6_1 type=checkbox> <label class=md-nav__link for=__nav_3_6_6_1> 開發語言 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=開發語言 class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_6_6_1> <span class="md-nav__icon md-icon"></span> 開發語言 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_6_1_1 id=__nav_3_6_6_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_6_6_1_1> Java <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Java class=md-nav data-md-level=5> <label class=md-nav__title for=__nav_3_6_6_1_1> <span class="md-nav__icon md-icon"></span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../observability/tracing/java/spring-boot-opentelemetry/ class=md-nav__link> SpringBoot </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6_6_1_2 id=__nav_3_6_6_1_2 type=checkbox> <label class=md-nav__link for=__nav_3_6_6_1_2> Dotnet <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Dotnet class=md-nav data-md-level=5> <label class=md-nav__title for=__nav_3_6_6_1_2> <span class="md-nav__icon md-icon"></span> Dotnet </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../observability/tracing/dotnet/modern-monitoring-using-openTelemetry-with-Observability/ class=md-nav__link> 可觀測性(Observability) </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7 id=__nav_3_7 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../package/ >Tools</a> <label for=__nav_3_7> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label=Tools class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7_2 id=__nav_3_7_2 type=checkbox> <label class=md-nav__link for=__nav_3_7_2> Packaging 管理 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Packaging 管理" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_7_2> <span class="md-nav__icon md-icon"></span> Packaging 管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7_2_1 id=__nav_3_7_2_1 type=checkbox> <label class=md-nav__link for=__nav_3_7_2_1> Helm <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Helm class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_7_2_1> <span class="md-nav__icon md-icon"></span> Helm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../package/helm-intro/ class=md-nav__link> Helm 入門教學 </a> </li> <li class=md-nav__item> <a href=../../../package/helm-app-deploy/ class=md-nav__link> K8S 應用部署之 Helm 初探 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7_3 id=__nav_3_7_3 type=checkbox> <label class=md-nav__link for=__nav_3_7_3> Config 管理 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Config 管理" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_7_3> <span class="md-nav__icon md-icon"></span> Config 管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7_3_1 id=__nav_3_7_3_1 type=checkbox> <label class=md-nav__link for=__nav_3_7_3_1> Kustomize <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Kustomize class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_7_3_1> <span class="md-nav__icon md-icon"></span> Kustomize </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../package/helm-intro/ class=md-nav__link> Kustomize 入門教學 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4> Prometheus <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Prometheus class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Prometheus </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1 id=__nav_4_1 type=checkbox> <label class=md-nav__link for=__nav_4_1> 基礎 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=基礎 class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 基礎 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../prometheus/prometheus/overview/ class=md-nav__link> Prometheus 簡介 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/prometheus/install/ class=md-nav__link> Prometheus 安裝配置 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 id=__nav_4_2 type=checkbox> <label class=md-nav__link for=__nav_4_2> PromQL <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=PromQL class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> PromQL </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2_1 id=__nav_4_2_1 type=checkbox> <label class=md-nav__link for=__nav_4_2_1> 基礎 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=基礎 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_2_1> <span class="md-nav__icon md-icon"></span> 基礎 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../prometheus/promql/intro/ class=md-nav__link> PromQL 簡介 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/data-model/ class=md-nav__link> 數據模型 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/metric-type/ class=md-nav__link> 指標類型 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/demo-service/ class=md-nav__link> 演示服務 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2_2 id=__nav_4_2_2 type=checkbox> <label class=md-nav__link for=__nav_4_2_2> 查詢 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=查詢 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_2_2> <span class="md-nav__icon md-icon"></span> 查詢 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../prometheus/promql/theory/ class=md-nav__link> 查詢基礎 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/select-series/ class=md-nav__link> 選擇時間序列 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/rates/ class=md-nav__link> 變化率 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/aggregate/ class=md-nav__link> 聚合 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/operate/ class=md-nav__link> 運算 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/threshold/ class=md-nav__link> 閾值 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/set/ class=md-nav__link> 集合操作 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/sort/ class=md-nav__link> 排序 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/histograms/ class=md-nav__link> 直方圖 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/compare/ class=md-nav__link> 數據對比 </a> </li> <li class=md-nav__item> <a href=../../../../prometheus/promql/check/ class=md-nav__link> 檢測 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 id=__nav_5 type=checkbox> <label class=md-nav__link for=__nav_5> ArgoCD <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=ArgoCD class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> ArgoCD </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_1 id=__nav_5_1 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../../argocd/tutorial/ >ArgoCD 教程</a> <label for=__nav_5_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label="ArgoCD 教程" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> ArgoCD 教程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../argocd/tutorial/01-setup/ class=md-nav__link> ArgoCD 安裝設定 </a> </li> <li class=md-nav__item> <a href=../../../../argocd/tutorial/02-getting_started/ class=md-nav__link> ArgoCD 入門 </a> </li> <li class=md-nav__item> <a href=../../../../argocd/tutorial/03-kustomize/ class=md-nav__link> Kustomize </a> </li> <li class=md-nav__item> <a href=../../../../argocd/tutorial/04-syncwaves-hooks/ class=md-nav__link> SyncWaves 與 Hooks </a> </li> <li class=md-nav__item> <a href=../../../../argocd/tutorial/argo-cd-applicationset-controller/ class=md-nav__link> ApplicationSet 控制器 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_2 id=__nav_5_2 type=checkbox> <label class=md-nav__link for=__nav_5_2> ArgoCD 插件 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="ArgoCD 插件" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> ArgoCD 插件 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../argocd/argocd-vault-plugin/secret-management-argocd-vault/ class=md-nav__link> 使用 Argo CD Vault 插件進行 Secret 管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_3 id=__nav_5_3 type=checkbox> <label class=md-nav__link for=__nav_5_3> ApplicationSet Controller <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="ApplicationSet Controller" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> ApplicationSet Controller </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../argocd/applicationset/intro/ class=md-nav__link> 簡介 </a> </li> <li class=md-nav__item> <a href=../../../../argocd/applicationset/use-cases/ class=md-nav__link> 用例 </a> </li> <li class=md-nav__item> <a href=../../../../argocd/applicationset/argo-cd-integration/ class=md-nav__link> ApplicationSet 控制器與 Argo CD 整合 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_3_4 id=__nav_5_3_4 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../../argocd/applicationset/generators/ >Generator 生成器</a> <label for=__nav_5_3_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label="Generator 生成器" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_5_3_4> <span class="md-nav__icon md-icon"></span> Generator 生成器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../argocd/applicationset/generators/generators-list/ class=md-nav__link> List Generator </a> </li> <li class=md-nav__item> <a href=../../../../argocd/applicationset/generators/generators-cluster/ class=md-nav__link> Cluster Generator </a> </li> <li class=md-nav__item> <a href=../../../../argocd/applicationset/generators/generators-git/ class=md-nav__link> Git Generator </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../argocd/applicationset/template/ class=md-nav__link> 範本 fields </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 id=__nav_6 type=checkbox> <label class=md-nav__link for=__nav_6> Vault <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Vault class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Vault </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_1 id=__nav_6_1 type=checkbox> <label class=md-nav__link for=__nav_6_1> Docs <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Docs class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_1_1 id=__nav_6_1_1 type=checkbox> <label class=md-nav__link for=__nav_6_1_1> Auth Methods <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Auth Methods" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_6_1_1> <span class="md-nav__icon md-icon"></span> Auth Methods </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../vault/docs/auth/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../../vault/docs/auth/kubernetes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../../vault/docs/auth/userpass/ class=md-nav__link> Username &amp; Password </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_1_2 id=__nav_6_1_2 type=checkbox> <label class=md-nav__link for=__nav_6_1_2> Platform <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Platform class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_6_1_2> <span class="md-nav__icon md-icon"></span> Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_1_2_1 id=__nav_6_1_2_1 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../../vault/docs/platform/ >Kubernetes</a> <label for=__nav_6_1_2_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label=Kubernetes class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_6_1_2_1> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_1_2_1_2 id=__nav_6_1_2_1_2 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../../vault/docs/platform/helm/ >Helm</a> </div> <nav aria-label=Helm class=md-nav data-md-level=5> <label class=md-nav__title for=__nav_6_1_2_1_2> <span class="md-nav__icon md-icon"></span> Helm </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_2 id=__nav_6_2 type=checkbox> <label class=md-nav__link for=__nav_6_2> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Tutorials class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_2_1 id=__nav_6_2_1 type=checkbox> <label class=md-nav__link for=__nav_6_2_1> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Kubernetes class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_6_2_1> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../vault/kubernetes/kubernetes-sidecar/ class=md-nav__link> 通過 Vault Agent 容器將 Secret 注入 Kubernetes Pod </a> </li> <li class=md-nav__item> <a href=../../../../vault/kubernetes/kubernetes-secret-store-driver/ class=md-nav__link> 通過容器存儲接口 (CSI) 掛載 Vault Secret </a> </li> <li class=md-nav__item> <a href=../../../../vault/kubernetes/agent-kubernetes/ class=md-nav__link> Vault Agent 與 Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../../vault/kubernetes/kubernetes-external-vault/ class=md-nav__link> Kubernetes 與外部 Vault 整合 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 id=__nav_7 type=checkbox> <label class=md-nav__link for=__nav_7> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Ansible class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_1 id=__nav_7_1 type=checkbox> <label class=md-nav__link for=__nav_7_1> 快速入門 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=快速入門 class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> 快速入門 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ansible/vagrant-intro/ class=md-nav__link> Vagrant 快速入門 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/ansible-intro/ class=md-nav__link> Ansible 快速入門 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/use_sshpass_to_login_for_ansible/ class=md-nav__link> Ansible 使用基於 SSH 密碼登入 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/ansible-cheatsheet/ class=md-nav__link> Ansible 使用指南 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_2 id=__nav_7_2 type=checkbox> <label class=md-nav__link for=__nav_7_2> Ansible Playbook 撰寫 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Ansible Playbook 撰寫" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Ansible Playbook 撰寫 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/creating-and-running-your-first-ansible-playbook/ class=md-nav__link> 如何創建與運行 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-define-tasks-in-ansible-playbooks/ class=md-nav__link> 如何定義任務 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-use-variables-in-ansible-playbooks/ class=md-nav__link> 如何使用變量 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-access-system-information-facts-in-ansible-playbooks/ class=md-nav__link> 如何訪問系統信息 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-use-conditionals-in-ansible-playbooks/ class=md-nav__link> 如何使用條件 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-use-loops-in-ansible-playbooks/ class=md-nav__link> 如何使用循環 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/understanding-privilege-escalation-in-ansible-playbooks/ class=md-nav__link> 了解權限提升 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-install-and-manage-system-packages-in-ansible-playbooks/ class=md-nav__link> 如何安裝和管理系統包 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-create-and-use-templates-in-ansible-playbooks/ class=md-nav__link> 如何創建和使用模板 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-define-and-use-handlers-in-ansible-playbooks/ class=md-nav__link> 如何定義和使用處理程序 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-deploy-a-static-html-website-with-ansible-on-ubuntu-20-04-nginx/ class=md-nav__link> 如何使用Nginx部署靜態HTML網站 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_3 id=__nav_7_3 type=checkbox> <label class=md-nav__link for=__nav_7_3> Ansible AWX 教學 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Ansible AWX 教學" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Ansible AWX 教學 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ansible/tutorial_awx/how-to-install-ansible-awx/ class=md-nav__link> 如何在 Ubuntu 20.04 上安裝 Ansible AWX </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_awx/ansible-awx-guide-basic-usage-and-configuration/ class=md-nav__link> Ansible AWX 基本使用和配置 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4 id=__nav_7_4 type=checkbox> <label class=md-nav__link for=__nav_7_4> 教學 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=教學 class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> 教學 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ansible/tutorial/ubuntu-insall-docker/ class=md-nav__link> 如何在 Ubuntu 20.04 上安裝 Docker </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial/ansible-install-docker/ class=md-nav__link> 如何使用 Ansible 在 Ubuntu 20.04 上安裝和設置 Docker </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial/how-to-install-and-configure-ansible-on-ubuntu-22-04/ class=md-nav__link> 如何在 Ubuntu 22.04 上安裝和配置 Ansible </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#secret_1> Secret 的使用 </a> <nav aria-label="Secret 的使用" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#secret_2> Secret 的替代方案 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_3> 使用 Secret </a> <nav aria-label="使用 Secret" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#secret_4> 創建 Secret </a> <nav aria-label="創建 Secret" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#secret_5> 對 Secret 名稱與數據的約束 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#_1> 尺寸限制 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_6> 編輯 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_7> 使用 Secret </a> <nav aria-label="使用 Secret" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#optional-secret> 可選的(Optional) Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pod-secret> 在 Pod 中以文件形式使用 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_8> 將 Secret 鍵投射到特定目錄 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_9> Secret 文件的訪問權限 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_10> 使用來自卷中的 Secret 值 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_11> 掛載的 Secret 是被自動更新的 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_12> 以環境變量的方式使用 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#_2> 非法環境變量 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_13> 通過環境變量使用 Secret 值 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_14> 容器鏡像拉取 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pod-secret_1> 在靜態 Pod 中使用 Secret </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#_3> 使用場景 </a> <nav aria-label=使用場景 class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#_4> 使用場景：作為容器環境變量 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#ssh-pod> 使用場景：帶 SSH 密鑰的 Pod </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pod> 使用場景：帶有生產、測試環境憑據的 Pod </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_15> 使用場景：在 Secret 卷中帶句點的文件 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pod-secret_2> 使用場景：僅對 Pod 中一個容器可見的 Secret </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_16> Secret 的類型 </a> <nav aria-label="Secret 的類型" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#opaque-secret> Opaque Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_17> 服務賬號令牌 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#docker-secret> Docker 配置 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_18> 基本身份認證 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#ssh-secret> SSH 身份認證 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#tls-secret> TLS Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_19> 啟動引導令牌 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_20> 不可更改的 Secret </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_21> 將 Secret 標記為不可更改 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#secret_22> Secret 的信息安全問題 </a> <nav aria-label="Secret 的信息安全問題" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#_5> 針對開發人員的安全性建議 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#_6> 針對集群管理員的安全性建議 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=secret>Secret<a class=headerlink href=#secret title="Permanent link">¶</a></h1> <p>Secret 是一種包含少量敏感信息例如密碼、令牌或密鑰的對象。這樣的信息可能會被放在 Pod 規約中或者鏡像中。使用 Secret 意味著你不需要在應用程序代碼中包含機密數據。</p> <p>由於創建 Secret 可以獨立於使用它們的 Pod， 因此在創建、查看和編輯 Pod 的工作流程中暴露 Secret（及其數據）的風險較小。 Kubernetes 和在集群中運行的應用程序也可以對 Secret 採取額外的預防措施， 例如避免將機密數據寫入非易失性存儲。</p> <p>Secret 類似於 ConfigMap 但專門用於保存機密數據。</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>注意： 默認情況下，Kubernetes Secret 未加密地存儲在 API 服務器的底層數據存儲（etcd）中。任何擁有 API 訪問權限的人都可以檢索或修改 Secret，任何有權訪問 etcd 的人也可以。此外，任何有權限在命名空間中創建 Pod 的人都可以使用該訪問權限讀取該命名空間中的任何 Secret； 這包括間接訪問，例如創建 Deployment 的能力。</p> <p>為了安全地使用 Secret，請至少執行以下步驟：</p> <ol> <li>為 Secret <a href=https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/encrypt-data/ >啟用靜態加密</a>；</li> <li><a href=https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authorization/ >啟用或配置 RBAC 規則</a>來限制讀取和寫入 Secret 的數據（包括通過間接方式）。需要注意的是，被准許創建 Pod 的人也隱式地被授權獲取 Secret 內容。</li> <li>在適當的情況下，還可以使用 RBAC 等機制來限制允許哪些主體創建新 Secret 或替換現有 Secret。</li> </ol> </div> <p>參見 <a href=https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/#information-security-for-secrets>Secret 的信息安全</a>了解詳情。</p> <h2 id=secret_1>Secret 的使用<a class=headerlink href=#secret_1 title="Permanent link">¶</a></h2> <p>Pod 可以用三種方式之一來使用 Secret：</p> <ul> <li>作為掛載到一個或多個容器上的捲 中的<a href=https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/#using-secrets-as-files-from-a-pod>文件</a>。</li> <li>作為<a href=https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/#using-secrets-as-environment-variables>容器的環境變量</a>。</li> <li>由 <a href=https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/#using-imagepullsecrets>kubelet 在為 Pod 拉取鏡像時使用</a>。</li> </ul> <p>Kubernetes 控制面也使用 Secret； 例如，<a href=https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/#bootstrap-token-secrets>引導令牌 Secret</a> 是一種幫助自動化節點註冊的機制。</p> <h3 id=secret_2>Secret 的替代方案<a class=headerlink href=#secret_2 title="Permanent link">¶</a></h3> <p>除了使用 Secret 來保護機密數據，你也可以選擇一些替代方案。</p> <p>下面是一些選項：</p> <ul> <li> <p>如果你的雲原生組件需要執行身份認證來訪問你所知道的、在同一 Kubernetes 集群中運行的另一個應用， 你可以使用 <a href=https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authentication/#service-account-tokens>ServiceAccount</a> 及其令牌來標識你的客戶端身份。</p> </li> <li> <p>你可以運行的第三方工具也有很多，這些工具可以運行在集群內或集群外，提供機密數據管理。例如，這一工具可能是 Pod 通過 HTTPS 訪問的一個服務，該服務在客戶端能夠正確地通過身份認證 （例如，通過 ServiceAccount 令牌）時，提供機密數據內容。</p> </li> <li> <p>就身份認證而言，你可以為 X.509 證書實現一個定制的簽名者，並使用 <a href=https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/certificate-signing-requests/ >CertificateSigningRequest</a> 來讓該簽名者為需要證書的 Pod 發放證書。</p> </li> <li> <p>你可以使用一個<a href=https://kubernetes.io/zh-cn/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/ >設備插件</a> 來將節點本地的加密硬件暴露給特定的 Pod。例如，你可以將可信任的 Pod 調度到提供可信平台模塊（Trusted Platform Module，TPM）的節點上。這類節點是另行配置的。</p> </li> </ul> <p>你還可以將如上選項的兩種或多種進行組合，包括直接使用 Secret 對象本身也是一種選項。</p> <p>例如：實現（或部署）一個 operator， 從外部服務取回生命期很短的會話令牌，之後基於這些生命期很短的會話令牌來創建 Secret。運行在集群中的 Pod 可以使用這些會話令牌，而 Operator 則確保這些令牌是合法的。這種責權分離意味著你可以運行那些不了解會話令牌如何發放與刷新的確切機制的 Pod。</p> <h2 id=secret_3>使用 Secret<a class=headerlink href=#secret_3 title="Permanent link">¶</a></h2> <h3 id=secret_4>創建 Secret<a class=headerlink href=#secret_4 title="Permanent link">¶</a></h3> <ul> <li><a href=https://kubernetes.io/zh-cn/docs/tasks/configmap-secret/managing-secret-using-kubectl/ >使用 kubectl 命令來創建 Secret</a></li> <li><a href=https://kubernetes.io/zh-cn/docs/tasks/configmap-secret/managing-secret-using-config-file/ >基於配置文件來創建 Secret</a></li> <li><a href=https://kubernetes.io/zh-cn/docs/tasks/configmap-secret/managing-secret-using-kustomize/ >使用 kustomize 來創建 Secret</a></li> </ul> <h4 id=secret_5>對 Secret 名稱與數據的約束<a class=headerlink href=#secret_5 title="Permanent link">¶</a></h4> <p>Secret 對象的名稱必須是合法的 <a href=https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/names#dns-subdomain-names>DNS 子域名</a>。</p> <p>在為創建 Secret 編寫配置文件時，你可以設置 <code>data</code> 與/或 <code>stringData</code> 字段。 <code>data</code> 和 <code>stringData</code> 字段都是可選的。 <code>data</code> 字段中所有鍵值都必須是 base64 編碼的字符串。如果不希望執行這種 base64 字符串的轉換操作，你可以選擇設置 <code>stringData</code> 字段，其中可以使用任何字符串作為其取值。</p> <p><code>data</code> 和 <code>stringData</code> 中的鍵名只能包含字母、數字、<code>-</code>、<code>_</code> 或 <code>.</code> 字符。 <code>stringData</code> 字段中的所有鍵值對都會在內部被合併到 <code>data</code> 字段中。如果某個主鍵同時出現在 <code>data</code> 和 <code>stringData</code> 字段中，<code>stringData</code> 所指定的鍵值具有高優先級。</p> <h4 id=_1>尺寸限制<a class=headerlink href=#_1 title="Permanent link">¶</a></h4> <p><mark class=critic>每個 Secret 的尺寸最多為 1 MiB</mark>。施加這一限制是為了避免用戶創建非常大的 Secret， 進而導致 API 服務器和 kubelet 內存耗盡。不過創建很多小的 Secret 也可能耗盡內存。你可以使用資源配額來約束每個名字空間中 Secret（或其他資源）的個數。</p> <h3 id=secret_6>編輯 Secret<a class=headerlink href=#secret_6 title="Permanent link">¶</a></h3> <p>你可以使用 kubectl 來編輯一個已有的 Secret：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>kubectl edit secrets mysecret
</code></pre></div> <p>這一命令會啟動你的默認編輯器，允許你更新 data 字段中存放的 base64 編碼的 Secret 值； 例如：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=c1># 請編輯以下對象。以 `#` 開頭的幾行將被忽略，</span><span class=w></span>
<a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a><span class=c1># 且空文件將放棄編輯。如果保存此文件時出錯，</span><span class=w></span>
<a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=c1># 則重新打開此文件時也會有相關故障。</span><span class=w></span>
<a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=nt>data</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>  </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">YWRtaW4=</span><span class=w></span>
<a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>  </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MWYyZDFlMmU2N2Rm</span><span class=w></span>
<a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-1-9 id=__codelineno-1-9 name=__codelineno-1-9></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-1-10 id=__codelineno-1-10 name=__codelineno-1-10></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-1-11 id=__codelineno-1-11 name=__codelineno-1-11></a><span class=w>    </span><span class=nt>kubectl.kubernetes.io/last-applied-configuration</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=w> </span><span class=nv>...</span><span class=w> </span><span class="p p-Indicator">}</span><span class=w></span>
<a href=#__codelineno-1-12 id=__codelineno-1-12 name=__codelineno-1-12></a><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2020-01-22T18:41:56Z</span><span class=w></span>
<a href=#__codelineno-1-13 id=__codelineno-1-13 name=__codelineno-1-13></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span><span class=w></span>
<a href=#__codelineno-1-14 id=__codelineno-1-14 name=__codelineno-1-14></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class=w></span>
<a href=#__codelineno-1-15 id=__codelineno-1-15 name=__codelineno-1-15></a><span class=w>  </span><span class=nt>resourceVersion</span><span class=p>:</span><span class=w> </span><span class=s>"164619"</span><span class=w></span>
<a href=#__codelineno-1-16 id=__codelineno-1-16 name=__codelineno-1-16></a><span class=w>  </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cfee02d6-c137-11e5-8d73-42010af00002</span><span class=w></span>
<a href=#__codelineno-1-17 id=__codelineno-1-17 name=__codelineno-1-17></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span><span class=w></span>
</code></pre></div> <p>這一示例清單定義了一個 Secret，其 <code>data</code> 字段中包含兩個主鍵：<code>username</code> 和 <code>password</code>。清單中的字段值是 Base64 字符串，不過，當你在 Pod 中使用 Secret 時，kubelet 為 Pod 及其中的容器提供的是 <strong>解碼</strong> 後的數據。</p> <p>你可以在一個 Secret 中打包多個主鍵和數值，也可以選擇使用多個 Secret， 完全取決於哪種方式最方便。</p> <h3 id=secret_7>使用 Secret<a class=headerlink href=#secret_7 title="Permanent link">¶</a></h3> <p>Secret 可以以數據卷的形式掛載，也可以作為環境變量 暴露給 Pod 中的容器使用。 Secret 也可用於系統中的其他部分，而不是一定要直接暴露給 Pod。例如，Secret 也可以包含系統中其他部分在替你與外部系統交互時要使用的憑證數據。</p> <p>Kubernetes 會檢查 Secret 的捲數據源，確保所指定的對象引用確實指向類型為 Secret 的對象。因此，如果 Pod 依賴於某 Secret，該 Secret 必須先於 Pod 被創建。</p> <p>如果 Secret 內容無法取回（可能因為 Secret 尚不存在或者臨時性地出現 API 服務器網絡連接問題），kubelet 會周期性地重試 Pod 運行操作。 kubelet 也會為該 Pod 報告 Event 事件，給出讀取 Secret 時遇到的問題細節。</p> <h4 id=optional-secret>可選的(Optional) Secret<a class=headerlink href=#optional-secret title="Permanent link">¶</a></h4> <p>當你定義一個基於 Secret 的環境變量時，你可以將其標記為可選。默認情況下，所引用的 Secret 都是必需的。</p> <p>只有所有非可選的 Secret 都可用時，Pod 中的容器才能啟動運行。</p> <p>如果 Pod 引用了 Secret 中的特定主鍵，而雖然 Secret 本身存在，對應的主鍵不存在， Pod 啟動也會失敗。</p> <h4 id=pod-secret>在 Pod 中以文件形式使用 Secret<a class=headerlink href=#pod-secret title="Permanent link">¶</a></h4> <p>如果你希望在 Pod 中訪問 Secret 內的數據，一種方式是讓 Kubernetes 將 Secret 以 Pod 中一個或多個容器的文件系統中的文件的形式呈現出來。</p> <p>要配置這種行為，你需要：</p> <ol> <li>創建一個 Secret 或者使用已有的 Secret。多個 Pod 可以引用同一個 Secret。</li> <li>更改 Pod 定義，在 <code>.spec.volumes[]</code> 下添加一個卷。根據需要為卷設置其名稱， 並將 <code>.spec.volumes[].secret.secretName</code> 字段設置為 Secret 對象的名稱。</li> <li>為每個需要該 Secret 的容器添加 <code>.spec.containers[].volumeMounts[]</code>。並將 <code>.spec.containers[].volumeMounts[].readOnly</code> 設置為 <code>true</code>， 將 <code>.spec.containers[].volumeMounts[].mountPath</code> 設置為希望 Secret 被放置的、目前尚未被使用的路徑名。</li> <li>更改你的鏡像或命令行，以便程序讀取所設置的目錄下的文件。 Secret 的 <code>data</code> 映射中的每個主鍵都成為 <code>mountPath</code> 下面的文件名。</li> </ol> <p>下面是一個通過卷來掛載名為 mysecret 的 Secret 的 Pod 示例：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class=w></span>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mypod</span><span class=w></span>
<a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mypod</span><span class=w></span>
<a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis</span><span class=w></span>
<a href=#__codelineno-2-9 id=__codelineno-2-9 name=__codelineno-2-9></a><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-2-10 id=__codelineno-2-10 name=__codelineno-2-10></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class=w></span>
<a href=#__codelineno-2-11 id=__codelineno-2-11 name=__codelineno-2-11></a><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s>"/etc/foo"</span><span class=w></span>
<a href=#__codelineno-2-12 id=__codelineno-2-12 name=__codelineno-2-12></a><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-2-13 id=__codelineno-2-13 name=__codelineno-2-13></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-2-14 id=__codelineno-2-14 name=__codelineno-2-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class=w></span>
<a href=#__codelineno-2-15 id=__codelineno-2-15 name=__codelineno-2-15></a><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-2-16 id=__codelineno-2-16 name=__codelineno-2-16></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span><span class=w></span>
<a href=#__codelineno-2-17 id=__codelineno-2-17 name=__codelineno-2-17></a><span class=w>      </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w> </span><span class=c1># 默認設置，意味著 "mysecret" 必須已經存在</span><span class=w></span>
</code></pre></div> <p>你要訪問的每個 Secret 都需要通過 <code>.spec.volumes</code> 來引用。</p> <p>如果 Pod 中包含多個容器，則每個容器需要自己的 <code>volumeMounts</code> 塊， 不過針對每個 Secret 而言，只需要一份 <code>.spec.volumes</code> 設置。</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>說明： Kubernetes v1.22 版本之前都會自動創建用來訪問 Kubernetes API 的憑證。這一老的機制是基於創建可被掛載到 Pod 中的令牌 Secret 來實現的。在最近的版本中，包括 Kubernetes v1.24 中，API 憑據是直接通過 <a href=https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/authentication-resources/token-request-v1/ >TokenRequest API</a> 來獲得的，這一憑據會使用<a href=https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/service-accounts-admin/#bound-service-account-token-volume>投射卷</a> 掛載到 Pod 中。使用這種方式獲得的令牌有確定的生命期，並且在掛載它們的 Pod 被刪除時自動作廢。</p> <p>你仍然可以<a href=https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-service-account/#manually-create-a-service-account-api-token>手動創建</a> 服務賬號令牌。例如，當你需要一個永遠都不過期的令牌時。不過，仍然建議使用 <a href=https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/authentication-resources/token-request-v1/ >TokenRequest</a> 子資源來獲得訪問 API 服務器的令牌。你可以使用 <code>kubectl create token</code> 命令調用 <code>TokenRequest</code> API 獲得令牌。</p> </div> <h4 id=secret_8>將 Secret 鍵投射到特定目錄<a class=headerlink href=#secret_8 title="Permanent link">¶</a></h4> <p>你也可以控制 Secret 鍵所投射到的卷中的路徑。你可以使用 <code>.spec.volumes[].secret.items</code> 字段來更改每個主鍵的目標路徑：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class=w></span>
<a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mypod</span><span class=w></span>
<a href=#__codelineno-3-5 id=__codelineno-3-5 name=__codelineno-3-5></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-3-6 id=__codelineno-3-6 name=__codelineno-3-6></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-3-7 id=__codelineno-3-7 name=__codelineno-3-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mypod</span><span class=w></span>
<a href=#__codelineno-3-8 id=__codelineno-3-8 name=__codelineno-3-8></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis</span><span class=w></span>
<a href=#__codelineno-3-9 id=__codelineno-3-9 name=__codelineno-3-9></a><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-3-10 id=__codelineno-3-10 name=__codelineno-3-10></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class=w></span>
<a href=#__codelineno-3-11 id=__codelineno-3-11 name=__codelineno-3-11></a><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s>"/etc/foo"</span><span class=w></span>
<a href=#__codelineno-3-12 id=__codelineno-3-12 name=__codelineno-3-12></a><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-3-13 id=__codelineno-3-13 name=__codelineno-3-13></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-3-14 id=__codelineno-3-14 name=__codelineno-3-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class=w></span>
<a href=#__codelineno-3-15 id=__codelineno-3-15 name=__codelineno-3-15></a><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-3-16 id=__codelineno-3-16 name=__codelineno-3-16></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span><span class=w></span>
<a href=#__codelineno-3-17 id=__codelineno-3-17 name=__codelineno-3-17></a><span class=w>      </span><span class=nt>items</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-3-18 id=__codelineno-3-18 name=__codelineno-3-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">username</span><span class=w></span>
<a href=#__codelineno-3-19 id=__codelineno-3-19 name=__codelineno-3-19></a><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my-group/my-username</span><span class=w></span>
</code></pre></div> <p>將發生的事情如下：</p> <ul> <li><code>mysecret</code> 中的鍵 <code>username</code> 會出現在容器中的路徑為 <code>/etc/foo/my-group/my-username</code>， 而不是 <code>/etc/foo/username</code>。</li> <li>Secret 對象的 <code>password</code> 鍵不會被投射。</li> </ul> <p>如果使用了 <code>.spec.volumes[].secret.items</code>，則只有 <code>items</code> 中指定了的主鍵會被投射。如果要使用 Secret 中的所有主鍵，則需要將它們全部枚舉到 <code>items</code> 字段中。</p> <p>如果你顯式地列舉了主鍵，則所列舉的主鍵都必須在對應的 Secret 中存在。否則所在的卷不會被創建。</p> <h4 id=secret_9>Secret 文件的訪問權限<a class=headerlink href=#secret_9 title="Permanent link">¶</a></h4> <p>你可以為某個 Secret 主鍵設置 POSIX 文件訪問權限位。如果你不指定訪問權限，默認會使用 0644。你也可以為整個 Secret 卷設置默認的訪問模式，然後再根據需要在主鍵層面重載。</p> <p>例如，你可以像下面這樣設置默認的模式：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class=w></span>
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mypod</span><span class=w></span>
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mypod</span><span class=w></span>
<a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis</span><span class=w></span>
<a href=#__codelineno-4-9 id=__codelineno-4-9 name=__codelineno-4-9></a><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-10 id=__codelineno-4-10 name=__codelineno-4-10></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class=w></span>
<a href=#__codelineno-4-11 id=__codelineno-4-11 name=__codelineno-4-11></a><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s>"/etc/foo"</span><span class=w></span>
<a href=#__codelineno-4-12 id=__codelineno-4-12 name=__codelineno-4-12></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-13 id=__codelineno-4-13 name=__codelineno-4-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class=w></span>
<a href=#__codelineno-4-14 id=__codelineno-4-14 name=__codelineno-4-14></a><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-4-15 id=__codelineno-4-15 name=__codelineno-4-15></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span><span class=w></span>
<a href=#__codelineno-4-16 id=__codelineno-4-16 name=__codelineno-4-16></a><span class=w>      </span><span class=nt>defaultMode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0400</span><span class=w></span>
</code></pre></div> <p>該 Secret 被掛載在 /etc/foo 下，Secret 卷掛載所創建的所有文件的訪問模式都是 0400。</p> <h4 id=secret_10>使用來自卷中的 Secret 值<a class=headerlink href=#secret_10 title="Permanent link">¶</a></h4> <p>在掛載了 Secret 卷的容器內，Secret 的主鍵都呈現為文件。 Secret 的取值都是 Base64 編碼的，保存在這些文件中。</p> <p>下面是在上例中的容器內執行命令的結果：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a>ls /etc/foo/
</code></pre></div> <p>輸出類似於：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>username
<a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a>password
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a>cat /etc/foo/username
</code></pre></div> <p>輸出類似於：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a>admin
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a>cat /etc/foo/password
</code></pre></div> <p>輸出類似於：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a>1f2d1e2e67df
</code></pre></div> <p>容器中的程序要負責根據需要讀取 Secret 數據。</p> <h4 id=secret_11>掛載的 Secret 是被自動更新的<a class=headerlink href=#secret_11 title="Permanent link">¶</a></h4> <p>當卷中包含來自 Secret 的數據，而對應的 Secret 被更新，Kubernetes 會跟踪到這一操作並更新卷中的數據。更新的方式是保證最終一致性。</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>說明： 對於以 subPath 形式掛載 Secret 卷的容器而言， 它們無法收到自動的 Secret 更新。</p> </div> <p>Kubelet 組件會維護一個緩存，在其中保存節點上 Pod 卷中使用的 Secret 的當前主鍵和取值。你可以配置 kubelet 如何檢測所緩存數值的變化。 kubelet 配置中的 <code>configMapAndSecretChangeDetectionStrategy</code> 字段控制 kubelet 所採用的策略。默認的策略是 Watch。</p> <p>對 Secret 的更新操作既可以通過 API 的 watch 機制（默認）來傳播， 基於設置了生命期的緩存獲取，也可以通過 kubelet 的同步迴路來從集群的 API 服務器上輪詢獲取。</p> <p>因此，從 Secret 被更新到新的主鍵被投射到 Pod 中，中間存在一個延遲。這一延遲的上限是 kubelet 的同步週期加上緩存的傳播延遲， 其中緩存的傳播延遲取決於所選擇的緩存類型。對應上一段中提到的幾種傳播機制，延遲時長為 watch 的傳播延遲、所配置的緩存 TTL 或者對於直接輪詢而言是零。</p> <h4 id=secret_12>以環境變量的方式使用 Secret<a class=headerlink href=#secret_12 title="Permanent link">¶</a></h4> <p>如果需要在 Pod 中以環境變量 的形式使用 Secret：</p> <ol> <li>創建 Secret（或者使用現有 Secret）。多個 Pod 可以引用同一個 Secret。</li> <li>更改 Pod 定義，在要使用 Secret 鍵值的每個容器中添加與所使用的主鍵對應的環境變量。讀取 Secret 主鍵的環境變量應該在 <code>env[].valueFrom.secretKeyRef</code> 中填寫 Secret 的名稱和主鍵名稱。</li> <li>更改你的鏡像或命令行，以便程序讀取環境變量中保存的值。</li> </ol> <p>下面是一個通過環境變量來使用 Secret 的示例 Pod：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class=w></span>
<a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-env-pod</span><span class=w></span>
<a href=#__codelineno-11-5 id=__codelineno-11-5 name=__codelineno-11-5></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-6 id=__codelineno-11-6 name=__codelineno-11-6></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-7 id=__codelineno-11-7 name=__codelineno-11-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mycontainer</span><span class=w></span>
<a href=#__codelineno-11-8 id=__codelineno-11-8 name=__codelineno-11-8></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis</span><span class=w></span>
<a href=#__codelineno-11-9 id=__codelineno-11-9 name=__codelineno-11-9></a><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-10 id=__codelineno-11-10 name=__codelineno-11-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SECRET_USERNAME</span><span class=w></span>
<a href=#__codelineno-11-11 id=__codelineno-11-11 name=__codelineno-11-11></a><span class=w>        </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-12 id=__codelineno-11-12 name=__codelineno-11-12></a><span class=w>          </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-13 id=__codelineno-11-13 name=__codelineno-11-13></a><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span><span class=w></span>
<a href=#__codelineno-11-14 id=__codelineno-11-14 name=__codelineno-11-14></a><span class=w>            </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">username</span><span class=w></span>
<a href=#__codelineno-11-15 id=__codelineno-11-15 name=__codelineno-11-15></a><span class=w>            </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w> </span><span class=c1># 此值為默認值；意味著 "mysecret"</span><span class=w></span>
<a href=#__codelineno-11-16 id=__codelineno-11-16 name=__codelineno-11-16></a><span class=w>                            </span><span class=c1># 必須存在且包含名為 "username" 的主鍵</span><span class=w></span>
<a href=#__codelineno-11-17 id=__codelineno-11-17 name=__codelineno-11-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SECRET_PASSWORD</span><span class=w></span>
<a href=#__codelineno-11-18 id=__codelineno-11-18 name=__codelineno-11-18></a><span class=w>        </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-19 id=__codelineno-11-19 name=__codelineno-11-19></a><span class=w>          </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-11-20 id=__codelineno-11-20 name=__codelineno-11-20></a><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span><span class=w></span>
<a href=#__codelineno-11-21 id=__codelineno-11-21 name=__codelineno-11-21></a><span class=w>            </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span><span class=w></span>
<a href=#__codelineno-11-22 id=__codelineno-11-22 name=__codelineno-11-22></a><span class=w>            </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w> </span><span class=c1># 此值為默認值；意味著 "mysecret"</span><span class=w></span>
<a href=#__codelineno-11-23 id=__codelineno-11-23 name=__codelineno-11-23></a><span class=w>                            </span><span class=c1># 必須存在且包含名為 "username" 的主鍵</span><span class=w></span>
<a href=#__codelineno-11-24 id=__codelineno-11-24 name=__codelineno-11-24></a><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class=w></span>
</code></pre></div> <h4 id=_2>非法環境變量<a class=headerlink href=#_2 title="Permanent link">¶</a></h4> <p>對於通過 <code>envFrom</code> 字段來填充環境變量的 Secret 而言， 如果其中包含的主鍵不能被當做合法的環境變量名，這些主鍵會被忽略掉。 Pod 仍然可以啟動。</p> <p>如果你定義的 Pod 中包含非法的變量名稱，則 Pod 可能啟動失敗， 會形成 reason 為 <code>InvalidVariableNames</code> 的事件，以及列舉被略過的非法主鍵的消息。下面的例子中展示了一個 Pod，引用的是名為 mysecret 的 Secret， 其中包含兩個非法的主鍵：<code>1badkey</code> 和 <code>2alsobad</code>。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a>kubectl get events
</code></pre></div> <p>輸出類似於：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a>LASTSEEN   FIRSTSEEN   COUNT     NAME            KIND      SUBOBJECT                         TYPE      REASON
<a href=#__codelineno-13-2 id=__codelineno-13-2 name=__codelineno-13-2></a>0s         0s          1         dapi-test-pod   Pod                                         Warning   InvalidEnvironmentVariableNames   kubelet, 127.0.0.1      Keys [1badkey, 2alsobad] from the EnvFrom secret default/mysecret were skipped since they are considered invalid environment variable names.
</code></pre></div> <h4 id=secret_13>通過環境變量使用 Secret 值<a class=headerlink href=#secret_13 title="Permanent link">¶</a></h4> <p>在通過環境變量來使用 Secret 的容器中，Secret 主鍵展現為普通的環境變量。這些變量的取值是 Secret 數據的 Base64 解碼值。</p> <p>下面是在前文示例中的容器內執行命令的結果：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a><span class=nb>echo</span> <span class=s2>"</span><span class=nv>$SECRET_USERNAME</span><span class=s2>"</span>
</code></pre></div> <p>輸出類似於：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a>admin
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a><span class=nb>echo</span> <span class=s2>"</span><span class=nv>$SECRET_PASSWORD</span><span class=s2>"</span>
</code></pre></div> <p>輸出類似於：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a>1f2d1e2e67df
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>說明： 如果容器已經在通過環境變量來使用 Secret，Secret 更新在容器內是看不到的， 除非容器被重啟。有一些第三方的解決方案，能夠在 Secret 發生變化時觸發容器重啟。</p> </div> <h4 id=secret_14>容器鏡像拉取 Secret<a class=headerlink href=#secret_14 title="Permanent link">¶</a></h4> <p>如果你嘗試從私有倉庫拉取容器鏡像，你需要一種方式讓每個節點上的 kubelet 能夠完成與鏡像庫的身份認證。你可以配置 <strong>鏡像拉取 Secret</strong> 來實現這點。 Secret 是在 Pod 層面來配置的。</p> <p>Pod 的 <code>imagePullSecrets</code> 字段是一個對 Pod 所在的名字空間中的 Secret 的引用列表。你可以使用 <code>imagePullSecrets</code> 來將鏡像倉庫訪問憑據傳遞給 kubelet。 kubelet 使用這個信息來替你的 Pod 拉取私有鏡像。參閱 <a href=https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/workload-resources/pod-v1/#PodSpec>Pod API</a> 參考 中的 PodSpec 進一步了解 <code>imagePullSecrets</code> 字段。</p> <p><strong>使用 imagePullSecrets</strong></p> <p>imagePullSecrets 字段是一個列表，包含對同一名字空間中 Secret 的引用。你可以使用 imagePullSecrets 將包含 Docker（或其他）鏡像倉庫密碼的 Secret 傳遞給 kubelet。 kubelet 使用此信息來替 Pod 拉取私有鏡像。參閱 PodSpec API 進一步了解 <code>imagePullSecrets</code> 字段。</p> <p><strong>手動設定 imagePullSecret</strong></p> <p>你可以通過閱讀<a href=https://kubernetes.io/zh-cn/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod>容器鏡像</a> 文檔了解如何設置 <code>imagePullSecrets</code>。</p> <p><strong>設置 imagePullSecrets 為自動掛載</strong></p> <p>你可以手動創建 <code>imagePullSecret</code>，並在一個 ServiceAccount 中引用它。對使用該 ServiceAccount 創建的所有 Pod，或者默認使用該 ServiceAccount 創建的 Pod 而言，其 <code>imagePullSecrets</code> 字段都會設置為該服務賬號。請閱讀<a href=https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-service-account/#add-imagepullsecrets-to-a-service-account>向服務賬號添加 ImagePullSecrets</a> 來詳細了解這一過程。</p> <h4 id=pod-secret_1>在靜態 Pod 中使用 Secret<a class=headerlink href=#pod-secret_1 title="Permanent link">¶</a></h4> <p>你不可以在靜態 Pod 中使用 ConfigMap 或 Secret。</p> <h2 id=_3>使用場景<a class=headerlink href=#_3 title="Permanent link">¶</a></h2> <h3 id=_4>使用場景：作為容器環境變量<a class=headerlink href=#_4 title="Permanent link">¶</a></h3> <p>創建 Secret：</p> <div class=highlight><span class=filename>mysecret.yaml</span><pre><span></span><code><a href=#__codelineno-18-1 id=__codelineno-18-1 name=__codelineno-18-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-18-2 id=__codelineno-18-2 name=__codelineno-18-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-18-3 id=__codelineno-18-3 name=__codelineno-18-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-18-4 id=__codelineno-18-4 name=__codelineno-18-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span><span class=w></span>
<a href=#__codelineno-18-5 id=__codelineno-18-5 name=__codelineno-18-5></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span><span class=w></span>
<a href=#__codelineno-18-6 id=__codelineno-18-6 name=__codelineno-18-6></a><span class=nt>data</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-18-7 id=__codelineno-18-7 name=__codelineno-18-7></a><span class=w>  </span><span class=nt>USER_NAME</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">YWRtaW4=</span><span class=w></span>
<a href=#__codelineno-18-8 id=__codelineno-18-8 name=__codelineno-18-8></a><span class=w>  </span><span class=nt>PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MWYyZDFlMmU2N2Rm</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><a href=#__codelineno-19-1 id=__codelineno-19-1 name=__codelineno-19-1></a>kubectl apply -f mysecret.yaml
</code></pre></div> <p>使用 <code>envFrom</code> 來將 Secret 的所有數據定義為容器的環境變量。來自 Secret 的主鍵成為 Pod 中的環境變量名稱：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-20-1 id=__codelineno-20-1 name=__codelineno-20-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-20-2 id=__codelineno-20-2 name=__codelineno-20-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class=w></span>
<a href=#__codelineno-20-3 id=__codelineno-20-3 name=__codelineno-20-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-20-4 id=__codelineno-20-4 name=__codelineno-20-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-test-pod</span><span class=w></span>
<a href=#__codelineno-20-5 id=__codelineno-20-5 name=__codelineno-20-5></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-20-6 id=__codelineno-20-6 name=__codelineno-20-6></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-20-7 id=__codelineno-20-7 name=__codelineno-20-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-container</span><span class=w></span>
<a href=#__codelineno-20-8 id=__codelineno-20-8 name=__codelineno-20-8></a><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">k8s.gcr.io/busybox</span><span class=w></span>
<a href=#__codelineno-20-9 id=__codelineno-20-9 name=__codelineno-20-9></a><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"/bin/sh"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"-c"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"env"</span><span class=w> </span><span class="p p-Indicator">]</span><span class=w></span>
<a href=#__codelineno-20-10 id=__codelineno-20-10 name=__codelineno-20-10></a><span class=w>      </span><span class=nt>envFrom</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-20-11 id=__codelineno-20-11 name=__codelineno-20-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>secretRef</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-20-12 id=__codelineno-20-12 name=__codelineno-20-12></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mysecret</span><span class=w></span>
<a href=#__codelineno-20-13 id=__codelineno-20-13 name=__codelineno-20-13></a><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Never</span><span class=w></span>
</code></pre></div> <h3 id=ssh-pod>使用場景：帶 SSH 密鑰的 Pod<a class=headerlink href=#ssh-pod title="Permanent link">¶</a></h3> <p>創建包含一些 SSH 密鑰的 Secret：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-21-1 id=__codelineno-21-1 name=__codelineno-21-1></a>kubectl create secret generic ssh-key-secret --from-file<span class=o>=</span>ssh-privatekey<span class=o>=</span>/path/to/.ssh/id_rsa --from-file<span class=o>=</span>ssh-publickey<span class=o>=</span>/path/to/.ssh/id_rsa.pub
</code></pre></div> <p>輸出類似於：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-22-1 id=__codelineno-22-1 name=__codelineno-22-1></a>secret "ssh-key-secret" created
</code></pre></div> <p>你也可以創建一個 <code>kustomization.yaml</code> 文件，在其 <code>secretGenerator</code> 字段中包含 SSH 密鑰。</p> <p>現在你可以創建一個 Pod，在其中訪問包含 SSH 密鑰的 Secret，並通過卷的方式來使用它：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-23-1 id=__codelineno-23-1 name=__codelineno-23-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-23-2 id=__codelineno-23-2 name=__codelineno-23-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class=w></span>
<a href=#__codelineno-23-3 id=__codelineno-23-3 name=__codelineno-23-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-23-4 id=__codelineno-23-4 name=__codelineno-23-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-test-pod</span><span class=w></span>
<a href=#__codelineno-23-5 id=__codelineno-23-5 name=__codelineno-23-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-23-6 id=__codelineno-23-6 name=__codelineno-23-6></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-test</span><span class=w></span>
<a href=#__codelineno-23-7 id=__codelineno-23-7 name=__codelineno-23-7></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-23-8 id=__codelineno-23-8 name=__codelineno-23-8></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-23-9 id=__codelineno-23-9 name=__codelineno-23-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-volume</span><span class=w></span>
<a href=#__codelineno-23-10 id=__codelineno-23-10 name=__codelineno-23-10></a><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-23-11 id=__codelineno-23-11 name=__codelineno-23-11></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ssh-key-secret</span><span class=w></span>
<a href=#__codelineno-23-12 id=__codelineno-23-12 name=__codelineno-23-12></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-23-13 id=__codelineno-23-13 name=__codelineno-23-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ssh-test-container</span><span class=w></span>
<a href=#__codelineno-23-14 id=__codelineno-23-14 name=__codelineno-23-14></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mySshImage</span><span class=w></span>
<a href=#__codelineno-23-15 id=__codelineno-23-15 name=__codelineno-23-15></a><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-23-16 id=__codelineno-23-16 name=__codelineno-23-16></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-volume</span><span class=w></span>
<a href=#__codelineno-23-17 id=__codelineno-23-17 name=__codelineno-23-17></a><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-23-18 id=__codelineno-23-18 name=__codelineno-23-18></a><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s>"/etc/secret-volume"</span><span class=w></span>
</code></pre></div> <p>容器命令執行時，秘鑰的數據可以在下面的位置訪問到：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-24-1 id=__codelineno-24-1 name=__codelineno-24-1></a>/etc/secret-volume/ssh-publickey
<a href=#__codelineno-24-2 id=__codelineno-24-2 name=__codelineno-24-2></a>/etc/secret-volume/ssh-privatekey
</code></pre></div> <p>容器就可以隨便使用 Secret 數據來建立 SSH 連接。</p> <h3 id=pod>使用場景：帶有生產、測試環境憑據的 Pod<a class=headerlink href=#pod title="Permanent link">¶</a></h3> <p>這一示例所展示的一個 Pod 會使用包含生產環境憑據的 Secret，另一個 Pod 使用包含測試環境憑據的 Secret。</p> <p>你可以創建一個帶有 <code>secretGenerator</code> 字段的 <code>kustomization.yaml</code> 文件或者運行 <code>kubectl create secret</code> 來創建 Secret。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-25-1 id=__codelineno-25-1 name=__codelineno-25-1></a>kubectl create secret generic prod-db-secret --from-literal<span class=o>=</span><span class=nv>username</span><span class=o>=</span>produser --from-literal<span class=o>=</span><span class=nv>password</span><span class=o>=</span>Y4nys7f11
</code></pre></div> <p>輸出類似於：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-26-1 id=__codelineno-26-1 name=__codelineno-26-1></a>secret "prod-db-secret" created
</code></pre></div> <p>你也可以創建一個包含測試環境憑據的 Secret：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-27-1 id=__codelineno-27-1 name=__codelineno-27-1></a>kubectl create secret generic test-db-secret --from-literal<span class=o>=</span><span class=nv>username</span><span class=o>=</span>testuser --from-literal<span class=o>=</span><span class=nv>password</span><span class=o>=</span>iluvtests
</code></pre></div> <p>輸出類似於：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-28-1 id=__codelineno-28-1 name=__codelineno-28-1></a>secret "test-db-secret" created
</code></pre></div> <p>現在生成 Pod：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-29-1 id=__codelineno-29-1 name=__codelineno-29-1></a>cat <span class=s>&lt;&lt;EOF &gt; pod.yaml</span>
<a href=#__codelineno-29-2 id=__codelineno-29-2 name=__codelineno-29-2></a><span class=s>apiVersion: v1</span>
<a href=#__codelineno-29-3 id=__codelineno-29-3 name=__codelineno-29-3></a><span class=s>kind: List</span>
<a href=#__codelineno-29-4 id=__codelineno-29-4 name=__codelineno-29-4></a><span class=s>items:</span>
<a href=#__codelineno-29-5 id=__codelineno-29-5 name=__codelineno-29-5></a><span class=s>- kind: Pod</span>
<a href=#__codelineno-29-6 id=__codelineno-29-6 name=__codelineno-29-6></a><span class=s>  apiVersion: v1</span>
<a href=#__codelineno-29-7 id=__codelineno-29-7 name=__codelineno-29-7></a><span class=s>  metadata:</span>
<a href=#__codelineno-29-8 id=__codelineno-29-8 name=__codelineno-29-8></a><span class=s>    name: prod-db-client-pod</span>
<a href=#__codelineno-29-9 id=__codelineno-29-9 name=__codelineno-29-9></a><span class=s>    labels:</span>
<a href=#__codelineno-29-10 id=__codelineno-29-10 name=__codelineno-29-10></a><span class=s>      name: prod-db-client</span>
<a href=#__codelineno-29-11 id=__codelineno-29-11 name=__codelineno-29-11></a><span class=s>  spec:</span>
<a href=#__codelineno-29-12 id=__codelineno-29-12 name=__codelineno-29-12></a><span class=s>    volumes:</span>
<a href=#__codelineno-29-13 id=__codelineno-29-13 name=__codelineno-29-13></a><span class=s>    - name: secret-volume</span>
<a href=#__codelineno-29-14 id=__codelineno-29-14 name=__codelineno-29-14></a><span class=s>      secret:</span>
<a href=#__codelineno-29-15 id=__codelineno-29-15 name=__codelineno-29-15></a><span class=s>        secretName: prod-db-secret</span>
<a href=#__codelineno-29-16 id=__codelineno-29-16 name=__codelineno-29-16></a><span class=s>    containers:</span>
<a href=#__codelineno-29-17 id=__codelineno-29-17 name=__codelineno-29-17></a><span class=s>    - name: db-client-container</span>
<a href=#__codelineno-29-18 id=__codelineno-29-18 name=__codelineno-29-18></a><span class=s>      image: myClientImage</span>
<a href=#__codelineno-29-19 id=__codelineno-29-19 name=__codelineno-29-19></a><span class=s>      volumeMounts:</span>
<a href=#__codelineno-29-20 id=__codelineno-29-20 name=__codelineno-29-20></a><span class=s>      - name: secret-volume</span>
<a href=#__codelineno-29-21 id=__codelineno-29-21 name=__codelineno-29-21></a><span class=s>        readOnly: true</span>
<a href=#__codelineno-29-22 id=__codelineno-29-22 name=__codelineno-29-22></a><span class=s>        mountPath: "/etc/secret-volume"</span>
<a href=#__codelineno-29-23 id=__codelineno-29-23 name=__codelineno-29-23></a><span class=s>- kind: Pod</span>
<a href=#__codelineno-29-24 id=__codelineno-29-24 name=__codelineno-29-24></a><span class=s>  apiVersion: v1</span>
<a href=#__codelineno-29-25 id=__codelineno-29-25 name=__codelineno-29-25></a><span class=s>  metadata:</span>
<a href=#__codelineno-29-26 id=__codelineno-29-26 name=__codelineno-29-26></a><span class=s>    name: test-db-client-pod</span>
<a href=#__codelineno-29-27 id=__codelineno-29-27 name=__codelineno-29-27></a><span class=s>    labels:</span>
<a href=#__codelineno-29-28 id=__codelineno-29-28 name=__codelineno-29-28></a><span class=s>      name: test-db-client</span>
<a href=#__codelineno-29-29 id=__codelineno-29-29 name=__codelineno-29-29></a><span class=s>  spec:</span>
<a href=#__codelineno-29-30 id=__codelineno-29-30 name=__codelineno-29-30></a><span class=s>    volumes:</span>
<a href=#__codelineno-29-31 id=__codelineno-29-31 name=__codelineno-29-31></a><span class=s>    - name: secret-volume</span>
<a href=#__codelineno-29-32 id=__codelineno-29-32 name=__codelineno-29-32></a><span class=s>      secret:</span>
<a href=#__codelineno-29-33 id=__codelineno-29-33 name=__codelineno-29-33></a><span class=s>        secretName: test-db-secret</span>
<a href=#__codelineno-29-34 id=__codelineno-29-34 name=__codelineno-29-34></a><span class=s>    containers:</span>
<a href=#__codelineno-29-35 id=__codelineno-29-35 name=__codelineno-29-35></a><span class=s>    - name: db-client-container</span>
<a href=#__codelineno-29-36 id=__codelineno-29-36 name=__codelineno-29-36></a><span class=s>      image: myClientImage</span>
<a href=#__codelineno-29-37 id=__codelineno-29-37 name=__codelineno-29-37></a><span class=s>      volumeMounts:</span>
<a href=#__codelineno-29-38 id=__codelineno-29-38 name=__codelineno-29-38></a><span class=s>      - name: secret-volume</span>
<a href=#__codelineno-29-39 id=__codelineno-29-39 name=__codelineno-29-39></a><span class=s>        readOnly: true</span>
<a href=#__codelineno-29-40 id=__codelineno-29-40 name=__codelineno-29-40></a><span class=s>        mountPath: "/etc/secret-volume"</span>
<a href=#__codelineno-29-41 id=__codelineno-29-41 name=__codelineno-29-41></a><span class=s>EOF</span>
</code></pre></div> <p>將 Pod 添加到同一 <code>kustomization.yaml</code> 文件中：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-30-1 id=__codelineno-30-1 name=__codelineno-30-1></a>cat <span class=s>&lt;&lt;EOF &gt;&gt; kustomization.yaml</span>
<a href=#__codelineno-30-2 id=__codelineno-30-2 name=__codelineno-30-2></a><span class=s>resources:</span>
<a href=#__codelineno-30-3 id=__codelineno-30-3 name=__codelineno-30-3></a><span class=s>- pod.yaml</span>
<a href=#__codelineno-30-4 id=__codelineno-30-4 name=__codelineno-30-4></a><span class=s>EOF</span>
</code></pre></div> <p>通過下面的命令在 API 服務器上應用所有這些對象：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-31-1 id=__codelineno-31-1 name=__codelineno-31-1></a>kubectl apply -k .
</code></pre></div> <p>兩個文件都會在其文件系統中出現下面的文件，文件中內容是各個容器的環境值：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-32-1 id=__codelineno-32-1 name=__codelineno-32-1></a>/etc/secret-volume/username
<a href=#__codelineno-32-2 id=__codelineno-32-2 name=__codelineno-32-2></a>/etc/secret-volume/password
</code></pre></div> <p>注意這兩個 Pod 的規約中只有一個字段不同。這便於基於相同的 Pod 模板生成具有不同能力的 Pod。</p> <p>你可以通過使用兩個服務賬號來進一步簡化這一基本的 Pod 規約：</p> <ol> <li><code>prod-user</code> 服務賬號使用 <code>prod-db-secret</code></li> <li><code>test-user</code> 服務賬號使用 <code>test-db-secret</code></li> </ol> <p>Pod 規約簡化為：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-33-1 id=__codelineno-33-1 name=__codelineno-33-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-33-2 id=__codelineno-33-2 name=__codelineno-33-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class=w></span>
<a href=#__codelineno-33-3 id=__codelineno-33-3 name=__codelineno-33-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-33-4 id=__codelineno-33-4 name=__codelineno-33-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prod-db-client-pod</span><span class=w></span>
<a href=#__codelineno-33-5 id=__codelineno-33-5 name=__codelineno-33-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-33-6 id=__codelineno-33-6 name=__codelineno-33-6></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prod-db-client</span><span class=w></span>
<a href=#__codelineno-33-7 id=__codelineno-33-7 name=__codelineno-33-7></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-33-8 id=__codelineno-33-8 name=__codelineno-33-8></a><span class=w>  </span><span class=nt>serviceAccount</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prod-db-client</span><span class=w></span>
<a href=#__codelineno-33-9 id=__codelineno-33-9 name=__codelineno-33-9></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-33-10 id=__codelineno-33-10 name=__codelineno-33-10></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db-client-container</span><span class=w></span>
<a href=#__codelineno-33-11 id=__codelineno-33-11 name=__codelineno-33-11></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myClientImage</span><span class=w></span>
</code></pre></div> <h3 id=secret_15>使用場景：在 Secret 卷中帶句點的文件<a class=headerlink href=#secret_15 title="Permanent link">¶</a></h3> <p>通過定義以句點（.）開頭的主鍵，你可以“隱藏”你的數據。這些主鍵代表的是以句點開頭的文件或“隱藏”文件。例如，當下面的 Secret 被掛載到 <code>secret-volume</code> 卷中時：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-34-1 id=__codelineno-34-1 name=__codelineno-34-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-34-2 id=__codelineno-34-2 name=__codelineno-34-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-34-3 id=__codelineno-34-3 name=__codelineno-34-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-34-4 id=__codelineno-34-4 name=__codelineno-34-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dotfile-secret</span><span class=w></span>
<a href=#__codelineno-34-5 id=__codelineno-34-5 name=__codelineno-34-5></a><span class=nt>data</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-34-6 id=__codelineno-34-6 name=__codelineno-34-6></a><span class=w>  </span><span class=nt>.secret-file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dmFsdWUtMg0KDQo=</span><span class=w></span>
<a href=#__codelineno-34-7 id=__codelineno-34-7 name=__codelineno-34-7></a><span class=nn>---</span><span class=w></span>
<a href=#__codelineno-34-8 id=__codelineno-34-8 name=__codelineno-34-8></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-34-9 id=__codelineno-34-9 name=__codelineno-34-9></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class=w></span>
<a href=#__codelineno-34-10 id=__codelineno-34-10 name=__codelineno-34-10></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-34-11 id=__codelineno-34-11 name=__codelineno-34-11></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-dotfiles-pod</span><span class=w></span>
<a href=#__codelineno-34-12 id=__codelineno-34-12 name=__codelineno-34-12></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-34-13 id=__codelineno-34-13 name=__codelineno-34-13></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-34-14 id=__codelineno-34-14 name=__codelineno-34-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-volume</span><span class=w></span>
<a href=#__codelineno-34-15 id=__codelineno-34-15 name=__codelineno-34-15></a><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-34-16 id=__codelineno-34-16 name=__codelineno-34-16></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dotfile-secret</span><span class=w></span>
<a href=#__codelineno-34-17 id=__codelineno-34-17 name=__codelineno-34-17></a><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-34-18 id=__codelineno-34-18 name=__codelineno-34-18></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dotfile-test-container</span><span class=w></span>
<a href=#__codelineno-34-19 id=__codelineno-34-19 name=__codelineno-34-19></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">k8s.gcr.io/busybox</span><span class=w></span>
<a href=#__codelineno-34-20 id=__codelineno-34-20 name=__codelineno-34-20></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-34-21 id=__codelineno-34-21 name=__codelineno-34-21></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ls</span><span class=w></span>
<a href=#__codelineno-34-22 id=__codelineno-34-22 name=__codelineno-34-22></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"-l"</span><span class=w></span>
<a href=#__codelineno-34-23 id=__codelineno-34-23 name=__codelineno-34-23></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"/etc/secret-volume"</span><span class=w></span>
<a href=#__codelineno-34-24 id=__codelineno-34-24 name=__codelineno-34-24></a><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-34-25 id=__codelineno-34-25 name=__codelineno-34-25></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-volume</span><span class=w></span>
<a href=#__codelineno-34-26 id=__codelineno-34-26 name=__codelineno-34-26></a><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a href=#__codelineno-34-27 id=__codelineno-34-27 name=__codelineno-34-27></a><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s>"/etc/secret-volume"</span><span class=w></span>
</code></pre></div> <p>卷中會包含一個名為 <code>.secret-file</code> 的文件，並且容器 <code>dotfile-test-container</code> 中此文件位於路徑 <code>/etc/secret-volume/.secret-file</code> 處。</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>說明： 以句點開頭的文件會在 <code>ls -l</code> 的輸出中被隱藏起來； 列舉目錄內容時你必須使用 <code>ls -la</code> 才能看到它們。</p> </div> <h3 id=pod-secret_2>使用場景：僅對 Pod 中一個容器可見的 Secret<a class=headerlink href=#pod-secret_2 title="Permanent link">¶</a></h3> <p>考慮一個需要處理 HTTP 請求，執行某些複雜的業務邏輯，之後使用 HMAC 來對某些消息進行簽名的程序。因為這一程序的應用邏輯很複雜， 其中可能包含未被注意到的遠程服務器文件讀取漏洞， 這種漏洞可能會把私鑰暴露給攻擊者。</p> <p>這一程序可以分隔成兩個容器中的兩個進程：前端容器要處理用戶交互和業務邏輯， 但無法看到私鑰；簽名容器可以看到私鑰，並對來自前端的簡單簽名請求作出響應 （例如，通過本地主機網絡）。</p> <p>採用這種劃分的方法，攻擊者現在必須欺騙應用服務器來做一些其他操作， 而這些操作可能要比讀取一個文件要復雜很多。</p> <h2 id=secret_16>Secret 的類型<a class=headerlink href=#secret_16 title="Permanent link">¶</a></h2> <p>創建 Secret 時，你可以使用 Secret 資源的 <code>type</code> 字段，或者與其等價的 <code>kubectl</code> 命令行參數（如果有的話）為其設置類型。 Secret 類型有助於對 Secret 數據進行編程處理。</p> <p>Kubernetes 提供若干種內置的類型，用於一些常見的使用場景。針對這些類型，Kubernetes 所執行的合法性檢查操作以及對其所實施的限制各不相同。</p> <table> <thead> <tr> <th>類型</th> <th>用例</th> </tr> </thead> <tbody> <tr> <td><strong>Opaque</strong></td> <td>預設的的類型。Base64 編碼格式的 Secret，用來存儲密碼、密鑰等；數據可通過 <code>base64 –decode</code> 解碼得到原始數據，所以加密性很弱。</td> </tr> <tr> <td><strong>kubernetes.io/service-account-token</strong></td> <td>用於被 serviceaccount 引用。 serviceaccout 創建時 Kubernetes 會默認創建對應的 secret。 Pod 如果使用了serviceaccount，對應的 secret 會自動掛載到 Pod 目錄 <code>/run/secrets/kubernetes.io/serviceaccount</code> 中。</td> </tr> <tr> <td><strong>kubernetes.io/dockercfg</strong></td> <td><code>~/.dockercfg</code> 文件的序列化形式，用來存儲私有 docker registry 的認證信息</td> </tr> <tr> <td><strong>kubernetes.io/dockerconfigjson</strong></td> <td><code>~/.docker/config.json</code> 文件的序列化形式，用來存儲私有 docker registry 的認證信息</td> </tr> <tr> <td><strong>kubernetes.io/basic-auth</strong></td> <td>用於基本身份認證 (Basic Auth)的憑據</td> </tr> <tr> <td><strong>kubernetes.io/ssh-auth</strong></td> <td>用於 SSH 身份認證的憑據</td> </tr> <tr> <td><strong>kubernetes.io/tls</strong></td> <td>用於 TLS 客戶端或者服務器端的數據</td> </tr> <tr> <td><strong>bootstrap.kubernetes.io/token</strong></td> <td>K8s 節點 bootstrap 令牌數據</td> </tr> </tbody> </table> <p>通過為 Secret 對象的 type 字段設置一個非空的字符串值，你也可以定義並使用自己 Secret 類型（如果 type 值為空字符串，則被視為 Opaque 類型）。</p> <p>Kubernetes 並不對類型的名稱作任何限制。不過，如果你要使用內置類型之一， 則你必須滿足為該類型所定義的所有要求。</p> <p>如果你要定義一種公開使用的 Secret 類型，請遵守 Secret 類型的約定和結構， 在類型名簽名添加域名，並用 <code>/</code> 隔開。例如：<code>cloud-hosting.example.net/cloud-api-credentials</code>。</p> <h3 id=opaque-secret>Opaque Secret<a class=headerlink href=#opaque-secret title="Permanent link">¶</a></h3> <p>當 Secret 配置文件中未作顯式設定時，默認的 Secret 類型是 Opaque。當你使用 kubectl 來創建一個 Secret 時，你會使用 generic 子命令來標明要創建的是一個 Opaque 類型 Secret。例如，下面的命令會創建一個空的 Opaque 類型 Secret 對象：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-35-1 id=__codelineno-35-1 name=__codelineno-35-1></a>kubectl create secret generic empty-secret
<a href=#__codelineno-35-2 id=__codelineno-35-2 name=__codelineno-35-2></a>kubectl get secret empty-secret
</code></pre></div> <p>輸出類似於</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-36-1 id=__codelineno-36-1 name=__codelineno-36-1></a>NAME           TYPE     DATA   AGE
<a href=#__codelineno-36-2 id=__codelineno-36-2 name=__codelineno-36-2></a>empty-secret   Opaque   0      2m6s
</code></pre></div> <p><code>DATA</code> 列顯示 Secret 中保存的數據條目個數。在這個例子種，<code>0</code> 意味著你剛剛創建了一個空的 Secret。</p> <h3 id=secret_17>服務賬號令牌 Secret<a class=headerlink href=#secret_17 title="Permanent link">¶</a></h3> <p>類型為 <code>kubernetes.io/service-account-token</code> 的 Secret 用來存放標識某服務賬號的令牌憑據。</p> <p>從 v1.22 開始，這種類型的 Secret 不再被用來向 Pod 中加載憑據數據， 建議通過 <code>TokenRequest API</code>(<a href=https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/authentication-resources/token-request-v1/ >https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/authentication-resources/token-request-v1/</a>) 來獲得令牌，而不是使用服務賬號令牌 Secret 對象。通過 <code>TokenRequest API</code> 獲得的令牌比保存在 Secret 對像中的令牌更加安全， 因為這些令牌有著被限定的生命期，並且不會被其他 API 客戶端讀取。你可以使用 <code>kubectl create token</code> 命令調用 <code>TokenRequest API</code> 獲得令牌。</p> <p>只有在你無法使用 <code>TokenRequest API</code> 來獲取令牌， 並且你能夠接受因為將永不過期的令牌憑據寫入到可讀取的 API 對象而帶來的安全風險時， 才應該創建服務賬號令牌 Secret 對象。</p> <p>使用這種 Secret 類型時，你需要確保對象的註解 <code>kubernetes.io/service-account-name</code> 被設置為某個已有的服務賬號名稱。如果你同時負責 ServiceAccount 和 Secret 對象的創建，應該先創建 ServiceAccount 對象。</p> <p>當 Secret 對像被創建之後，某個 Kubernetes 控制器會填寫 Secret 的其它字段，例如 <code>kubernetes.io/service-account.uid</code> 註解以及 <code>data</code> 字段中的 <code>token</code> 鍵值，使之包含實際的令牌內容。</p> <p>下面的配置實例聲明了一個服務賬號令牌 Secret：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-37-1 id=__codelineno-37-1 name=__codelineno-37-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-37-2 id=__codelineno-37-2 name=__codelineno-37-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-37-3 id=__codelineno-37-3 name=__codelineno-37-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-37-4 id=__codelineno-37-4 name=__codelineno-37-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-sa-sample</span><span class=w></span>
<a href=#__codelineno-37-5 id=__codelineno-37-5 name=__codelineno-37-5></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-37-6 id=__codelineno-37-6 name=__codelineno-37-6></a><span class=w>    </span><span class=nt>kubernetes.io/service-account.name</span><span class=p>:</span><span class=w> </span><span class=s>"sa-name"</span><span class=w></span>
<a href=#__codelineno-37-7 id=__codelineno-37-7 name=__codelineno-37-7></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/service-account-token</span><span class=w></span>
<a href=#__codelineno-37-8 id=__codelineno-37-8 name=__codelineno-37-8></a><span class=nt>data</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-37-9 id=__codelineno-37-9 name=__codelineno-37-9></a><span class=w>  </span><span class=c1># 你可以像 Opaque Secret 一样在这里添加额外的键/值偶对</span><span class=w></span>
<a href=#__codelineno-37-10 id=__codelineno-37-10 name=__codelineno-37-10></a><span class=w>  </span><span class=nt>extra</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">YmFyCg==</span><span class=w></span>
</code></pre></div> <p>創建了 Secret 之後，等待 Kubernetes 在 <code>data</code> 字段中填充 token 主鍵。</p> <p>參考 ServiceAccount 文檔了解服務賬號的工作原理。你也可以查看 Pod 資源中的 <code>automountServiceAccountToken</code> 和 <code>serviceAccountName</code> 字段文檔， 進一步了解從 Pod 中引用服務賬號憑據。</p> <h3 id=docker-secret>Docker 配置 Secret<a class=headerlink href=#docker-secret title="Permanent link">¶</a></h3> <p>你可以使用下面兩種 type 值之一來創建 Secret，用以存放用於訪問容器鏡像倉庫的憑據：</p> <ul> <li><code>kubernetes.io/dockercfg</code></li> <li><code>kubernetes.io/dockerconfigjson</code></li> </ul> <p>kubernetes.io/dockercfg<code>是一種保留類型，用來存放</code><sub>/.dockercfg<code>文件的序列化形式。該文件是配置 Docker 命令行的一種老舊形式。使用此 Secret 類型時，你需要確保 Secret 的</code>data<code>字段中包含名為</code>.dockercfg<code>的主鍵，其對應鍵值是用 base64 編碼的某</code></sub>/.dockercfg` 文件的內容。</p> <p>類型 <code>kubernetes.io/dockerconfigjson</code> 被設計用來保存 JSON 數據的序列化形式， 該 JSON 也遵從 <code>~/.docker/config.json</code> 文件的格式規則，而後者是 <code>~/.dockercfg</code> 的新版本格式。使用此 Secret 類型時，Secret 對象的 <code>data</code> 字段必須包含 <code>.dockerconfigjson</code> 鍵，其鍵值為 base64 編碼的字符串包含 <code>~/.docker/config.json</code> 文件的內容。</p> <p>下面是一個 <code>kubernetes.io/dockercfg</code> 類型 Secret 的示例：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-38-1 id=__codelineno-38-1 name=__codelineno-38-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-38-2 id=__codelineno-38-2 name=__codelineno-38-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-38-3 id=__codelineno-38-3 name=__codelineno-38-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-38-4 id=__codelineno-38-4 name=__codelineno-38-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-dockercfg</span><span class=w></span>
<a href=#__codelineno-38-5 id=__codelineno-38-5 name=__codelineno-38-5></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/dockercfg</span><span class=w></span>
<a href=#__codelineno-38-6 id=__codelineno-38-6 name=__codelineno-38-6></a><span class=nt>data</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-38-7 id=__codelineno-38-7 name=__codelineno-38-7></a><span class=w>  </span><span class=nt>.dockercfg</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-38-8 id=__codelineno-38-8 name=__codelineno-38-8></a><span class=w>        </span><span class=no>"&lt;base64 encoded ~/.dockercfg file&gt;"</span><span class=w></span>
</code></pre></div> <p>當你使用清單文件來創建這兩類 Secret 時，API 服務器會檢查 <code>data</code> 字段中是否存在所期望的主鍵， 並且驗證其中所提供的鍵值是否是合法的 JSON 數據。不過，API 服務器不會檢查 JSON 數據本身是否是一個合法的 Docker 配置文件內容。</p> <p>當你沒有 Docker 配置文件，或者你想使用 <code>kubectl</code> 創建一個 Secret 來訪問容器倉庫時，你可以這樣做：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-39-1 id=__codelineno-39-1 name=__codelineno-39-1></a>kubectl create secret docker-registry secret-tiger-docker <span class=se>\</span>
<a href=#__codelineno-39-2 id=__codelineno-39-2 name=__codelineno-39-2></a>  --docker-email<span class=o>=</span>tiger@acme.example <span class=se>\</span>
<a href=#__codelineno-39-3 id=__codelineno-39-3 name=__codelineno-39-3></a>  --docker-username<span class=o>=</span>tiger <span class=se>\</span>
<a href=#__codelineno-39-4 id=__codelineno-39-4 name=__codelineno-39-4></a>  --docker-password<span class=o>=</span>pass1234 <span class=se>\</span>
<a href=#__codelineno-39-5 id=__codelineno-39-5 name=__codelineno-39-5></a>  --docker-server<span class=o>=</span>my-registry.example:5000
</code></pre></div> <p>上面的命令創建一個類型為 <code>kubernetes.io/dockerconfigjson</code> 的 Secret。如果你對 <code>.data.dockerconfigjson</code> 內容進行轉儲並執行 base64 解碼：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-40-1 id=__codelineno-40-1 name=__codelineno-40-1></a>kubectl get secret secret-tiger-docker -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.data.*}'</span> <span class=p>|</span> base64 -d
</code></pre></div> <p>那麼輸出等價於這個 JSON 文檔（這也是一個有效的 Docker 配置文件）：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-41-1 id=__codelineno-41-1 name=__codelineno-41-1></a><span class=p>{</span><span class=w></span>
<a href=#__codelineno-41-2 id=__codelineno-41-2 name=__codelineno-41-2></a><span class=w>  </span><span class=nt>"auths"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a href=#__codelineno-41-3 id=__codelineno-41-3 name=__codelineno-41-3></a><span class=w>    </span><span class=nt>"my-registry.example:5000"</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a href=#__codelineno-41-4 id=__codelineno-41-4 name=__codelineno-41-4></a><span class=w>      </span><span class=nt>"username"</span><span class=p>:</span><span class=w> </span><span class=s2>"tiger"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-41-5 id=__codelineno-41-5 name=__codelineno-41-5></a><span class=w>      </span><span class=nt>"password"</span><span class=p>:</span><span class=w> </span><span class=s2>"pass1234"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-41-6 id=__codelineno-41-6 name=__codelineno-41-6></a><span class=w>      </span><span class=nt>"email"</span><span class=p>:</span><span class=w> </span><span class=s2>"tiger@acme.example"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-41-7 id=__codelineno-41-7 name=__codelineno-41-7></a><span class=w>      </span><span class=nt>"auth"</span><span class=p>:</span><span class=w> </span><span class=s2>"dGlnZXI6cGFzczEyMzQ="</span><span class=w></span>
<a href=#__codelineno-41-8 id=__codelineno-41-8 name=__codelineno-41-8></a><span class=w>    </span><span class=p>}</span><span class=w></span>
<a href=#__codelineno-41-9 id=__codelineno-41-9 name=__codelineno-41-9></a><span class=w>  </span><span class=p>}</span><span class=w></span>
<a href=#__codelineno-41-10 id=__codelineno-41-10 name=__codelineno-41-10></a><span class=p>}</span><span class=w></span>
</code></pre></div> <h3 id=secret_18>基本身份認證 Secret<a class=headerlink href=#secret_18 title="Permanent link">¶</a></h3> <p><code>kubernetes.io/basic-auth</code> 類型用來存放用於基本身份認證所需的憑據信息。使用這種 Secret 類型時，Secret 的 <code>data</code> 字段必須包含以下兩個鍵之一：</p> <ul> <li><code>username</code>: 用於身份認證的用戶名；</li> <li><code>password</code>: 用於身份認證的密碼或令牌。</li> <li>以上兩個鍵的鍵值都是 base64 編碼的字符串。當然你也可以在創建 Secret 時使用 <code>stringData</code> 字段來提供明文形式的內容。以下清單是基本身份驗證 Secret 的示例：</li> </ul> <div class=highlight><pre><span></span><code><a href=#__codelineno-42-1 id=__codelineno-42-1 name=__codelineno-42-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-42-2 id=__codelineno-42-2 name=__codelineno-42-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-42-3 id=__codelineno-42-3 name=__codelineno-42-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-42-4 id=__codelineno-42-4 name=__codelineno-42-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-basic-auth</span><span class=w></span>
<a href=#__codelineno-42-5 id=__codelineno-42-5 name=__codelineno-42-5></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/basic-auth</span><span class=w></span>
<a href=#__codelineno-42-6 id=__codelineno-42-6 name=__codelineno-42-6></a><span class=nt>stringData</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-42-7 id=__codelineno-42-7 name=__codelineno-42-7></a><span class=w>  </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class=w>      </span><span class=c1># kubernetes.io/basic-auth 類型的必需字段</span><span class=w></span>
<a href=#__codelineno-42-8 id=__codelineno-42-8 name=__codelineno-42-8></a><span class=w>  </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">t0p-Secret</span><span class=w> </span><span class=c1># kubernetes.io/basic-auth 類型的必需字段</span><span class=w></span>
</code></pre></div> <p>提供基本身份認證類型的 Secret 僅僅是出於方便性考慮。你也可以使用 Opaque 類型來保存用於基本身份認證的憑據。不過，使用預定義的、公開的 Secret 類型（<code>kubernetes.io/basic-auth</code>） 有助於幫助其他用戶理解 Secret 的目的，並且對其中存在的主鍵形成一種約定。 API 服務器會檢查 Secret 配置中是否提供了所需要的主鍵。</p> <h3 id=ssh-secret>SSH 身份認證 Secret<a class=headerlink href=#ssh-secret title="Permanent link">¶</a></h3> <p>Kubernetes 所提供的內置類型 <code>kubernetes.io/ssh-auth</code> 用來存放 SSH 身份認證中所需要的憑據。使用這種 Secret 類型時，你就必須在其 <code>data</code> （或 <code>stringData</code>） 字段中提供一個 <code>ssh-privatekey</code> 鍵值對，作為要使用的 SSH 憑據。</p> <p>下面的清單是一個 SSH 公鑰/私鑰身份認證的 Secret 示例：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-43-1 id=__codelineno-43-1 name=__codelineno-43-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-43-2 id=__codelineno-43-2 name=__codelineno-43-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-43-3 id=__codelineno-43-3 name=__codelineno-43-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-43-4 id=__codelineno-43-4 name=__codelineno-43-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-ssh-auth</span><span class=w></span>
<a href=#__codelineno-43-5 id=__codelineno-43-5 name=__codelineno-43-5></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/ssh-auth</span><span class=w></span>
<a href=#__codelineno-43-6 id=__codelineno-43-6 name=__codelineno-43-6></a><span class=nt>data</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-43-7 id=__codelineno-43-7 name=__codelineno-43-7></a><span class=w>  </span><span class=c1># 此例中的數據被截斷</span><span class=w></span>
<a href=#__codelineno-43-8 id=__codelineno-43-8 name=__codelineno-43-8></a><span class=w>  </span><span class=nt>ssh-privatekey</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-43-9 id=__codelineno-43-9 name=__codelineno-43-9></a><span class=w>          </span><span class=no>MIIEpQIBAAKCAQEAulqb/Y ...</span><span class=w></span>
</code></pre></div> <p>提供 SSH 身份認證類型的 Secret 僅僅是出於用戶方便性考慮。你也可以使用 Opaque 類型來保存用於 SSH 身份認證的憑據。不過，使用預定義的、公開的 Secret 類型（ <code>kubernetes.io/ssh-auth</code>） 有助於其他人理解你的 Secret 的用途，也可以就其中包含的主鍵名形成約定。 API 服務器確實會檢查 Secret 配置中是否提供了所需要的主鍵。</p> <h3 id=tls-secret>TLS Secret<a class=headerlink href=#tls-secret title="Permanent link">¶</a></h3> <p>Kubernetes 提供一種內置的 <code>kubernetes.io/tls</code> Secret 類型，用來存放 TLS 場合通常要使用的證書及其相關密鑰。 TLS Secret 的一種典型用法是為 Ingress 資源配置傳輸過程中的數據加密，不過也可以用於其他資源或者直接在負載中使用。當使用此類型的 Secret 時，Secret 配置中的 <code>data</code> （或 <code>stringData</code>）字段必須包含 <code>tls.key</code> 和 <code>tls.crt</code> 主鍵，儘管 API 服務器實際上並不會對每個鍵的取值作進一步的合法性檢查。`</p> <p>下面的 YAML 包含一個 TLS Secret 的配置示例：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-44-1 id=__codelineno-44-1 name=__codelineno-44-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-44-2 id=__codelineno-44-2 name=__codelineno-44-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-44-3 id=__codelineno-44-3 name=__codelineno-44-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-44-4 id=__codelineno-44-4 name=__codelineno-44-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secret-tls</span><span class=w></span>
<a href=#__codelineno-44-5 id=__codelineno-44-5 name=__codelineno-44-5></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/tls</span><span class=w></span>
<a href=#__codelineno-44-6 id=__codelineno-44-6 name=__codelineno-44-6></a><span class=nt>data</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-44-7 id=__codelineno-44-7 name=__codelineno-44-7></a><span class=w>  </span><span class=c1># 此例中的數據被截斷</span><span class=w></span>
<a href=#__codelineno-44-8 id=__codelineno-44-8 name=__codelineno-44-8></a><span class=w>  </span><span class=nt>tls.crt</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-44-9 id=__codelineno-44-9 name=__codelineno-44-9></a><span class=w>        </span><span class=no>MIIC2DCCAcCgAwIBAgIBATANBgkqh ...</span><span class=w></span>
<a href=#__codelineno-44-10 id=__codelineno-44-10 name=__codelineno-44-10></a><span class=w>  </span><span class=nt>tls.key</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<a href=#__codelineno-44-11 id=__codelineno-44-11 name=__codelineno-44-11></a><span class=w>        </span><span class=no>MIIEpgIBAAKCAQEA7yn3bRHQ5FHMQ ...</span><span class=w></span>
</code></pre></div> <p>提供 TLS 類型的 Secret 僅僅是出於用戶方便性考慮。你也可以使用 Opaque 類型來保存用於 TLS 服務器與/或客戶端的憑據。不過，使用內置的 Secret 類型的有助於對憑據格式進行歸一化處理，並且 API 服務器確實會檢查 Secret 配置中是否提供了所需要的主鍵。</p> <p>當使用 <code>kubectl</code> 來創建 TLS Secret 時，你可以像下面的例子一樣使用 tls 子命令：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-45-1 id=__codelineno-45-1 name=__codelineno-45-1></a>kubectl create secret tls my-tls-secret <span class=se>\</span>
<a href=#__codelineno-45-2 id=__codelineno-45-2 name=__codelineno-45-2></a>  --cert<span class=o>=</span>path/to/cert/file <span class=se>\</span>
<a href=#__codelineno-45-3 id=__codelineno-45-3 name=__codelineno-45-3></a>  --key<span class=o>=</span>path/to/key/file
</code></pre></div> <p>這裡的公鑰/私鑰對都必須事先已存在。用於 <code>--cert</code> 的公鑰證書必須是 <a href=https://datatracker.ietf.org/doc/html/rfc7468#section-5.1>RFC 7468 中 5.1 節</a> 中所規定的 DER 格式，且與 <code>--key</code> 所給定的私鑰匹配。私鑰必須是 DER 格式的 PKCS <a class="magiclink magiclink-github magiclink-issue" href=https://github.com/squidfunk/mkdocs-material/issues/8 title="GitHub Issue: squidfunk/mkdocs-material #8">#8</a> （參見 <a href=https://datatracker.ietf.org/doc/html/rfc7468#section-11>RFC 7468 第 11節</a>）。</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>說明： 類型為 <code>kubernetes.io/tls</code> 的 Secret 中包含密鑰和證書的 DER 數據，以 Base64 格式編碼。如果你熟悉私鑰和證書的 PEM 格式，base64 與該格式相同，只是你需要略過 PEM 數據中所包含的第一行和最後一行。</p> <p>例如，對於證書而言，你 不要 包含 --------BEGIN CERTIFICATE----- 和 -------END CERTIFICATE---- 這兩行。</p> </div> <h3 id=secret_19>啟動引導令牌 Secret<a class=headerlink href=#secret_19 title="Permanent link">¶</a></h3> <p>通過將 Secret 的 type 設置為 <code>bootstrap.kubernetes.io/token</code> 可以創建啟動引導令牌類型的 Secret。這種類型的 Secret 被設計用來支持節點的啟動引導過程。其中包含用來為周知的 ConfigMap 簽名的令牌。</p> <p>啟動引導令牌 Secret 通常創建於 <code>kube-system</code> 名字空間內，並以 <code>bootstrap-token-&lt;令牌 ID&gt;</code> 的形式命名； 其中 <code>&lt;令牌 ID&gt;</code> 是一個由 6 個字符組成的字符串，用作令牌的標識。</p> <p>以 Kubernetes 清單文件的形式，某啟動引導令牌 Secret 可能看起來像下面這樣：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-46-1 id=__codelineno-46-1 name=__codelineno-46-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-46-2 id=__codelineno-46-2 name=__codelineno-46-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-46-3 id=__codelineno-46-3 name=__codelineno-46-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-46-4 id=__codelineno-46-4 name=__codelineno-46-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap-token-5emitj</span><span class=w></span>
<a href=#__codelineno-46-5 id=__codelineno-46-5 name=__codelineno-46-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span><span class=w></span>
<a href=#__codelineno-46-6 id=__codelineno-46-6 name=__codelineno-46-6></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap.kubernetes.io/token</span><span class=w></span>
<a href=#__codelineno-46-7 id=__codelineno-46-7 name=__codelineno-46-7></a><span class=nt>data</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-46-8 id=__codelineno-46-8 name=__codelineno-46-8></a><span class=w>  </span><span class=nt>auth-extra-groups</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">c3lzdGVtOmJvb3RzdHJhcHBlcnM6a3ViZWFkbTpkZWZhdWx0LW5vZGUtdG9rZW4=</span><span class=w></span>
<a href=#__codelineno-46-9 id=__codelineno-46-9 name=__codelineno-46-9></a><span class=w>  </span><span class=nt>expiration</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MjAyMC0wOS0xM1QwNDozOToxMFo=</span><span class=w></span>
<a href=#__codelineno-46-10 id=__codelineno-46-10 name=__codelineno-46-10></a><span class=w>  </span><span class=nt>token-id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NWVtaXRq</span><span class=w></span>
<a href=#__codelineno-46-11 id=__codelineno-46-11 name=__codelineno-46-11></a><span class=w>  </span><span class=nt>token-secret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">a3E0Z2lodnN6emduMXAwcg==</span><span class=w></span>
<a href=#__codelineno-46-12 id=__codelineno-46-12 name=__codelineno-46-12></a><span class=w>  </span><span class=nt>usage-bootstrap-authentication</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dHJ1ZQ==</span><span class=w></span>
<a href=#__codelineno-46-13 id=__codelineno-46-13 name=__codelineno-46-13></a><span class=w>  </span><span class=nt>usage-bootstrap-signing</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dHJ1ZQ==</span><span class=w></span>
</code></pre></div> <p>啟動引導令牌類型的 Secret 會在 <code>data</code> 字段中包含如下主鍵：</p> <ul> <li><code>token-id</code>：由 6 個隨機字符組成的字符串，作為令牌的標識符。必需。</li> <li><code>token-secret</code>：由 16 個隨機字符組成的字符串，包含實際的令牌機密。必需。</li> <li><code>description</code>：供用戶閱讀的字符串，描述令牌的用途。可選。</li> <li><code>expiration</code>：一個使用 RFC3339 來編碼的 UTC 絕對時間，給出令牌要過期的時間。可選。</li> <li><code>usage-bootstrap-&lt;usage&gt;</code>：布爾類型的標誌，用來標明啟動引導令牌的其他用途。</li> <li><code>auth-extra-groups</code>：用逗號分隔的組名列表，身份認證時除被認證為 <code>system:bootstrappers</code> 組之外，還會被添加到所列的用戶組中。</li> </ul> <p>上面的 YAML 文件可能看起來令人費解，因為其中的數值均為 base64 編碼的字符串。實際上，你完全可以使用下面的 YAML 來創建一個一模一樣的 Secret：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-47-1 id=__codelineno-47-1 name=__codelineno-47-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-47-2 id=__codelineno-47-2 name=__codelineno-47-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-47-3 id=__codelineno-47-3 name=__codelineno-47-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-47-4 id=__codelineno-47-4 name=__codelineno-47-4></a><span class=w>  </span><span class=c1># 注意 Secret 的命名方式</span><span class=w></span>
<a href=#__codelineno-47-5 id=__codelineno-47-5 name=__codelineno-47-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap-token-5emitj</span><span class=w></span>
<a href=#__codelineno-47-6 id=__codelineno-47-6 name=__codelineno-47-6></a><span class=w>  </span><span class=c1># 啟動引導令牌 Secret 通常位於 kube-system 名字空間</span><span class=w></span>
<a href=#__codelineno-47-7 id=__codelineno-47-7 name=__codelineno-47-7></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span><span class=w></span>
<a href=#__codelineno-47-8 id=__codelineno-47-8 name=__codelineno-47-8></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap.kubernetes.io/token</span><span class=w></span>
<a href=#__codelineno-47-9 id=__codelineno-47-9 name=__codelineno-47-9></a><span class=nt>stringData</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-47-10 id=__codelineno-47-10 name=__codelineno-47-10></a><span class=w>  </span><span class=nt>auth-extra-groups</span><span class=p>:</span><span class=w> </span><span class=s>"system:bootstrappers:kubeadm:default-node-token"</span><span class=w></span>
<a href=#__codelineno-47-11 id=__codelineno-47-11 name=__codelineno-47-11></a><span class=w>  </span><span class=nt>expiration</span><span class=p>:</span><span class=w> </span><span class=s>"2020-09-13T04:39:10Z"</span><span class=w></span>
<a href=#__codelineno-47-12 id=__codelineno-47-12 name=__codelineno-47-12></a><span class=w>  </span><span class=c1># 此令牌 ID 被用於生成 Secret 名稱</span><span class=w></span>
<a href=#__codelineno-47-13 id=__codelineno-47-13 name=__codelineno-47-13></a><span class=w>  </span><span class=nt>token-id</span><span class=p>:</span><span class=w> </span><span class=s>"5emitj"</span><span class=w></span>
<a href=#__codelineno-47-14 id=__codelineno-47-14 name=__codelineno-47-14></a><span class=w>  </span><span class=nt>token-secret</span><span class=p>:</span><span class=w> </span><span class=s>"kq4gihvszzgn1p0r"</span><span class=w></span>
<a href=#__codelineno-47-15 id=__codelineno-47-15 name=__codelineno-47-15></a><span class=w>  </span><span class=c1># 此令牌還可用於 authentication （身份認證）</span><span class=w></span>
<a href=#__codelineno-47-16 id=__codelineno-47-16 name=__codelineno-47-16></a><span class=w>  </span><span class=nt>usage-bootstrap-authentication</span><span class=p>:</span><span class=w> </span><span class=s>"true"</span><span class=w></span>
<a href=#__codelineno-47-17 id=__codelineno-47-17 name=__codelineno-47-17></a><span class=w>  </span><span class=c1># 且可用於 signing （證書籤名）</span><span class=w></span>
<a href=#__codelineno-47-18 id=__codelineno-47-18 name=__codelineno-47-18></a><span class=w>  </span><span class=nt>usage-bootstrap-signing</span><span class=p>:</span><span class=w> </span><span class=s>"true"</span><span class=w></span>
</code></pre></div> <h3 id=secret_20>不可更改的 Secret<a class=headerlink href=#secret_20 title="Permanent link">¶</a></h3> <p>Kubernetes 允許你將特定的 Secret（和 ConfigMap）標記為 不可更改（Immutable）。禁止更改現有 Secret 的數據有下列好處：</p> <p>防止意外（或非預期的）更新導致應用程序中斷 （對於大量使用 Secret 的集群而言，至少數万個不同的 Secret 供 Pod 掛載）， 通過將 Secret 標記為不可變，可以極大降低 kube-apiserver 的負載，提升集群性能。 <code>kubelet</code> 不需要監視那些被標記為不可更改的 Secret。</p> <h3 id=secret_21>將 Secret 標記為不可更改<a class=headerlink href=#secret_21 title="Permanent link">¶</a></h3> <p>你可以通過將 Secret 的 <code>immutable</code> 字段設置為 <code>true</code> 創建不可更改的 Secret。例如：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-48-1 id=__codelineno-48-1 name=__codelineno-48-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a href=#__codelineno-48-2 id=__codelineno-48-2 name=__codelineno-48-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a href=#__codelineno-48-3 id=__codelineno-48-3 name=__codelineno-48-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-48-4 id=__codelineno-48-4 name=__codelineno-48-4></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class=w></span>
<a href=#__codelineno-48-5 id=__codelineno-48-5 name=__codelineno-48-5></a><span class=nt>data</span><span class=p>:</span><span class=w></span>
<a href=#__codelineno-48-6 id=__codelineno-48-6 name=__codelineno-48-6></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class=w></span>
<a href=#__codelineno-48-7 id=__codelineno-48-7 name=__codelineno-48-7></a><span class=nt>immutable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
</code></pre></div> <p>你也可以更改現有的 Secret，令其不可更改。</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>說明： 一旦一個 Secret 或 ConfigMap 被標記為不可更改，撤銷此操作或者更改 data 字段的內容都是 不 可能的。只能刪除並重新創建這個 Secret。現有的 Pod 將維持對已刪除 Secret 的掛載點 -- 建議重新創建這些 Pod。</p> </div> <h2 id=secret_22>Secret 的信息安全問題<a class=headerlink href=#secret_22 title="Permanent link">¶</a></h2> <p>儘管 ConfigMap 和 Secret 的工作方式類似，但 Kubernetes 對 Secret 有一些額外的保護。</p> <p>Secret 通常保存重要性各異的數值，其中很多都可能會導致 Kubernetes 中 （例如，服務賬號令牌）或對外部系統的特權提升。即使某些個別應用能夠推導它期望使用的 Secret 的能力， 同一名字空間中的其他應用可能會讓這種假定不成立。</p> <p>只有當某個節點上的 Pod 需要某 Secret 時，對應的 Secret 才會被發送到該節點上。如果將 Secret 掛載到 Pod 中，kubelet 會將數據的副本保存在在 tmpfs 中， 這樣機密的數據不會被寫入到持久性存儲中。一旦依賴於該 Secret 的 Pod 被刪除，kubelet 會刪除來自於該 Secret 的機密數據的本地副本。</p> <p>同一個 Pod 中可能包含多個容器。默認情況下，你所定義的容器只能訪問默認 ServiceAccount 及其相關 Secret。你必須顯式地定義環境變量或者將捲映射到容器中，才能為容器提供對其他 Secret 的訪問。</p> <p>針對同一節點上的多個 Pod 可能有多個 Secret。不過，只有某個 Pod 所請求的 Secret 才有可能對 Pod 中的容器可見。因此，一個 Pod 不會獲得訪問其他 Pod 的 Secret 的權限。</p> <h3 id=_5>針對開發人員的安全性建議<a class=headerlink href=#_5 title="Permanent link">¶</a></h3> <ul> <li>應用在從環境變量或卷中讀取了機密信息內容之後仍要對其進行保護。例如， 你的應用應該避免用明文的方式將 Secret 數據寫入日誌，或者將其傳遞給不可信的第三方。</li> <li>如果你在一個 Pod 中定義了多個容器，而只有一個容器需要訪問某 Secret， 定義卷掛載或環境變量配置時，應確保其他容器無法訪問該 Secret。</li> <li>如果你通過清單來配置某 Secret， Secret 數據以 Base64 的形式編碼，將此文件共享，或者將其檢入到某源碼倉庫， 都意味著 Secret 對於任何可以讀取清單的人都是可見的。 Base64 - 編碼 不是 一種加密方法，與明文相比沒有任何安全性提升。</li> <li>部署與 Secret API 交互的應用時，你應該使用 <a href=https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/ >RBAC</a> 這類<a href=https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authorization/ >鑑權策略</a>來限制訪問。</li> <li>在 Kubernetes API 中，名字空間內對 Secret 對象的 <code>watch</code> 和 <code>list</code> 請求是非常強大的能力。在可能的時候應該避免授予這類訪問權限，因為通過列舉 Secret， 客戶端能夠查看對應名字空間內所有 Secret 的取值。</li> </ul> <h3 id=_6>針對集群管理員的安全性建議<a class=headerlink href=#_6 title="Permanent link">¶</a></h3> <ul> <li>保留（使用 Kubernetes API）對集群中所有 Secret 對象執行 <code>watch</code> 或 <code>list</code> 操作的能力， 這樣只有特權級最高、系統級別的組件能夠執行這類操作。</li> <li>在部署需要通過 Secret API 交互的應用時，你應該通過使用 RBAC 這類鑑權策略來限制訪問。</li> <li>在 API 服務器上，對象（包括 Secret）會被持久化到 etcd 中； 因此：<ul> <li>只應准許集群管理員訪問 etcd（包括只讀訪問）；</li> <li>為 Secret 對象啟用<a href=https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/encrypt-data/ >靜態加密</a>， 這樣這些 Secret 的數據就不會以明文的形式保存到 etcd 中；</li> <li>當 etcd 的持久化存儲不再被使用時，請考慮徹底擦除存儲介質；</li> <li>如果存在多個 etcd 實例，請確保 etcd 使用 SSL/TLS 來完成其對等通信。</li> </ul> </li> </ul> </article> </div> </div> <a class="md-top md-icon" data-md-component=top hidden href=#> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </a> </main> <footer class=md-footer> <nav aria-label=Footer class="md-footer__inner md-grid"> <a aria-label="Previous: ConfigMap" class="md-footer__link md-footer__link--prev" href=../configmap/ rel=prev> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> ConfigMap </div> </div> </a> <a aria-label="Next: 日誌架構" class="md-footer__link md-footer__link--next" href=../../11-cluster-adm/logging/ rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> 日誌架構 </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.6c7ad80a.min.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "width": "100%", "height": "auto", "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body> </html>