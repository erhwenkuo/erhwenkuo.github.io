<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=../../../../assets/favicon.png rel=icon><meta content="mkdocs-1.3.1, mkdocs-material-8.3.9" name=generator><title>用 HTTP 客戶端調用 K8S API - Tech Learning</title><link href=../../../../assets/stylesheets/main.1d29e8d0.min.css rel=stylesheet><link href=../../../../assets/stylesheets/palette.cbb835fc.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>html.glightbox-open { overflow: initial; height: 100%; }</style><script src=../../../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent=red data-md-color-primary=indigo data-md-color-scheme=default dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#http-kubernetes-api> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Tech Learning" class="md-header__button md-logo" data-md-component=logo href=../../../.. title="Tech Learning"> <svg viewbox="0 0 89 89" xmlns=http://www.w3.org/2000/svg> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z></path> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"></path> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z></path> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"></path> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tech Learning </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 用 HTTP 客戶端調用 K8S API </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=red data-md-color-media data-md-color-primary=indigo data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=brown data-md-color-scheme=slate id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <a aria-label=Share class="md-search__icon md-icon" data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg> </a> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a class=md-tabs__link href=../../../..> Home </a> </li> <li class=md-tabs__item> <a href=../../../01-getting-started/learning-env/k3d/k3s-kubernetes-cluster-setup-with-k3d/ class="md-tabs__link md-tabs__link--active"> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../../argocd/tutorial/ class=md-tabs__link> ArgoCD </a> </li> <li class=md-tabs__item> <a href=../../../../vault/docs/auth/overview/ class=md-tabs__link> Vault </a> </li> <li class=md-tabs__item> <a href=../../../../ansible/vagrant-intro/ class=md-tabs__link> Ansible </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Tech Learning" class="md-nav__button md-logo" data-md-component=logo href=../../../.. title="Tech Learning"> <svg viewbox="0 0 89 89" xmlns=http://www.w3.org/2000/svg> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z></path> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"></path> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z></path> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"></path> </svg> </a> Tech Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 id=__nav_1 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../..>Home</a> <label for=__nav_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label=Home class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 id=__nav_1_2 type=checkbox> <label class=md-nav__link for=__nav_1_2> Networking Basics <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Networking Basics" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Networking Basics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../networking/cidr/cidr-intro/ class=md-nav__link> 無類別區隔路由 CIDR </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_3 id=__nav_1_3 type=checkbox> <label class=md-nav__link for=__nav_1_3> YAML <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=YAML class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> YAML </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../yaml/yaml-intro/ class=md-nav__link> YAML 入門教程 </a> </li> <li class=md-nav__item> <a href=../../../../yaml/yaml-tutorial/ class=md-nav__link> Learn YAML </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_4 id=__nav_1_4 type=checkbox> <label class=md-nav__link for=__nav_1_4> CI/CD <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=CI/CD class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_1_4> <span class="md-nav__icon md-icon"></span> CI/CD </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cicd/gitops/ class=md-nav__link> GitOps 的概念 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Kubernetes class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1 id=__nav_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_1> Getting started <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Getting started" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Getting started </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_1 id=__nav_2_1_1 type=checkbox> <label class=md-nav__link for=__nav_2_1_1> 學習環境 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=學習環境 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_1_1> <span class="md-nav__icon md-icon"></span> 學習環境 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_1_1 id=__nav_2_1_1_1 type=checkbox> <label class=md-nav__link for=__nav_2_1_1_1> K3D <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=K3D class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_2_1_1_1> <span class="md-nav__icon md-icon"></span> K3D </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../01-getting-started/learning-env/k3d/k3s-kubernetes-cluster-setup-with-k3d/ class=md-nav__link> 使用 K3D 設置 Kubernetes 集群 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_1_2 id=__nav_2_1_1_2 type=checkbox> <label class=md-nav__link for=__nav_2_1_1_2> Minikube <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Minikube class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_2_1_1_2> <span class="md-nav__icon md-icon"></span> Minikube </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../01-getting-started/learning-env/minikube/how-to-install-minikube-on-ubuntu/ class=md-nav__link> 如何在 Ubuntu 20.04 上安裝 Minikube </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 id=__nav_2_2 type=checkbox> <label class=md-nav__link for=__nav_2_2> Concepts <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Concepts class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_1 id=__nav_2_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_2_1> 概述 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=概述 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_2_1> <span class="md-nav__icon md-icon"></span> 概述 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../02-concepts/01-overview/k8s-intro/ class=md-nav__link> K8S 介詔 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_2 id=__nav_2_2_2 type=checkbox> <label class=md-nav__link for=__nav_2_2_2> 集群架構 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=集群架構 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> 集群架構 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../02-concepts/02-cluster-architecture/k8s-architecture/ class=md-nav__link> K8S 架構解析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_3 id=__nav_2_2_3 type=checkbox> <label class=md-nav__link for=__nav_2_2_3> Serivce, 負載均衡與網路 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Serivce, 負載均衡與網路" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_2_3> <span class="md-nav__icon md-icon"></span> Serivce, 負載均衡與網路 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../02-concepts/05-svc-lb-network/k8s-network-intro/ class=md-nav__link> K8S 網絡通信介紹 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_4 id=__nav_2_2_4 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../02-concepts/06-storage/ >存儲</a> </div> <nav aria-label=存儲 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_2_4> <span class="md-nav__icon md-icon"></span> 存儲 </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_5 id=__nav_2_2_5 type=checkbox> <label class=md-nav__link for=__nav_2_2_5> 配置 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=配置 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_2_5> <span class="md-nav__icon md-icon"></span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../02-concepts/07-configuration/overview/ class=md-nav__link> 配置最佳實踐 </a> </li> <li class=md-nav__item> <a href=../../../02-concepts/07-configuration/configmap/ class=md-nav__link> ConfigMap </a> </li> <li class=md-nav__item> <a href=../../../02-concepts/07-configuration/secret/ class=md-nav__link> Secret </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 id=__nav_2_3 type=checkbox> <label class=md-nav__link for=__nav_2_3> Tasks <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Tasks class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Tasks </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3_1 id=__nav_2_3_1 type=checkbox> <label class=md-nav__link for=__nav_2_3_1> 管理 Kubernetes 对象 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="管理 Kubernetes 对象" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_3_1> <span class="md-nav__icon md-icon"></span> 管理 Kubernetes 对象 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../03-tasks/manage-kubernetes-objects/kustomization/ class=md-nav__link> 使用 Kustomize 對 Kubernetes 對象進行聲明式管理 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 id=__nav_2_4 type=checkbox> <label class=md-nav__link for=__nav_2_4> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Tutorials class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../04-tutorials/hello-k3d/ class=md-nav__link> 你好, K3D </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4_2 id=__nav_2_4_2 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../04-tutorials/kubernetes-basics/ >學習 Kubernetes 基礎知識</a> <label for=__nav_2_4_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label="學習 Kubernetes 基礎知識" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_4_2> <span class="md-nav__icon md-icon"></span> 學習 Kubernetes 基礎知識 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/create-cluster/ class=md-nav__link> 創建集群 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/deploy-app/ class=md-nav__link> 部署應用 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/explore/ class=md-nav__link> 了解應用 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/expose/ class=md-nav__link> 公開曝露應用 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/scale/ class=md-nav__link> 縮放你的應用 </a> </li> <li class=md-nav__item> <a href=../../../04-tutorials/kubernetes-basics/update/ class=md-nav__link> 更新你的應用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4_3 id=__nav_2_4_3 type=checkbox> <label class=md-nav__link for=__nav_2_4_3> 配置 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=配置 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_4_3> <span class="md-nav__icon md-icon"></span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../04-tutorials/configuration/configmap-secrets/ class=md-nav__link> ConfigMap 與 Secret </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4_4 id=__nav_2_4_4 type=checkbox> <label class=md-nav__link for=__nav_2_4_4> 存儲 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=存儲 class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_4_4> <span class="md-nav__icon md-icon"></span> 存儲 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../04-tutorials/volume/volume-pv-pvc/ class=md-nav__link> 存儲管理 volume、PV/PVC </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_5 id=__nav_2_5 type=checkbox> <label class=md-nav__link for=__nav_2_5> Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Reference class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_5_1 id=__nav_2_5_1 type=checkbox> <label class=md-nav__link for=__nav_2_5_1> API 概述 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="API 概述" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_5_1> <span class="md-nav__icon md-icon"></span> API 概述 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../working-with-k8s-api/ class=md-nav__link> 使用 K8S API </a> </li> <li class=md-nav__item> <a href=../kubernetes-api-structure-and-terminology/ class=md-nav__link> K8S API 基礎 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> 用 HTTP 客戶端調用 K8S API <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 用 HTTP 客戶端調用 K8S API </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#setting-up-kubernetes-playground> Setting up Kubernetes playground </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-get-kubernetes-api-host-and-port> How to get Kubernetes API host and port </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-call-kubernetes-api-using-curl> How to call Kubernetes API using curl </a> <nav aria-label="How to call Kubernetes API using curl" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#authenticating-api-server-to-client> Authenticating API server to client </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#authenticating-using-certificates> Authenticating using Certificates </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#authenticating-using-service-account-tokens> Authenticating using Service Account Tokens </a> <nav aria-label="Authenticating using Service Account Tokens" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#call-kubernetes-api-inside-a-pod> Call Kubernetes API inside a Pod </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#creat-read-watch-update-patch-and-delete-objects> Creat, Read, Watch, Update, Patch, and Delete objects </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-call-kubernetes-api-using-kubectl> How to call Kubernetes API using kubectl </a> <nav aria-label="How to call Kubernetes API using kubectl" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#calling-kubernetes-api-using-kubectl-proxy> Calling Kubernetes API using kubectl proxy </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#calling-kubernetes-api-using-kubectl-raw-mode> Calling Kubernetes API using kubectl raw mode </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#wrapping-up> Wrapping up </a> <nav aria-label="Wrapping up" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#resources> Resources </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_5_2 id=__nav_2_5_2 type=checkbox> <label class=md-nav__link for=__nav_2_5_2> API 存取權限控制 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="API 存取權限控制" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_5_2> <span class="md-nav__icon md-icon"></span> API 存取權限控制 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../access-authn-authz/rbac-intro/ class=md-nav__link> Kubernetes RBAC 介詔 </a> </li> <li class=md-nav__item> <a href=../../access-authn-authz/k8s-authorization-of-sa-with-rbac/ class=md-nav__link> 使用 RBAC 設置服務帳戶權限 </a> </li> <li class=md-nav__item> <a href=../../access-authn-authz/k8s-sa-jwt-rbac/ class=md-nav__link> ServiceAccounts、JWT-tokens、身份驗證和 RBAC 授權 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6 id=__nav_2_6 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../package/ >Tools</a> <label for=__nav_2_6> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label=Tools class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6_2 id=__nav_2_6_2 type=checkbox> <label class=md-nav__link for=__nav_2_6_2> Packaging 管理 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Packaging 管理" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_6_2> <span class="md-nav__icon md-icon"></span> Packaging 管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6_2_1 id=__nav_2_6_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_6_2_1> Helm <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Helm class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_2_6_2_1> <span class="md-nav__icon md-icon"></span> Helm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../package/helm-intro/ class=md-nav__link> Helm 入門教學 </a> </li> <li class=md-nav__item> <a href=../../../package/helm-app-deploy/ class=md-nav__link> K8S 應用部署之 Helm 初探 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6_3 id=__nav_2_6_3 type=checkbox> <label class=md-nav__link for=__nav_2_6_3> Config 管理 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Config 管理" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_6_3> <span class="md-nav__icon md-icon"></span> Config 管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6_3_1 id=__nav_2_6_3_1 type=checkbox> <label class=md-nav__link for=__nav_2_6_3_1> Kustomize <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Kustomize class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_2_6_3_1> <span class="md-nav__icon md-icon"></span> Kustomize </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../package/helm-intro/ class=md-nav__link> Kustomize 入門教學 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 id=__nav_3 type=checkbox> <label class=md-nav__link for=__nav_3> ArgoCD <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=ArgoCD class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ArgoCD </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 id=__nav_3_1 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../../argocd/tutorial/ >ArgoCD 教程</a> <label for=__nav_3_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label="ArgoCD 教程" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> ArgoCD 教程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../argocd/tutorial/01-setup/ class=md-nav__link> ArgoCD 安裝設定 </a> </li> <li class=md-nav__item> <a href=../../../../argocd/tutorial/02-getting_started/ class=md-nav__link> ArgoCD 入門 </a> </li> <li class=md-nav__item> <a href=../../../../argocd/tutorial/03-kustomize/ class=md-nav__link> Kustomize </a> </li> <li class=md-nav__item> <a href=../../../../argocd/tutorial/04-syncwaves-hooks/ class=md-nav__link> SyncWaves 與 Hooks </a> </li> <li class=md-nav__item> <a href=../../../../argocd/tutorial/argo-cd-applicationset-controller/ class=md-nav__link> ApplicationSet 控制器 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 id=__nav_3_2 type=checkbox> <label class=md-nav__link for=__nav_3_2> ArgoCD 插件 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="ArgoCD 插件" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> ArgoCD 插件 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../argocd/argocd-vault-plugin/secret-management-argocd-vault/ class=md-nav__link> 使用 Argo CD Vault 插件進行 Secret 管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 id=__nav_3_3 type=checkbox> <label class=md-nav__link for=__nav_3_3> ApplicationSet Controller <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="ApplicationSet Controller" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> ApplicationSet Controller </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../argocd/applicationset/intro/ class=md-nav__link> 簡介 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4> Vault <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Vault class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Vault </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1 id=__nav_4_1 type=checkbox> <label class=md-nav__link for=__nav_4_1> Docs <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Docs class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1_1 id=__nav_4_1_1 type=checkbox> <label class=md-nav__link for=__nav_4_1_1> Auth Methods <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Auth Methods" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_1_1> <span class="md-nav__icon md-icon"></span> Auth Methods </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../vault/docs/auth/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../../vault/docs/auth/kubernetes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../../vault/docs/auth/userpass/ class=md-nav__link> Username &amp; Password </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1_2 id=__nav_4_1_2 type=checkbox> <label class=md-nav__link for=__nav_4_1_2> Platform <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Platform class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_1_2> <span class="md-nav__icon md-icon"></span> Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1_2_1 id=__nav_4_1_2_1 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../../vault/docs/platform/ >Kubernetes</a> <label for=__nav_4_1_2_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-label=Kubernetes class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_4_1_2_1> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1_2_1_2 id=__nav_4_1_2_1_2 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../../vault/docs/platform/helm/ >Helm</a> </div> <nav aria-label=Helm class=md-nav data-md-level=5> <label class=md-nav__title for=__nav_4_1_2_1_2> <span class="md-nav__icon md-icon"></span> Helm </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 id=__nav_4_2 type=checkbox> <label class=md-nav__link for=__nav_4_2> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Tutorials class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2_1 id=__nav_4_2_1 type=checkbox> <label class=md-nav__link for=__nav_4_2_1> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Kubernetes class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_2_1> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../vault/kubernetes/kubernetes-sidecar/ class=md-nav__link> 通過 Vault Agent 容器將 Secret 注入 Kubernetes Pod </a> </li> <li class=md-nav__item> <a href=../../../../vault/kubernetes/kubernetes-secret-store-driver/ class=md-nav__link> 通過容器存儲接口 (CSI) 掛載 Vault Secret </a> </li> <li class=md-nav__item> <a href=../../../../vault/kubernetes/agent-kubernetes/ class=md-nav__link> Vault Agent 與 Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../../vault/kubernetes/kubernetes-external-vault/ class=md-nav__link> Kubernetes 與外部 Vault 整合 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 id=__nav_5 type=checkbox> <label class=md-nav__link for=__nav_5> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Ansible class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_1 id=__nav_5_1 type=checkbox> <label class=md-nav__link for=__nav_5_1> 快速入門 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=快速入門 class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 快速入門 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ansible/vagrant-intro/ class=md-nav__link> Vagrant 快速入門 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/ansible-intro/ class=md-nav__link> Ansible 快速入門 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/ansible-cheatsheet/ class=md-nav__link> Ansible 使用指南 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_2 id=__nav_5_2 type=checkbox> <label class=md-nav__link for=__nav_5_2> Ansible Playbook 撰寫 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Ansible Playbook 撰寫" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Ansible Playbook 撰寫 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/creating-and-running-your-first-ansible-playbook/ class=md-nav__link> 如何創建與運行 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-define-tasks-in-ansible-playbooks/ class=md-nav__link> 如何定義任務 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-use-variables-in-ansible-playbooks/ class=md-nav__link> 如何使用變量 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-access-system-information-facts-in-ansible-playbooks/ class=md-nav__link> 如何訪問系統信息 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-use-conditionals-in-ansible-playbooks/ class=md-nav__link> 如何使用條件 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-use-loops-in-ansible-playbooks/ class=md-nav__link> 如何使用循環 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/understanding-privilege-escalation-in-ansible-playbooks/ class=md-nav__link> 了解權限提升 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-install-and-manage-system-packages-in-ansible-playbooks/ class=md-nav__link> 如何安裝和管理系統包 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-create-and-use-templates-in-ansible-playbooks/ class=md-nav__link> 如何創建和使用模板 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-define-and-use-handlers-in-ansible-playbooks/ class=md-nav__link> 如何定義和使用處理程序 </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_playbook/how-to-deploy-a-static-html-website-with-ansible-on-ubuntu-20-04-nginx/ class=md-nav__link> 如何使用Nginx部署靜態HTML網站 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_3 id=__nav_5_3 type=checkbox> <label class=md-nav__link for=__nav_5_3> Ansible AWX 教學 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Ansible AWX 教學" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> Ansible AWX 教學 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ansible/tutorial_awx/how-to-install-ansible-awx/ class=md-nav__link> 如何在 Ubuntu 20.04 上安裝 Ansible AWX </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial_awx/ansible-awx-guide-basic-usage-and-configuration/ class=md-nav__link> Ansible AWX 基本使用和配置 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_4 id=__nav_5_4 type=checkbox> <label class=md-nav__link for=__nav_5_4> 教學 <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=教學 class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 教學 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ansible/tutorial/ubuntu-insall-docker/ class=md-nav__link> 如何在 Ubuntu 20.04 上安裝 Docker </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial/ansible-install-docker/ class=md-nav__link> 如何使用 Ansible 在 Ubuntu 20.04 上安裝和設置 Docker </a> </li> <li class=md-nav__item> <a href=../../../../ansible/tutorial/how-to-install-and-configure-ansible-on-ubuntu-22-04/ class=md-nav__link> 如何在 Ubuntu 22.04 上安裝和配置 Ansible </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#setting-up-kubernetes-playground> Setting up Kubernetes playground </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-get-kubernetes-api-host-and-port> How to get Kubernetes API host and port </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-call-kubernetes-api-using-curl> How to call Kubernetes API using curl </a> <nav aria-label="How to call Kubernetes API using curl" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#authenticating-api-server-to-client> Authenticating API server to client </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#authenticating-using-certificates> Authenticating using Certificates </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#authenticating-using-service-account-tokens> Authenticating using Service Account Tokens </a> <nav aria-label="Authenticating using Service Account Tokens" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#call-kubernetes-api-inside-a-pod> Call Kubernetes API inside a Pod </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#creat-read-watch-update-patch-and-delete-objects> Creat, Read, Watch, Update, Patch, and Delete objects </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-call-kubernetes-api-using-kubectl> How to call Kubernetes API using kubectl </a> <nav aria-label="How to call Kubernetes API using kubectl" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#calling-kubernetes-api-using-kubectl-proxy> Calling Kubernetes API using kubectl proxy </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#calling-kubernetes-api-using-kubectl-raw-mode> Calling Kubernetes API using kubectl raw mode </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#wrapping-up> Wrapping up </a> <nav aria-label="Wrapping up" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#resources> Resources </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=http-kubernetes-api>用 HTTP 客戶端調用 Kubernetes API<a class=headerlink href=#http-kubernetes-api title="Permanent link">¶</a></h1> <p>原文: <a href=https://iximiuz.com/en/posts/kubernetes-api-call-simple-http-client/ >https://iximiuz.com/en/posts/kubernetes-api-call-simple-http-client/</a></p> <p>使用 CLI（如 curl）或 GUI（如 postman）HTTP 客戶端調用 Kubernetes API 有很多使用情境。例如，您可能需要對 Kubernetes 對象進行比 kubectl 提供的更細粒度的控制，或者只是想在嘗試從代碼訪問 API 之前探索它。</p> <p>本文不僅僅是一個方便的命令列表，而是一個深思熟慮的演練，揭示了一些您在從命令行調用 Kubernetes API 時可能會偶然發現的有趣問題。它涵蓋以下主題：</p> <ul> <li>如何獲取 Kubernetes API 服務器地址</li> <li>如何向客戶端驗證 API 服務器</li> <li>如何使用證書 (certificate) 向 API 服務器驗證客戶端</li> <li>如何使用令牌 (token) 向 API 服務器驗證客戶端</li> <li>如何從 Pod 內部調用 Kubernetes API</li> <li>如何使用 curl 對 Kubernetes 對象執行基本的 CRUD 操作</li> <li>如何使用 kubectl 的 raw 模式直接訪問 Kubernetes API</li> <li>如何查看哪些 API 請求 kubectl 命令（如 apply 發送）</li> </ul> <p><a class=glightbox href=../assets/k8s-api-http-client.png><img alt src=../assets/k8s-api-http-client.png></a></p> <h2 id=setting-up-kubernetes-playground>Setting up Kubernetes playground<a class=headerlink href=#setting-up-kubernetes-playground title="Permanent link">¶</a></h2> <p>如果你沒有 Kubernetes 集群可以玩，這裡是你可以使用 <code>arkade</code> 快速創建本地遊樂場的方法：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>$ curl -sLS https://get.arkade.dev <span class=p>|</span> sudo sh
<a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a>$ arkade get minikube kubectl
<a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a>$ minikube start --profile cluster1
</code></pre></div> <h2 id=how-to-get-kubernetes-api-host-and-port>How to get Kubernetes API host and port<a class=headerlink href=#how-to-get-kubernetes-api-host-and-port title="Permanent link">¶</a></h2> <p>要調用任何 API，您首先需要知道其服務器地址。對於 Kubernetes，每個集群都有一個 API 服務器。因此，查找 API 主機和端口的最簡單方法是查看 kubectl cluster-info 輸出。例如，在我的 Vagrant 盒子上，它會產生以下訊息：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a>$ kubectl cluster-info
<a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a>Kubernetes control plane is running at https://192.168.49.2:8443
<a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a>CoreDNS is running at https://192.168.49.2:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
<a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a>...
</code></pre></div> <p><code>cluster-info</code> 命令顯示在<a href=https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/ >當前上下文</a>中選擇的集群的 API 地址。但是，如果您有多個集群怎麼辦？</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>$ kubectl config view
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>apiVersion: v1
<a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a>clusters:
<a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a>- cluster:
<a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a>    certificate-authority: /home/dxlab/.minikube/ca.crt
<a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a>    extensions:
<a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a>    - extension:
<a href=#__codelineno-2-9 id=__codelineno-2-9 name=__codelineno-2-9></a>        last-update: Tue, <span class=m>28</span> Jun <span class=m>2022</span> <span class=m>05</span>:55:10 CST
<a href=#__codelineno-2-10 id=__codelineno-2-10 name=__codelineno-2-10></a>        provider: minikube.sigs.k8s.io
<a href=#__codelineno-2-11 id=__codelineno-2-11 name=__codelineno-2-11></a>        version: v1.25.2
<a href=#__codelineno-2-12 id=__codelineno-2-12 name=__codelineno-2-12></a>      name: cluster_info
<a href=#__codelineno-2-13 id=__codelineno-2-13 name=__codelineno-2-13></a><span class=hll>    server: https://192.168.49.2:8443
</span><a href=#__codelineno-2-14 id=__codelineno-2-14 name=__codelineno-2-14></a>  name: minikube
<a href=#__codelineno-2-15 id=__codelineno-2-15 name=__codelineno-2-15></a>contexts:
<a href=#__codelineno-2-16 id=__codelineno-2-16 name=__codelineno-2-16></a>- context:
<a href=#__codelineno-2-17 id=__codelineno-2-17 name=__codelineno-2-17></a>    cluster: minikube
<a href=#__codelineno-2-18 id=__codelineno-2-18 name=__codelineno-2-18></a>    extensions:
<a href=#__codelineno-2-19 id=__codelineno-2-19 name=__codelineno-2-19></a>    - extension:
<a href=#__codelineno-2-20 id=__codelineno-2-20 name=__codelineno-2-20></a>        last-update: Tue, <span class=m>28</span> Jun <span class=m>2022</span> <span class=m>05</span>:55:10 CST
<a href=#__codelineno-2-21 id=__codelineno-2-21 name=__codelineno-2-21></a>        provider: minikube.sigs.k8s.io
<a href=#__codelineno-2-22 id=__codelineno-2-22 name=__codelineno-2-22></a>        version: v1.25.2
<a href=#__codelineno-2-23 id=__codelineno-2-23 name=__codelineno-2-23></a>      name: context_info
<a href=#__codelineno-2-24 id=__codelineno-2-24 name=__codelineno-2-24></a>    namespace: default
<a href=#__codelineno-2-25 id=__codelineno-2-25 name=__codelineno-2-25></a>    user: minikube
<a href=#__codelineno-2-26 id=__codelineno-2-26 name=__codelineno-2-26></a>  name: minikube
<a href=#__codelineno-2-27 id=__codelineno-2-27 name=__codelineno-2-27></a>current-context: minikube
<a href=#__codelineno-2-28 id=__codelineno-2-28 name=__codelineno-2-28></a>kind: Config
<a href=#__codelineno-2-29 id=__codelineno-2-29 name=__codelineno-2-29></a>preferences: <span class=o>{}</span>
<a href=#__codelineno-2-30 id=__codelineno-2-30 name=__codelineno-2-30></a>users:
<a href=#__codelineno-2-31 id=__codelineno-2-31 name=__codelineno-2-31></a>- name: minikube
<a href=#__codelineno-2-32 id=__codelineno-2-32 name=__codelineno-2-32></a>  user:
<a href=#__codelineno-2-33 id=__codelineno-2-33 name=__codelineno-2-33></a>    client-certificate: /home/dxlab/.minikube/profiles/minikube/client.crt
<a href=#__codelineno-2-34 id=__codelineno-2-34 name=__codelineno-2-34></a>    client-key: /home/dxlab/.minikube/profiles/minikube/client.key
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>默認情況下，<code>kubectl</code> 在 <code>$HOME/.kube</code> 目錄中查找名為 <code>config</code> 的文件。那麼，為什麼不直接從這個文件中獲取 API 地址呢？ 原因是潛在的配置合併。通過將 <code>KUBECONFIG env var</code> 設置為以冒號分隔的位置列表，可以指定多個 <code>kubeconfig</code> 文件。在訪問集群之前，<code>kubectl</code> 會嘗試將所有 <code>kubeconfig</code> 文件的內容合併到一個配置中。</p> </div> <p>因此，從上面的列表中選擇正確的集群，讓我們嘗試向其 API 服務器發送請求：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>$ <span class=nv>KUBE_API</span><span class=o>=</span><span class=k>$(</span>kubectl config view -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.clusters[0].cluster.server}'</span><span class=k>)</span>
</code></pre></div> <h2 id=how-to-call-kubernetes-api-using-curl>How to call Kubernetes API using curl<a class=headerlink href=#how-to-call-kubernetes-api-using-curl title="Permanent link">¶</a></h2> <p>實際上，任何 HTTP 客戶端（curl、httpie、wget 甚至 postman）都可以，但我將在本節中使用 <code>curl</code> 。</p> <h3 id=authenticating-api-server-to-client>Authenticating API server to client<a class=headerlink href=#authenticating-api-server-to-client title="Permanent link">¶</a></h3> <p>讓我們從查詢 API 的 /version 端點開始：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a>$ curl <span class=nv>$KUBE_API</span>/version
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a>
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a>curl: <span class=o>(</span><span class=m>60</span><span class=o>)</span> SSL certificate problem: unable to get <span class=nb>local</span> issuer certificate
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a>More details here: https://curl.se/docs/sslcerts.html
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a>
<a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a>curl failed to verify the legitimacy of the server and therefore could not
<a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a>establish a secure connection to it. To learn more about this situation and
<a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a>how to fix it, please visit the web page mentioned above.
</code></pre></div> <p>很顯然……我們連接失敗了！ 🙈</p> <p>當我第一次偶然發現類似的錯誤時，我真的很困惑。但仔細想想，上述錯誤實際上是有道理的。默認情況下，Kubernetes 通過 HTTPS 公開其 API，特別是為了向客戶端保證 API 服務器的強身份。但是，minikube 使用自簽名證書來設定本地集群。因此，Kubernetes API 服務器的 TLS 證書原來是由證書頒發機構 (CA) minikubeCA 簽署的(self-signed)，該證書頒發機構 (CA) minikubeCA 對 curl 是未知的 。curl 無法信任它，因此請求失敗。</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>默認情況下，curl 信任底層操作系統所信任的同一組 CA。例如，在 Ubuntu 或 Debian 上，可以在 <code>/etc/ssl/certs/ca-certificates.crt</code> 中找到受信任的 CA 列表。顯然，minikube 不會將其證書添加到此文件中。</p> </div> <p>幸運的是，minikube 將 CA 證書保存到 <code>~/.minikube/ca.crt</code>：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a>$ cat ~/.minikube/ca.crt <span class=p>|</span> openssl x509 -text
</code></pre></div> <p>結果:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>Certificate:
<a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a>    Data:
<a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a>        Version: <span class=m>3</span> <span class=o>(</span>0x2<span class=o>)</span>
<a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a>        Serial Number: <span class=m>1</span> <span class=o>(</span>0x1<span class=o>)</span>
<a href=#__codelineno-6-5 id=__codelineno-6-5 name=__codelineno-6-5></a>        Signature Algorithm: sha256WithRSAEncryption
<a href=#__codelineno-6-6 id=__codelineno-6-6 name=__codelineno-6-6></a>        Issuer: <span class=nv>CN</span> <span class=o>=</span> minikubeCA
<a href=#__codelineno-6-7 id=__codelineno-6-7 name=__codelineno-6-7></a>        Validity
<a href=#__codelineno-6-8 id=__codelineno-6-8 name=__codelineno-6-8></a>            Not Before: Jun <span class=m>12</span> <span class=m>06</span>:14:14 <span class=m>2022</span> GMT
<a href=#__codelineno-6-9 id=__codelineno-6-9 name=__codelineno-6-9></a>            Not After : Jun <span class=m>10</span> <span class=m>06</span>:14:14 <span class=m>2032</span> GMT
<a href=#__codelineno-6-10 id=__codelineno-6-10 name=__codelineno-6-10></a>        Subject: <span class=nv>CN</span> <span class=o>=</span> minikubeCA
<a href=#__codelineno-6-11 id=__codelineno-6-11 name=__codelineno-6-11></a>        Subject Public Key Info:
<a href=#__codelineno-6-12 id=__codelineno-6-12 name=__codelineno-6-12></a>            Public Key Algorithm: rsaEncryption
<a href=#__codelineno-6-13 id=__codelineno-6-13 name=__codelineno-6-13></a>                RSA Public-Key: <span class=o>(</span><span class=m>2048</span> bit<span class=o>)</span>
<a href=#__codelineno-6-14 id=__codelineno-6-14 name=__codelineno-6-14></a>                Modulus:
<a href=#__codelineno-6-15 id=__codelineno-6-15 name=__codelineno-6-15></a>                    <span class=m>00</span>:c2:ee:45:b9:c6:63:1f:15:d5:e7:22:5a:92:48:
<a href=#__codelineno-6-16 id=__codelineno-6-16 name=__codelineno-6-16></a>                    <span class=m>86</span>:23:db:0c:a2:0c:e5:e9:b4:9b:29:75:04:c0:e2:
<a href=#__codelineno-6-17 id=__codelineno-6-17 name=__codelineno-6-17></a>                    2b:f2:8e:2a:8a:47:06:6e:81:d0:13:90:0a:08:71:
<a href=#__codelineno-6-18 id=__codelineno-6-18 name=__codelineno-6-18></a>                    <span class=m>99</span>:23:01:57:47:9b:1d:00:8f:95:50:20:97:13:6c:
<a href=#__codelineno-6-19 id=__codelineno-6-19 name=__codelineno-6-19></a>                    <span class=m>32</span>:42:b5:04:c8:3a:0b:5d:30:9c:55:bd:28:53:1b:
<a href=#__codelineno-6-20 id=__codelineno-6-20 name=__codelineno-6-20></a>                    <span class=m>87</span>:de:04:a7:04:18:e9:16:38:47:38:aa:a7:08:35:
<a href=#__codelineno-6-21 id=__codelineno-6-21 name=__codelineno-6-21></a>                    1c:62:c3:e5:2d:89:ae:0b:e3:3b:9d:be:a2:b8:3b:
<a href=#__codelineno-6-22 id=__codelineno-6-22 name=__codelineno-6-22></a>                    e6:81:ac:75:12:fe:f7:9b:a1:1b:a8:46:f7:9d:b8:
<a href=#__codelineno-6-23 id=__codelineno-6-23 name=__codelineno-6-23></a>                    ce:41:2b:95:de:98:1b:52:a6:59:b9:54:ce:60:d6:
<a href=#__codelineno-6-24 id=__codelineno-6-24 name=__codelineno-6-24></a>                    f3:2b:a5:b8:43:e1:ca:87:5c:8c:61:f8:59:4b:47:
<a href=#__codelineno-6-25 id=__codelineno-6-25 name=__codelineno-6-25></a>                    1c:73:20:ad:3d:8e:fa:0e:a2:c5:b7:2d:8b:9a:85:
<a href=#__codelineno-6-26 id=__codelineno-6-26 name=__codelineno-6-26></a>                    3f:6c:39:46:16:e8:4f:a9:91:e2:86:02:f3:2d:66:
<a href=#__codelineno-6-27 id=__codelineno-6-27 name=__codelineno-6-27></a>                    7d:6c:74:66:23:7a:34:24:85:d9:f6:20:b0:39:7d:
<a href=#__codelineno-6-28 id=__codelineno-6-28 name=__codelineno-6-28></a>                    <span class=m>68</span>:86:d0:67:f1:90:df:ab:bd:52:85:5c:bb:99:a0:
<a href=#__codelineno-6-29 id=__codelineno-6-29 name=__codelineno-6-29></a>                    ab:b9:a5:bd:1e:08:69:8e:7e:e2:e0:d5:f2:a5:40:
<a href=#__codelineno-6-30 id=__codelineno-6-30 name=__codelineno-6-30></a>                    <span class=m>76</span>:e7:03:de:aa:e3:f9:16:11:c9:ed:a3:8f:9a:c3:
<a href=#__codelineno-6-31 id=__codelineno-6-31 name=__codelineno-6-31></a>                    <span class=m>48</span>:44:20:5e:4c:8d:13:fa:a0:f7:68:86:f5:8f:5f:
<a href=#__codelineno-6-32 id=__codelineno-6-32 name=__codelineno-6-32></a>                    <span class=m>97</span>:3f
<a href=#__codelineno-6-33 id=__codelineno-6-33 name=__codelineno-6-33></a>                Exponent: <span class=m>65537</span> <span class=o>(</span>0x10001<span class=o>)</span>
<a href=#__codelineno-6-34 id=__codelineno-6-34 name=__codelineno-6-34></a>        X509v3 extensions:
<a href=#__codelineno-6-35 id=__codelineno-6-35 name=__codelineno-6-35></a>            X509v3 Key Usage: critical
<a href=#__codelineno-6-36 id=__codelineno-6-36 name=__codelineno-6-36></a>                Digital Signature, Key Encipherment, Certificate Sign
<a href=#__codelineno-6-37 id=__codelineno-6-37 name=__codelineno-6-37></a>            X509v3 Extended Key Usage: 
<a href=#__codelineno-6-38 id=__codelineno-6-38 name=__codelineno-6-38></a>                TLS Web Client Authentication, TLS Web Server Authentication
<a href=#__codelineno-6-39 id=__codelineno-6-39 name=__codelineno-6-39></a>            X509v3 Basic Constraints: critical
<a href=#__codelineno-6-40 id=__codelineno-6-40 name=__codelineno-6-40></a>                CA:TRUE
<a href=#__codelineno-6-41 id=__codelineno-6-41 name=__codelineno-6-41></a>            X509v3 Subject Key Identifier: 
<a href=#__codelineno-6-42 id=__codelineno-6-42 name=__codelineno-6-42></a>                <span class=m>70</span>:53:86:8E:01:AE:E3:4F:57:8F:B0:30:C3:31:B0:5E:31:DB:7F:96
<a href=#__codelineno-6-43 id=__codelineno-6-43 name=__codelineno-6-43></a>    Signature Algorithm: sha256WithRSAEncryption
<a href=#__codelineno-6-44 id=__codelineno-6-44 name=__codelineno-6-44></a>         <span class=m>56</span>:3c:de:59:09:ce:7b:bf:92:b0:fd:44:ca:e7:83:48:a2:f8:
<a href=#__codelineno-6-45 id=__codelineno-6-45 name=__codelineno-6-45></a>         a7:3d:01:b2:62:50:62:cb:c0:7c:33:5d:25:a2:f4:46:af:88:
<a href=#__codelineno-6-46 id=__codelineno-6-46 name=__codelineno-6-46></a>         b0:02:db:84:e6:4c:cb:a3:74:46:ed:ef:96:48:15:f9:cb:d7:
<a href=#__codelineno-6-47 id=__codelineno-6-47 name=__codelineno-6-47></a>         <span class=m>07</span>:42:0e:b0:3f:bf:bd:2b:e6:02:66:9c:a6:b4:5c:de:f9:0a:
<a href=#__codelineno-6-48 id=__codelineno-6-48 name=__codelineno-6-48></a>         5b:68:cc:7a:0f:ea:1a:b5:4e:ff:ff:95:f7:b9:c4:a1:1f:e5:
<a href=#__codelineno-6-49 id=__codelineno-6-49 name=__codelineno-6-49></a>         <span class=m>76</span>:62:f4:c7:82:2d:9d:a6:79:99:95:f2:f7:77:58:11:87:0a:
<a href=#__codelineno-6-50 id=__codelineno-6-50 name=__codelineno-6-50></a>         <span class=m>76</span>:88:e3:32:fe:4a:18:99:fd:a2:b8:50:29:fb:4a:f5:74:4c:
<a href=#__codelineno-6-51 id=__codelineno-6-51 name=__codelineno-6-51></a>         b2:0c:b5:42:75:93:6c:b9:80:db:10:8b:3e:49:c2:f2:15:84:
<a href=#__codelineno-6-52 id=__codelineno-6-52 name=__codelineno-6-52></a>         e4:0f:fd:9b:21:05:ed:0e:66:85:04:58:ff:d8:c3:e9:e4:44:
<a href=#__codelineno-6-53 id=__codelineno-6-53 name=__codelineno-6-53></a>         c4:30:28:fa:7f:b8:79:3c:8e:c3:28:64:cd:6c:ea:db:57:a2:
<a href=#__codelineno-6-54 id=__codelineno-6-54 name=__codelineno-6-54></a>         e9:b3:26:2a:d2:18:4e:f5:b9:1d:23:48:cf:be:f7:85:6c:7e:
<a href=#__codelineno-6-55 id=__codelineno-6-55 name=__codelineno-6-55></a>         dd:c8:85:78:ae:92:a7:1e:2c:0e:2a:c6:5f:3a:9c:84:8f:2d:
<a href=#__codelineno-6-56 id=__codelineno-6-56 name=__codelineno-6-56></a>         cd:20:ac:30:a6:79:f3:4d:08:8e:e3:93:32:81:01:dc:c5:7b:
<a href=#__codelineno-6-57 id=__codelineno-6-57 name=__codelineno-6-57></a>         0d:a8:d8:e3:13:0b:d6:68:1f:3e:69:10:16:4a:9e:77:4a:61:
<a href=#__codelineno-6-58 id=__codelineno-6-58 name=__codelineno-6-58></a>         8f:94:e5:3c
<a href=#__codelineno-6-59 id=__codelineno-6-59 name=__codelineno-6-59></a>-----BEGIN CERTIFICATE-----
<a href=#__codelineno-6-60 id=__codelineno-6-60 name=__codelineno-6-60></a>MIIDBjCCAe6gAwIBAgIBATANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDEwptaW5p
<a href=#__codelineno-6-61 id=__codelineno-6-61 name=__codelineno-6-61></a>a3ViZUNBMB4XDTIyMDYxMjA2MTQxNFoXDTMyMDYxMDA2MTQxNFowFTETMBEGA1UE
<a href=#__codelineno-6-62 id=__codelineno-6-62 name=__codelineno-6-62></a>AxMKbWluaWt1YmVDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMLu
<a href=#__codelineno-6-63 id=__codelineno-6-63 name=__codelineno-6-63></a>RbnGYx8V1eciWpJIhiPbDKIM5em0myl1BMDiK/KOKopHBm6B0BOQCghxmSMBV0eb
<a href=#__codelineno-6-64 id=__codelineno-6-64 name=__codelineno-6-64></a>HQCPlVAglxNsMkK1BMg6C10wnFW9KFMbh94EpwQY6RY4Rziqpwg1HGLD5S2Jrgvj
<a href=#__codelineno-6-65 id=__codelineno-6-65 name=__codelineno-6-65></a>O52+org75oGsdRL+95uhG6hG9524zkErld6YG1KmWblUzmDW8yuluEPhyodcjGH4
<a href=#__codelineno-6-66 id=__codelineno-6-66 name=__codelineno-6-66></a>WUtHHHMgrT2O+g6ixbcti5qFP2w5RhboT6mR4oYC8y1mfWx0ZiN6NCSF2fYgsDl9
<a href=#__codelineno-6-67 id=__codelineno-6-67 name=__codelineno-6-67></a>aIbQZ/GQ36u9UoVcu5mgq7mlvR4IaY5+4uDV8qVAducD3qrj+RYRye2jj5rDSEQg
<a href=#__codelineno-6-68 id=__codelineno-6-68 name=__codelineno-6-68></a>XkyNE/qg92iG9Y9flz8CAwEAAaNhMF8wDgYDVR0PAQH/BAQDAgKkMB0GA1UdJQQW
<a href=#__codelineno-6-69 id=__codelineno-6-69 name=__codelineno-6-69></a>MBQGCCsGAQUFBwMCBggrBgEFBQcDATAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQW
<a href=#__codelineno-6-70 id=__codelineno-6-70 name=__codelineno-6-70></a>BBRwU4aOAa7jT1ePsDDDMbBeMdt/ljANBgkqhkiG9w0BAQsFAAOCAQEAVjzeWQnO
<a href=#__codelineno-6-71 id=__codelineno-6-71 name=__codelineno-6-71></a>e7+SsP1EyueDSKL4pz0BsmJQYsvAfDNdJaL0Rq+IsALbhOZMy6N0Ru3vlkgV+cvX
<a href=#__codelineno-6-72 id=__codelineno-6-72 name=__codelineno-6-72></a>B0IOsD+/vSvmAmacprRc3vkKW2jMeg/qGrVO//+V97nEoR/ldmL0x4ItnaZ5mZXy
<a href=#__codelineno-6-73 id=__codelineno-6-73 name=__codelineno-6-73></a>93dYEYcKdojjMv5KGJn9orhQKftK9XRMsgy1QnWTbLmA2xCLPknC8hWE5A/9myEF
<a href=#__codelineno-6-74 id=__codelineno-6-74 name=__codelineno-6-74></a>7Q5mhQRY/9jD6eRExDAo+n+4eTyOwyhkzWzq21ei6bMmKtIYTvW5HSNIz773hWx+
<a href=#__codelineno-6-75 id=__codelineno-6-75 name=__codelineno-6-75></a>3ciFeK6Spx4sDirGXzqchI8tzSCsMKZ5800IjuOTMoEB3MV7DajY4xML1mgfPmkQ
<a href=#__codelineno-6-76 id=__codelineno-6-76 name=__codelineno-6-76></a><span class=nv>Fkqed0phj5TlPA</span><span class=o>==</span>
<a href=#__codelineno-6-77 id=__codelineno-6-77 name=__codelineno-6-77></a>-----END CERTIFICATE-----
</code></pre></div> <p>因此，要修復 <code>GET /version</code> 請求的問題，我只需要通過手動將其指向 minikubeCA 證書來使 curl 信任 API 服務器證書的頒發者：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a>$ curl --cacert ~/.minikube/ca.crt <span class=nv>$KUBE_API</span>/version
<a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a>
<a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a><span class=o>{</span>
<a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a>  <span class=s2>"major"</span>: <span class=s2>"1"</span>,
<a href=#__codelineno-7-5 id=__codelineno-7-5 name=__codelineno-7-5></a>  <span class=s2>"minor"</span>: <span class=s2>"23"</span>,
<a href=#__codelineno-7-6 id=__codelineno-7-6 name=__codelineno-7-6></a>  <span class=s2>"gitVersion"</span>: <span class=s2>"v1.23.3"</span>,
<a href=#__codelineno-7-7 id=__codelineno-7-7 name=__codelineno-7-7></a>  <span class=s2>"gitCommit"</span>: <span class=s2>"816c97ab8cff8a1c72eccca1026f7820e93e0d25"</span>,
<a href=#__codelineno-7-8 id=__codelineno-7-8 name=__codelineno-7-8></a>  <span class=s2>"gitTreeState"</span>: <span class=s2>"clean"</span>,
<a href=#__codelineno-7-9 id=__codelineno-7-9 name=__codelineno-7-9></a>  <span class=s2>"buildDate"</span>: <span class=s2>"2022-01-25T21:19:12Z"</span>,
<a href=#__codelineno-7-10 id=__codelineno-7-10 name=__codelineno-7-10></a>  <span class=s2>"goVersion"</span>: <span class=s2>"go1.17.6"</span>,
<a href=#__codelineno-7-11 id=__codelineno-7-11 name=__codelineno-7-11></a>  <span class=s2>"compiler"</span>: <span class=s2>"gc"</span>,
<a href=#__codelineno-7-12 id=__codelineno-7-12 name=__codelineno-7-12></a>  <span class=s2>"platform"</span>: <span class=s2>"linux/amd64"</span>
<a href=#__codelineno-7-13 id=__codelineno-7-13 name=__codelineno-7-13></a><span class=o>}</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>或者，您可以在　<strong>curl</strong> 命令中使用 <code>--insecure</code> 標誌或其短別名 <code>-k</code>。在安全的環境中，我更喜歡 insecure mode，它比試圖找到頒發者證書更簡單。</p> </div> <h3 id=authenticating-using-certificates>Authenticating using Certificates<a class=headerlink href=#authenticating-using-certificates title="Permanent link">¶</a></h3> <p>好的，讓我們嘗試一些更複雜的東西。列出集群中的所有部署怎麼樣？</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a>$ curl --cacert ~/.minikube/ca.crt <span class=nv>$KUBE_API</span>/apis/apps/v1/deployments
<a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a>
<a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a><span class=o>{</span>
<a href=#__codelineno-8-4 id=__codelineno-8-4 name=__codelineno-8-4></a>  <span class=s2>"kind"</span>: <span class=s2>"Status"</span>,
<a href=#__codelineno-8-5 id=__codelineno-8-5 name=__codelineno-8-5></a>  <span class=s2>"apiVersion"</span>: <span class=s2>"v1"</span>,
<a href=#__codelineno-8-6 id=__codelineno-8-6 name=__codelineno-8-6></a>  <span class=s2>"metadata"</span>: <span class=o>{}</span>,
<a href=#__codelineno-8-7 id=__codelineno-8-7 name=__codelineno-8-7></a>  <span class=s2>"status"</span>: <span class=s2>"Failure"</span>,
<a href=#__codelineno-8-8 id=__codelineno-8-8 name=__codelineno-8-8></a>  <span class=s2>"message"</span>: <span class=s2>"deployments.apps is forbidden: User \"system:anonymous\" cannot list resource \"deployments\" in API group \"apps\" at the cluster scope"</span>,
<a href=#__codelineno-8-9 id=__codelineno-8-9 name=__codelineno-8-9></a>  <span class=s2>"reason"</span>: <span class=s2>"Forbidden"</span>,
<a href=#__codelineno-8-10 id=__codelineno-8-10 name=__codelineno-8-10></a>  <span class=s2>"details"</span>: <span class=o>{</span>
<a href=#__codelineno-8-11 id=__codelineno-8-11 name=__codelineno-8-11></a>    <span class=s2>"group"</span>: <span class=s2>"apps"</span>,
<a href=#__codelineno-8-12 id=__codelineno-8-12 name=__codelineno-8-12></a>    <span class=s2>"kind"</span>: <span class=s2>"deployments"</span>
<a href=#__codelineno-8-13 id=__codelineno-8-13 name=__codelineno-8-13></a>  <span class=o>}</span>,
<a href=#__codelineno-8-14 id=__codelineno-8-14 name=__codelineno-8-14></a>  <span class=s2>"code"</span>: <span class=m>403</span>
<a href=#__codelineno-8-15 id=__codelineno-8-15 name=__codelineno-8-15></a><span class=o>}</span>
</code></pre></div> <p>與明顯不受保護的 <code>/version</code> 端點不同，Kubernetes 通常會限制對其 API 端點的訪問。</p> <p>從錯誤消息中可以清楚地看出，該請求被驗證為用戶 <code>system:anonymous</code>，顯然，該用戶未授權可呼叫列出部署資源的 API 權限。</p> <p>這個失敗的請求導因於我們並未檢附任何身份驗證資訊（儘管如此，它已經過身份驗證，但作為匿名用戶），所以我需要提供一些額外的信息來獲得所需的訪問級別。</p> <p>Kubernetes 支持多種<a href=https://kubernetes.io/docs/reference/access-authn-authz/authentication/ >身份驗證機制</a>，我將從使用客戶端證書(client certificate)對請求進行身份驗證開始。</p> <p>但是等一下！什麼是客戶證書(client certificate)？</p> <p>當 minikube 設定集群時，它還創建了一個<code>用戶</code>。該<code>用戶</code>獲得了由同一個 minikubeCA 頒發機構簽署的證書。由於 Kubernetes API 服務器信任此 CA，因此在請求中提供此證書將使其作為所述用戶進行身份驗證。</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Kubernetes 沒有代表<code>用戶</code>的對象。即不能通過 API 調用將用戶添加到集群中。但是，任何提供由集群的證書頒發機構簽名的有效證書的用戶都被視為已通過身份驗證。 Kubernetes 從證書主題中的通用名稱字段中獲取用戶名（例如，CN = minikube-user）。然後，Kubernetes RBAC 子系統判斷用戶是否有權對資源執行特定操作。</p> </div> <p>用戶證書通常可以在我們已經熟悉的 kubectl 配置視圖輸出中找到：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a>$ kubectl config view -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.users[0]}'</span> <span class=p>|</span> jq
<a href=#__codelineno-9-2 id=__codelineno-9-2 name=__codelineno-9-2></a><span class=o>{</span>
<a href=#__codelineno-9-3 id=__codelineno-9-3 name=__codelineno-9-3></a><span class=hll>  <span class=s2>"name"</span>: <span class=s2>"minikube"</span>,
</span><a href=#__codelineno-9-4 id=__codelineno-9-4 name=__codelineno-9-4></a>  <span class=s2>"user"</span>: <span class=o>{</span>
<a href=#__codelineno-9-5 id=__codelineno-9-5 name=__codelineno-9-5></a>    <span class=s2>"client-certificate"</span>: <span class=s2>"/home/dxlab/.minikube/profiles/minikube/client.crt"</span>,
<a href=#__codelineno-9-6 id=__codelineno-9-6 name=__codelineno-9-6></a>    <span class=s2>"client-key"</span>: <span class=s2>"/home/dxlab/.minikube/profiles/minikube/client.key"</span>
<a href=#__codelineno-9-7 id=__codelineno-9-7 name=__codelineno-9-7></a>  <span class=o>}</span>
<a href=#__codelineno-9-8 id=__codelineno-9-8 name=__codelineno-9-8></a><span class=o>}</span>
</code></pre></div> <p>讓我們快速檢查證書內容以確保它是由同一個 CA 簽名的：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a>$ cat ~/.minikube/profiles/cluster1/client.crt <span class=p>|</span> openssl x509 -text
<a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a>
<a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a>Certificate:
<a href=#__codelineno-10-4 id=__codelineno-10-4 name=__codelineno-10-4></a>    Data:
<a href=#__codelineno-10-5 id=__codelineno-10-5 name=__codelineno-10-5></a>        Version: <span class=m>3</span> <span class=o>(</span>0x2<span class=o>)</span>
<a href=#__codelineno-10-6 id=__codelineno-10-6 name=__codelineno-10-6></a>        Serial Number: <span class=m>2</span> <span class=o>(</span>0x2<span class=o>)</span>
<a href=#__codelineno-10-7 id=__codelineno-10-7 name=__codelineno-10-7></a>        Signature Algorithm: sha256WithRSAEncryption
<a href=#__codelineno-10-8 id=__codelineno-10-8 name=__codelineno-10-8></a>        Issuer: <span class=nv>CN</span> <span class=o>=</span> minikubeCA
<a href=#__codelineno-10-9 id=__codelineno-10-9 name=__codelineno-10-9></a>        Validity
<a href=#__codelineno-10-10 id=__codelineno-10-10 name=__codelineno-10-10></a>            Not Before: Jun <span class=m>26</span> <span class=m>21</span>:54:59 <span class=m>2022</span> GMT
<a href=#__codelineno-10-11 id=__codelineno-10-11 name=__codelineno-10-11></a>            Not After : Jun <span class=m>26</span> <span class=m>21</span>:54:59 <span class=m>2025</span> GMT
<a href=#__codelineno-10-12 id=__codelineno-10-12 name=__codelineno-10-12></a><span class=hll>        Subject: <span class=nv>O</span> <span class=o>=</span> system:masters, <span class=nv>CN</span> <span class=o>=</span> minikube-user
</span><a href=#__codelineno-10-13 id=__codelineno-10-13 name=__codelineno-10-13></a>        Subject Public Key Info:
<a href=#__codelineno-10-14 id=__codelineno-10-14 name=__codelineno-10-14></a>            Public Key Algorithm: rsaEncryption
<a href=#__codelineno-10-15 id=__codelineno-10-15 name=__codelineno-10-15></a>                RSA Public-Key: <span class=o>(</span><span class=m>2048</span> bit<span class=o>)</span>
<a href=#__codelineno-10-16 id=__codelineno-10-16 name=__codelineno-10-16></a>                Modulus:
<a href=#__codelineno-10-17 id=__codelineno-10-17 name=__codelineno-10-17></a>                    <span class=m>00</span>:a6:eb:74:10:82:be:42:94:2b:db:72:a6:17:7d:
<a href=#__codelineno-10-18 id=__codelineno-10-18 name=__codelineno-10-18></a>                    a5:9e:b4:d1:1b:34:c5:a4:71:ff:03:68:1b:1e:cb:
<a href=#__codelineno-10-19 id=__codelineno-10-19 name=__codelineno-10-19></a>                    <span class=m>77</span>:57:bb:6f:fd:0e:d7:b5:62:8f:c8:66:22:36:7d:
<a href=#__codelineno-10-20 id=__codelineno-10-20 name=__codelineno-10-20></a>                    <span class=m>01</span>:d3:f3:4b:3d:84:6a:03:0b:6f:e4:8e:3d:50:24:
<a href=#__codelineno-10-21 id=__codelineno-10-21 name=__codelineno-10-21></a>                    a4:ad:e0:89:1a:3f:05:af:d8:67:63:9d:44:92:73:
<a href=#__codelineno-10-22 id=__codelineno-10-22 name=__codelineno-10-22></a>                    <span class=m>93</span>:ef:65:08:7e:05:76:45:69:6e:e7:b8:50:81:b6:
<a href=#__codelineno-10-23 id=__codelineno-10-23 name=__codelineno-10-23></a>                    8b:82:a7:85:9b:9d:84:2d:db:d5:f5:73:a9:eb:08:
<a href=#__codelineno-10-24 id=__codelineno-10-24 name=__codelineno-10-24></a>                    a5:0b:f2:61:b8:66:a5:f9:84:09:68:8d:9f:56:8e:
<a href=#__codelineno-10-25 id=__codelineno-10-25 name=__codelineno-10-25></a>                    1f:a7:71:f6:4f:67:31:03:8d:a2:17:2a:42:f4:de:
<a href=#__codelineno-10-26 id=__codelineno-10-26 name=__codelineno-10-26></a>                    <span class=m>96</span>:11:2e:22:da:fa:f6:26:f2:de:7b:99:bb:66:b3:
<a href=#__codelineno-10-27 id=__codelineno-10-27 name=__codelineno-10-27></a>                    d0:3e:4a:f6:c3:7e:6d:0f:d5:ef:44:54:fd:7f:c1:
<a href=#__codelineno-10-28 id=__codelineno-10-28 name=__codelineno-10-28></a>                    c9:65:f7:7f:d4:50:73:2b:2a:ce:84:19:b0:a7:8a:
<a href=#__codelineno-10-29 id=__codelineno-10-29 name=__codelineno-10-29></a>                    <span class=m>66</span>:cb:ed:f8:60:3a:4a:ac:36:e6:5a:8f:21:eb:4f:
<a href=#__codelineno-10-30 id=__codelineno-10-30 name=__codelineno-10-30></a>                    f8:fd:db:d3:55:d8:41:a9:34:00:20:9f:eb:9c:58:
<a href=#__codelineno-10-31 id=__codelineno-10-31 name=__codelineno-10-31></a>                    fd:32:0c:d5:a8:3d:13:82:5c:ef:5c:e6:a5:ac:a8:
<a href=#__codelineno-10-32 id=__codelineno-10-32 name=__codelineno-10-32></a>                    fb:71:ec:1a:d1:db:ad:f9:2c:40:3b:ee:59:0f:70:
<a href=#__codelineno-10-33 id=__codelineno-10-33 name=__codelineno-10-33></a>                    <span class=m>36</span>:b1:8a:ab:95:1e:e6:0b:1e:01:c4:ab:a7:5c:c6:
<a href=#__codelineno-10-34 id=__codelineno-10-34 name=__codelineno-10-34></a>                    <span class=m>10</span>:43
<a href=#__codelineno-10-35 id=__codelineno-10-35 name=__codelineno-10-35></a>                Exponent: <span class=m>65537</span> <span class=o>(</span>0x10001<span class=o>)</span>
<a href=#__codelineno-10-36 id=__codelineno-10-36 name=__codelineno-10-36></a>        X509v3 extensions:
<a href=#__codelineno-10-37 id=__codelineno-10-37 name=__codelineno-10-37></a>            X509v3 Key Usage: critical
<a href=#__codelineno-10-38 id=__codelineno-10-38 name=__codelineno-10-38></a>                Digital Signature, Key Encipherment
<a href=#__codelineno-10-39 id=__codelineno-10-39 name=__codelineno-10-39></a>            X509v3 Extended Key Usage: 
<a href=#__codelineno-10-40 id=__codelineno-10-40 name=__codelineno-10-40></a>                TLS Web Server Authentication, TLS Web Client Authentication
<a href=#__codelineno-10-41 id=__codelineno-10-41 name=__codelineno-10-41></a>            X509v3 Basic Constraints: critical
<a href=#__codelineno-10-42 id=__codelineno-10-42 name=__codelineno-10-42></a>                CA:FALSE
<a href=#__codelineno-10-43 id=__codelineno-10-43 name=__codelineno-10-43></a>            X509v3 Authority Key Identifier: 
<a href=#__codelineno-10-44 id=__codelineno-10-44 name=__codelineno-10-44></a>                keyid:70:53:86:8E:01:AE:E3:4F:57:8F:B0:30:C3:31:B0:5E:31:DB:7F:96
<a href=#__codelineno-10-45 id=__codelineno-10-45 name=__codelineno-10-45></a>
<a href=#__codelineno-10-46 id=__codelineno-10-46 name=__codelineno-10-46></a>    Signature Algorithm: sha256WithRSAEncryption
<a href=#__codelineno-10-47 id=__codelineno-10-47 name=__codelineno-10-47></a>         a3:4e:82:61:63:b9:bc:5c:3f:ba:4d:00:ae:b4:f0:a7:a3:9f:
<a href=#__codelineno-10-48 id=__codelineno-10-48 name=__codelineno-10-48></a>         <span class=m>39</span>:5b:2b:82:0c:4f:d8:a6:ef:07:45:de:b1:0f:85:70:50:8c:
<a href=#__codelineno-10-49 id=__codelineno-10-49 name=__codelineno-10-49></a>         b3:9f:1f:a6:31:34:20:ee:59:89:3b:c5:03:5f:f0:8a:1c:b5:
<a href=#__codelineno-10-50 id=__codelineno-10-50 name=__codelineno-10-50></a>         c4:44:c6:45:c4:f4:51:1c:28:4b:b0:0b:52:41:55:4a:04:06:
<a href=#__codelineno-10-51 id=__codelineno-10-51 name=__codelineno-10-51></a>         <span class=m>38</span>:0d:ab:65:e7:7a:6f:0b:eb:3c:7e:92:7f:f8:30:b8:73:dd:
<a href=#__codelineno-10-52 id=__codelineno-10-52 name=__codelineno-10-52></a>         <span class=m>62</span>:1c:19:f4:66:ff:88:57:f8:10:23:1b:c1:42:04:41:a1:94:
<a href=#__codelineno-10-53 id=__codelineno-10-53 name=__codelineno-10-53></a>         <span class=m>13</span>:d3:51:bb:8f:52:bf:f3:ff:50:66:cf:9e:e0:d4:1e:0b:44:
<a href=#__codelineno-10-54 id=__codelineno-10-54 name=__codelineno-10-54></a>         7f:e3:8e:2a:b9:07:62:a3:98:e1:50:c6:82:71:de:da:c8:83:
<a href=#__codelineno-10-55 id=__codelineno-10-55 name=__codelineno-10-55></a>         4a:6d:8f:78:f7:aa:53:5c:ed:68:db:b5:09:b2:1b:94:80:50:
<a href=#__codelineno-10-56 id=__codelineno-10-56 name=__codelineno-10-56></a>         <span class=m>71</span>:12:cb:92:c2:a3:5f:f1:9d:12:4f:b0:0a:08:39:25:d9:19:
<a href=#__codelineno-10-57 id=__codelineno-10-57 name=__codelineno-10-57></a>         b3:ca:15:51:d6:01:b6:7d:58:81:cc:b5:85:47:b0:ff:d4:b3:
<a href=#__codelineno-10-58 id=__codelineno-10-58 name=__codelineno-10-58></a>         <span class=m>63</span>:ce:2e:b9:12:eb:c6:0e:c3:5f:88:62:7c:39:5f:2d:c5:d1:
<a href=#__codelineno-10-59 id=__codelineno-10-59 name=__codelineno-10-59></a>         <span class=m>56</span>:a6:68:7b:c1:29:5c:69:dc:ee:cf:af:92:6b:ad:3c:e8:bd:
<a href=#__codelineno-10-60 id=__codelineno-10-60 name=__codelineno-10-60></a>         6c:b9:1e:9d:35:3a:93:c1:4a:f2:64:d2:1b:bb:79:48:bc:89:
<a href=#__codelineno-10-61 id=__codelineno-10-61 name=__codelineno-10-61></a>         <span class=m>51</span>:81:0d:da
<a href=#__codelineno-10-62 id=__codelineno-10-62 name=__codelineno-10-62></a>-----BEGIN CERTIFICATE-----
<a href=#__codelineno-10-63 id=__codelineno-10-63 name=__codelineno-10-63></a>MIIDITCCAgmgAwIBAgIBAjANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDEwptaW5p
<a href=#__codelineno-10-64 id=__codelineno-10-64 name=__codelineno-10-64></a>a3ViZUNBMB4XDTIyMDYyNjIxNTQ1OVoXDTI1MDYyNjIxNTQ1OVowMTEXMBUGA1UE
<a href=#__codelineno-10-65 id=__codelineno-10-65 name=__codelineno-10-65></a>ChMOc3lzdGVtOm1hc3RlcnMxFjAUBgNVBAMTDW1pbmlrdWJlLXVzZXIwggEiMA0G
<a href=#__codelineno-10-66 id=__codelineno-10-66 name=__codelineno-10-66></a>CSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCm63QQgr5ClCvbcqYXfaWetNEbNMWk
<a href=#__codelineno-10-67 id=__codelineno-10-67 name=__codelineno-10-67></a>cf8DaBsey3dXu2/9Dte1Yo/IZiI2fQHT80s9hGoDC2/kjj1QJKSt4IkaPwWv2Gdj
<a href=#__codelineno-10-68 id=__codelineno-10-68 name=__codelineno-10-68></a>nUSSc5PvZQh+BXZFaW7nuFCBtouCp4WbnYQt29X1c6nrCKUL8mG4ZqX5hAlojZ9W
<a href=#__codelineno-10-69 id=__codelineno-10-69 name=__codelineno-10-69></a>jh+ncfZPZzEDjaIXKkL03pYRLiLa+vYm8t57mbtms9A+SvbDfm0P1e9EVP1/wcll
<a href=#__codelineno-10-70 id=__codelineno-10-70 name=__codelineno-10-70></a><span class=m>93</span>/UUHMrKs6EGbCnimbL7fhgOkqsNuZajyHrT/j929NV2EGpNAAgn+ucWP0yDNWo
<a href=#__codelineno-10-71 id=__codelineno-10-71 name=__codelineno-10-71></a>PROCXO9c5qWsqPtx7BrR2635LEA77lkPcDaxiquVHuYLHgHEq6dcxhBDAgMBAAGj
<a href=#__codelineno-10-72 id=__codelineno-10-72 name=__codelineno-10-72></a>YDBeMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUH
<a href=#__codelineno-10-73 id=__codelineno-10-73 name=__codelineno-10-73></a>AwIwDAYDVR0TAQH/BAIwADAfBgNVHSMEGDAWgBRwU4aOAa7jT1ePsDDDMbBeMdt/
<a href=#__codelineno-10-74 id=__codelineno-10-74 name=__codelineno-10-74></a>ljANBgkqhkiG9w0BAQsFAAOCAQEAo06CYWO5vFw/uk0ArrTwp6OfOVsrggxP2Kbv
<a href=#__codelineno-10-75 id=__codelineno-10-75 name=__codelineno-10-75></a>B0XesQ+FcFCMs58fpjE0IO5ZiTvFA1/wihy1xETGRcT0URwoS7ALUkFVSgQGOA2r
<a href=#__codelineno-10-76 id=__codelineno-10-76 name=__codelineno-10-76></a>Zed6bwvrPH6Sf/gwuHPdYhwZ9Gb/iFf4ECMbwUIEQaGUE9NRu49Sv/P/UGbPnuDU
<a href=#__codelineno-10-77 id=__codelineno-10-77 name=__codelineno-10-77></a>HgtEf+OOKrkHYqOY4VDGgnHe2siDSm2PePeqU1ztaNu1CbIblIBQcRLLksKjX/Gd
<a href=#__codelineno-10-78 id=__codelineno-10-78 name=__codelineno-10-78></a>Ek+wCgg5JdkZs8oVUdYBtn1Ygcy1hUew/9SzY84uuRLrxg7DX4hifDlfLcXRVqZo
<a href=#__codelineno-10-79 id=__codelineno-10-79 name=__codelineno-10-79></a>e8EpXGnc7s+vkmutPOi9bLkenTU6k8FK8mTSG7t5SLyJUYEN2g<span class=o>==</span>
<a href=#__codelineno-10-80 id=__codelineno-10-80 name=__codelineno-10-80></a>-----END CERTIFICATE-----
</code></pre></div> <p>下面是如何使用 curl 向 Kubernetes API 服務器發送由該證書認證的請求：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/deployments <span class=se>\</span>
<a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a>  --cacert ~/.minikube/ca.crt <span class=se>\</span>
<a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a>  --cert ~/.minikube/profiles/minikube/client.crt <span class=se>\</span>
<a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a>  --key ~/.minikube/profiles/minikube/client.key
<a href=#__codelineno-11-5 id=__codelineno-11-5 name=__codelineno-11-5></a>
<a href=#__codelineno-11-6 id=__codelineno-11-6 name=__codelineno-11-6></a><span class=o>{</span>
<a href=#__codelineno-11-7 id=__codelineno-11-7 name=__codelineno-11-7></a>  <span class=s2>"kind"</span>: <span class=s2>"DeploymentList"</span>,
<a href=#__codelineno-11-8 id=__codelineno-11-8 name=__codelineno-11-8></a>  <span class=s2>"apiVersion"</span>: <span class=s2>"apps/v1"</span>,
<a href=#__codelineno-11-9 id=__codelineno-11-9 name=__codelineno-11-9></a>  <span class=s2>"metadata"</span>: <span class=o>{</span>
<a href=#__codelineno-11-10 id=__codelineno-11-10 name=__codelineno-11-10></a>    <span class=s2>"resourceVersion"</span>: <span class=s2>"654514"</span>
<a href=#__codelineno-11-11 id=__codelineno-11-11 name=__codelineno-11-11></a>  <span class=o>}</span>,
<a href=#__codelineno-11-12 id=__codelineno-11-12 name=__codelineno-11-12></a>  <span class=s2>"items"</span>: <span class=o>[</span>...<span class=o>]</span>
<a href=#__codelineno-11-13 id=__codelineno-11-13 name=__codelineno-11-13></a>- <span class=s2>"iss"</span> <span class=o>(</span>Issuer<span class=o>)</span> Claim - The <span class=s2>"iss"</span> <span class=o>(</span>issuer<span class=o>)</span> claim identifies the principal that issued the JWT. 
<a href=#__codelineno-11-14 id=__codelineno-11-14 name=__codelineno-11-14></a>- <span class=s2>"sub"</span> <span class=o>(</span>Subject<span class=o>)</span> Claim -The <span class=s2>"sub"</span> <span class=o>(</span>subject<span class=o>)</span> claim identifies the principal that is the subject of the JWT.
<a href=#__codelineno-11-15 id=__codelineno-11-15 name=__codelineno-11-15></a><span class=o>}</span>
</code></pre></div> <h3 id=authenticating-using-service-account-tokens>Authenticating using Service Account Tokens<a class=headerlink href=#authenticating-using-service-account-tokens title="Permanent link">¶</a></h3> <p>另一種驗證 API 請求的方法是使用<code>服務帳戶</code>的 JWT 令牌。與用戶非常相似，不同的<code>服務帳戶</code>具有不同級別的訪問權限。讓我們看看使用默認命名空間中的默認服務帳戶可以實現什麼：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a>$ <span class=nv>JWT_TOKEN_DEFAULT_DEFAULT</span><span class=o>=</span><span class=k>$(</span>kubectl get secrets <span class=se>\</span>
<a href=#__codelineno-12-2 id=__codelineno-12-2 name=__codelineno-12-2></a>    <span class=k>$(</span>kubectl get serviceaccounts/default -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.secrets[0].name}'</span><span class=k>)</span> <span class=se>\</span>
<a href=#__codelineno-12-3 id=__codelineno-12-3 name=__codelineno-12-3></a>    -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.data.token}'</span> <span class=p>|</span> base64 --decode<span class=k>)</span>
</code></pre></div> <p>把 JWT 令牌打印出來看:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a>$ <span class=nb>echo</span> <span class=nv>$JWT_TOKEN_DEFAULT_DEFAULT</span>
<a href=#__codelineno-13-2 id=__codelineno-13-2 name=__codelineno-13-2></a>
<a href=#__codelineno-13-3 id=__codelineno-13-3 name=__codelineno-13-3></a>eyJhbGciOiJSUzI1NiIsImtpZCI6IjFVa2pVaUVUS25JSzFNT1V0RW1zTWEyT0F3MTFSaFNneUVobXk0dUhjUEUifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tNng1ZHEiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImRiZjA0ZDczLWZlOTctNDMzMi04NDM2LWVjNDdlMDZkYzE2MSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.pkJ-AZufRuGcMGXwtL7jQu0BOa6DGgylzTjGcKQcOESjXeTsZfw8pnwHMOJsiV760QMLY33GtpzLy0om5l4gfU1O-CJZXKTaYCHzjyEb6ZVLK0xLeLwsW--LI_Weo0X9KiAjNBqDSUmj8NYHn2-c-wygN6IYWqbT8MmXL-YC8dejeqUlLzAQUw8hZasdWN6KLnmNxhI0-cntp0C8O2I5SPumOxq7IEX8s2Erir2cU2xGI-LPaMm8ccAk5wrKS9rqk23G24vXFgi9u1SwtujC_hZrki_rm8yrMUWvOa5SPZqAag_dkjLXR5YSxF_nJO69XGJ1fId3hr2ruHBTivbfEQ
</code></pre></div> <p><a class=glightbox href=../assets/default-serviceaccount-jwt.png><img alt src=../assets/default-serviceaccount-jwt.png></a></p> <p>其中 <code>payload</code> 的資訊如下:</p> <div class=highlight><span class=filename>payload</span><pre><span></span><code><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a><span class=p>{</span><span class=w></span>
<a href=#__codelineno-14-2 id=__codelineno-14-2 name=__codelineno-14-2></a><span class=w>  </span><span class=nt>"iss"</span><span class=p>:</span><span class=w> </span><span class=s2>"kubernetes/serviceaccount"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-14-3 id=__codelineno-14-3 name=__codelineno-14-3></a><span class=w>  </span><span class=nt>"kubernetes.io/serviceaccount/namespace"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-14-4 id=__codelineno-14-4 name=__codelineno-14-4></a><span class=w>  </span><span class=nt>"kubernetes.io/serviceaccount/secret.name"</span><span class=p>:</span><span class=w> </span><span class=s2>"default-token-6x5dq"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-14-5 id=__codelineno-14-5 name=__codelineno-14-5></a><span class=w>  </span><span class=nt>"kubernetes.io/serviceaccount/service-account.name"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-14-6 id=__codelineno-14-6 name=__codelineno-14-6></a><span class=w>  </span><span class=nt>"kubernetes.io/serviceaccount/service-account.uid"</span><span class=p>:</span><span class=w> </span><span class=s2>"dbf04d73-fe97-4332-8436-ec47e06dc161"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-14-7 id=__codelineno-14-7 name=__codelineno-14-7></a><span class=w>  </span><span class=nt>"sub"</span><span class=p>:</span><span class=w> </span><span class=s2>"system:serviceaccount:default:default"</span><span class=w></span>
<a href=#__codelineno-14-8 id=__codelineno-14-8 name=__codelineno-14-8></a><span class=p>}</span><span class=w></span>
</code></pre></div> <p>從一個簡單的任務開始 - 在 <code>apps/v1</code> 中列出已知的 API 資源類型：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/ <span class=se>\</span>
<a href=#__codelineno-15-2 id=__codelineno-15-2 name=__codelineno-15-2></a>  --cacert ~/.minikube/ca.crt  <span class=se>\</span>
<a href=#__codelineno-15-3 id=__codelineno-15-3 name=__codelineno-15-3></a>  --header <span class=s2>"Authorization: Bearer </span><span class=nv>$JWT_TOKEN_DEFAULT_DEFAULT</span><span class=s2>"</span>
<a href=#__codelineno-15-4 id=__codelineno-15-4 name=__codelineno-15-4></a>
<a href=#__codelineno-15-5 id=__codelineno-15-5 name=__codelineno-15-5></a><span class=o>{</span>
<a href=#__codelineno-15-6 id=__codelineno-15-6 name=__codelineno-15-6></a>  <span class=s2>"kind"</span>: <span class=s2>"APIResourceList"</span>,
<a href=#__codelineno-15-7 id=__codelineno-15-7 name=__codelineno-15-7></a>  <span class=s2>"apiVersion"</span>: <span class=s2>"v1"</span>,
<a href=#__codelineno-15-8 id=__codelineno-15-8 name=__codelineno-15-8></a>  <span class=s2>"groupVersion"</span>: <span class=s2>"apps/v1"</span>,
<a href=#__codelineno-15-9 id=__codelineno-15-9 name=__codelineno-15-9></a>  <span class=s2>"resources"</span>: <span class=o>[</span>...<span class=o>]</span>
<a href=#__codelineno-15-10 id=__codelineno-15-10 name=__codelineno-15-10></a><span class=o>}</span>
</code></pre></div> <p>接著讓我們嘗試在默認命名空間中列出實際的部署對象：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/namespaces/default/deployments <span class=se>\</span>
<a href=#__codelineno-16-2 id=__codelineno-16-2 name=__codelineno-16-2></a>  --cacert ~/.minikube/ca.crt  <span class=se>\</span>
<a href=#__codelineno-16-3 id=__codelineno-16-3 name=__codelineno-16-3></a>  --header <span class=s2>"Authorization: Bearer </span><span class=nv>$JWT_TOKEN_DEFAULT_DEFAULT</span><span class=s2>"</span>
<a href=#__codelineno-16-4 id=__codelineno-16-4 name=__codelineno-16-4></a>
<a href=#__codelineno-16-5 id=__codelineno-16-5 name=__codelineno-16-5></a><span class=o>{</span>
<a href=#__codelineno-16-6 id=__codelineno-16-6 name=__codelineno-16-6></a>  <span class=s2>"kind"</span>: <span class=s2>"Status"</span>,
<a href=#__codelineno-16-7 id=__codelineno-16-7 name=__codelineno-16-7></a>  <span class=s2>"apiVersion"</span>: <span class=s2>"v1"</span>,
<a href=#__codelineno-16-8 id=__codelineno-16-8 name=__codelineno-16-8></a>  <span class=s2>"metadata"</span>: <span class=o>{}</span>,
<a href=#__codelineno-16-9 id=__codelineno-16-9 name=__codelineno-16-9></a>  <span class=s2>"status"</span>: <span class=s2>"Failure"</span>,
<a href=#__codelineno-16-10 id=__codelineno-16-10 name=__codelineno-16-10></a>  <span class=s2>"message"</span>: <span class=s2>"deployments.apps is forbidden: User \"system:serviceaccount:default:default\" cannot list resource \"deployments\" in API group \"apps\" in the namespace \"default\""</span>,
<a href=#__codelineno-16-11 id=__codelineno-16-11 name=__codelineno-16-11></a>  <span class=s2>"reason"</span>: <span class=s2>"Forbidden"</span>,
<a href=#__codelineno-16-12 id=__codelineno-16-12 name=__codelineno-16-12></a>  <span class=s2>"details"</span>: <span class=o>{</span>
<a href=#__codelineno-16-13 id=__codelineno-16-13 name=__codelineno-16-13></a>    <span class=s2>"group"</span>: <span class=s2>"apps"</span>,
<a href=#__codelineno-16-14 id=__codelineno-16-14 name=__codelineno-16-14></a>    <span class=s2>"kind"</span>: <span class=s2>"deployments"</span>
<a href=#__codelineno-16-15 id=__codelineno-16-15 name=__codelineno-16-15></a>  <span class=o>}</span>,
<a href=#__codelineno-16-16 id=__codelineno-16-16 name=__codelineno-16-16></a>  <span class=s2>"code"</span>: <span class=m>403</span>
<a href=#__codelineno-16-17 id=__codelineno-16-17 name=__codelineno-16-17></a><span class=o>}</span>
</code></pre></div> <p>顯然，用戶 <code>system:serviceaccount:default:default</code> 甚至不足以在其自己的命名空間中列出 Kubernetes 對象。</p> <p>讓我們嘗試一個強大的 <code>kube-system</code> 服務帳戶：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a>$ <span class=nv>JWT_TOKEN_KUBESYSTEM_DEFAULT</span><span class=o>=</span><span class=k>$(</span>kubectl -n kube-system get secrets <span class=se>\</span>
<a href=#__codelineno-17-2 id=__codelineno-17-2 name=__codelineno-17-2></a>    <span class=k>$(</span>kubectl -n kube-system get serviceaccounts/default -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.secrets[0].name}'</span><span class=k>)</span> <span class=se>\</span>
<a href=#__codelineno-17-3 id=__codelineno-17-3 name=__codelineno-17-3></a>    -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.data.token}'</span> <span class=p>|</span> base64 --decode<span class=k>)</span>
</code></pre></div> <p>把 JWT 令牌打印出來看:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-18-1 id=__codelineno-18-1 name=__codelineno-18-1></a>$ <span class=nb>echo</span> <span class=nv>$JWT_TOKEN_KUBESYSTEM_DEFAULT</span>
<a href=#__codelineno-18-2 id=__codelineno-18-2 name=__codelineno-18-2></a>
<a href=#__codelineno-18-3 id=__codelineno-18-3 name=__codelineno-18-3></a>eyJhbGciOiJSUzI1NiIsImtpZCI6IjFVa2pVaUVUS25JSzFNT1V0RW1zTWEyT0F3MTFSaFNneUVobXk0dUhjUEUifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZWZhdWx0LXRva2VuLW16bWo3Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRlZmF1bHQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJhN2E4YTc1Mi1jNjQ5LTRkOGYtOTQzMi03MDgxYjE4YzBiNTIiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06ZGVmYXVsdCJ9.talXOCcsaH5VaZEOJo-VilVZUhM6YWrChmKScXHcTwDfVBmX6XlrelomnYMUtwahnF1aGe_vJpLzk-SJhvdLvFSAvw0pIWxsabes7ITfCdOfAMliPhiCIOC4XwawKWmbVJYcvhHppNA41qzNAbtav_e9qB6z84fmAQHQJLITMmMfe-ZC38I3sWh5ezoo-1uiV3iY6SHxd4WGXmuRBqkvWxJM7JiC2TmUU9Z6K4gfrRtfBrB2-A3Ti6v7Jcqwxakqq092X7VpstmJTHgh6KExm-0laIUSOKwUFlFvs4-MYKwmbYdz4IYDxJejZjcfC8XkTM6nQPaXdaTA6olKBzKHKg
</code></pre></div> <p><a class=glightbox href=../assets/kube-system-jwt.png><img alt src=../assets/kube-system-jwt.png></a></p> <p>其中 <code>payload</code> 的資訊如下:</p> <div class=highlight><span class=filename>payload</span><pre><span></span><code><a href=#__codelineno-19-1 id=__codelineno-19-1 name=__codelineno-19-1></a><span class=p>{</span><span class=w></span>
<a href=#__codelineno-19-2 id=__codelineno-19-2 name=__codelineno-19-2></a><span class=w>  </span><span class=nt>"iss"</span><span class=p>:</span><span class=w> </span><span class=s2>"kubernetes/serviceaccount"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-19-3 id=__codelineno-19-3 name=__codelineno-19-3></a><span class=w>  </span><span class=nt>"kubernetes.io/serviceaccount/namespace"</span><span class=p>:</span><span class=w> </span><span class=s2>"kube-system"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-19-4 id=__codelineno-19-4 name=__codelineno-19-4></a><span class=w>  </span><span class=nt>"kubernetes.io/serviceaccount/secret.name"</span><span class=p>:</span><span class=w> </span><span class=s2>"default-token-mzmj7"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-19-5 id=__codelineno-19-5 name=__codelineno-19-5></a><span class=w>  </span><span class=nt>"kubernetes.io/serviceaccount/service-account.name"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-19-6 id=__codelineno-19-6 name=__codelineno-19-6></a><span class=w>  </span><span class=nt>"kubernetes.io/serviceaccount/service-account.uid"</span><span class=p>:</span><span class=w> </span><span class=s2>"a7a8a752-c649-4d8f-9432-7081b18c0b52"</span><span class=p>,</span><span class=w></span>
<a href=#__codelineno-19-7 id=__codelineno-19-7 name=__codelineno-19-7></a><span class=w>  </span><span class=nt>"sub"</span><span class=p>:</span><span class=w> </span><span class=s2>"system:serviceaccount:kube-system:default"</span><span class=w></span>
<a href=#__codelineno-19-8 id=__codelineno-19-8 name=__codelineno-19-8></a><span class=p>}</span><span class=w></span>
</code></pre></div> <p>強大的帳戶值得一項具有挑戰性的任務 - 列出集群級資源：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-20-1 id=__codelineno-20-1 name=__codelineno-20-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/deployments <span class=se>\</span>
<a href=#__codelineno-20-2 id=__codelineno-20-2 name=__codelineno-20-2></a>  --cacert ~/.minikube/ca.crt  <span class=se>\</span>
<a href=#__codelineno-20-3 id=__codelineno-20-3 name=__codelineno-20-3></a>  --header <span class=s2>"Authorization: Bearer </span><span class=nv>$JWT_TOKEN_KUBESYSTEM_DEFAULT</span><span class=s2>"</span>
<a href=#__codelineno-20-4 id=__codelineno-20-4 name=__codelineno-20-4></a>
<a href=#__codelineno-20-5 id=__codelineno-20-5 name=__codelineno-20-5></a><span class=o>{</span>
<a href=#__codelineno-20-6 id=__codelineno-20-6 name=__codelineno-20-6></a>  <span class=s2>"kind"</span>: <span class=s2>"DeploymentList"</span>,
<a href=#__codelineno-20-7 id=__codelineno-20-7 name=__codelineno-20-7></a>  <span class=s2>"apiVersion"</span>: <span class=s2>"apps/v1"</span>,
<a href=#__codelineno-20-8 id=__codelineno-20-8 name=__codelineno-20-8></a>  <span class=s2>"metadata"</span>: <span class=o>{</span>
<a href=#__codelineno-20-9 id=__codelineno-20-9 name=__codelineno-20-9></a>    <span class=s2>"resourceVersion"</span>: <span class=s2>"656580"</span>
<a href=#__codelineno-20-10 id=__codelineno-20-10 name=__codelineno-20-10></a>  <span class=o>}</span>,
<a href=#__codelineno-20-11 id=__codelineno-20-11 name=__codelineno-20-11></a>  <span class=s2>"items"</span>: <span class=o>[</span>...<span class=o>]</span>
<a href=#__codelineno-20-12 id=__codelineno-20-12 name=__codelineno-20-12></a><span class=o>}</span>
</code></pre></div> <p>是的，符合我們的期待地完成工作👌</p> <h4 id=call-kubernetes-api-inside-a-pod>Call Kubernetes API inside a Pod<a class=headerlink href=#call-kubernetes-api-inside-a-pod title="Permanent link">¶</a></h4> <p>與任何其他 Kubernetes 服務非常相似，Kubernetes API 服務地址可通過環境變量提供給 Pod：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-21-1 id=__codelineno-21-1 name=__codelineno-21-1></a>$ kubectl run -it --image curlimages/curl --restart<span class=o>=</span>Never mypod -- sh
<a href=#__codelineno-21-2 id=__codelineno-21-2 name=__codelineno-21-2></a>
<a href=#__codelineno-21-3 id=__codelineno-21-3 name=__codelineno-21-3></a>$ env <span class=p>|</span> grep KUBERNETES
<a href=#__codelineno-21-4 id=__codelineno-21-4 name=__codelineno-21-4></a><span class=nv>KUBERNETES_SERVICE_PORT</span><span class=o>=</span><span class=m>443</span>
<a href=#__codelineno-21-5 id=__codelineno-21-5 name=__codelineno-21-5></a><span class=nv>KUBERNETES_PORT</span><span class=o>=</span>tcp://10.96.0.1:443
<a href=#__codelineno-21-6 id=__codelineno-21-6 name=__codelineno-21-6></a><span class=nv>KUBERNETES_PORT_443_TCP_ADDR</span><span class=o>=</span><span class=m>10</span>.96.0.1
<a href=#__codelineno-21-7 id=__codelineno-21-7 name=__codelineno-21-7></a><span class=nv>KUBERNETES_PORT_443_TCP_PORT</span><span class=o>=</span><span class=m>443</span>
<a href=#__codelineno-21-8 id=__codelineno-21-8 name=__codelineno-21-8></a><span class=nv>KUBERNETES_PORT_443_TCP_PROTO</span><span class=o>=</span>tcp
<a href=#__codelineno-21-9 id=__codelineno-21-9 name=__codelineno-21-9></a><span class=nv>KUBERNETES_PORT_443_TCP</span><span class=o>=</span>tcp://10.96.0.1:443
<a href=#__codelineno-21-10 id=__codelineno-21-10 name=__codelineno-21-10></a><span class=nv>KUBERNETES_SERVICE_PORT_HTTPS</span><span class=o>=</span><span class=m>443</span>
<a href=#__codelineno-21-11 id=__codelineno-21-11 name=__codelineno-21-11></a><span class=nv>KUBERNETES_SERVICE_HOST</span><span class=o>=</span><span class=m>10</span>.96.0.1
</code></pre></div> <p>Pod 通常還會在 <code>/var/run/secrets/kubernetes.io/serviceaccount/</code> 上安裝 <code>Kubernetes CA</code> 證書和<code>服務帳戶</code> credentials。因此，應用以上部分的知識，從 Pod 調用 Kubernetes API 服務器的 curl 命令可以如下所示：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-22-1 id=__codelineno-22-1 name=__codelineno-22-1></a>$ curl https://<span class=si>${</span><span class=nv>KUBERNETES_SERVICE_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>KUBERNETES_SERVICE_PORT</span><span class=si>}</span>/apis/apps/v1 <span class=se>\</span>
<a href=#__codelineno-22-2 id=__codelineno-22-2 name=__codelineno-22-2></a>  --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt <span class=se>\</span>
<a href=#__codelineno-22-3 id=__codelineno-22-3 name=__codelineno-22-3></a>  --header <span class=s2>"Authorization: Bearer </span><span class=k>$(</span>cat /var/run/secrets/kubernetes.io/serviceaccount/token<span class=k>)</span><span class=s2>"</span>
</code></pre></div> <h3 id=creat-read-watch-update-patch-and-delete-objects>Creat, Read, Watch, Update, Patch, and Delete objects<a class=headerlink href=#creat-read-watch-update-patch-and-delete-objects title="Permanent link">¶</a></h3> <p>Kubernetes API 支持對 Kubernetes 對象進行以下<a href=https://github.com/kubernetes/community/blob/7f3f3205448a8acfdff4f1ddad81364709ae9b71/contributors/devel/sig-architecture/api-conventions.md#verbs-on-resources>操作</a>：</p> <ul> <li><code>GET /&lt;resourcePlural&gt;</code> - Retrieve a list of type <resourcename>.</resourcename></li> <li><code>POST /&lt;resourcePlural&gt;</code> - Create a new resource from the JSON object provided by the client.</li> <li><code>GET /&lt;resourcePlural&gt;/&lt;name&gt;</code> - Retrieves a single resource with the given name.</li> <li><code>DELETE /&lt;resourcePlural&gt;/&lt;name&gt;</code> - Delete the single resource with the given name.</li> <li><code>DELETE /&lt;resourcePlural&gt;</code> - Deletes a list of type <resourcename>.</resourcename></li> <li><code>PUT /&lt;resourcePlural&gt;/&lt;name&gt;</code> - Update or create the resource with the given name with the JSON object provided by client.</li> <li><code>PATCH /&lt;resourcePlural&gt;/&lt;name&gt;</code> - Selectively modify the specified fields of the resource.</li> <li><code>GET /&lt;resourcePlural&gt;?watch=true</code> - Receive a stream of JSON objects corresponding to changes made to any resource of the given kind over time.</li> </ul> <p>API 是 RESTful 的型式，因此上述 HTTP 方法在資源操作上的映射應該看起來很熟悉。</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>即使文檔僅提及 JSON 對象，如果 Content-Type 標頭設置為 <code>application/yaml</code>，則支持提交 YAML 有效負載。</p> </div> <p><strong>CREATE</strong></p> <p>以下是使用 curl 和 YAML 清單創建新對象的方法：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-23-1 id=__codelineno-23-1 name=__codelineno-23-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/namespaces/default/deployments <span class=se>\</span>
<a href=#__codelineno-23-2 id=__codelineno-23-2 name=__codelineno-23-2></a>  --cacert ~/.minikube/ca.crt <span class=se>\</span>
<a href=#__codelineno-23-3 id=__codelineno-23-3 name=__codelineno-23-3></a>  --cert ~/.minikube/profiles/minikube/client.crt <span class=se>\</span>
<a href=#__codelineno-23-4 id=__codelineno-23-4 name=__codelineno-23-4></a>  --key ~/.minikube/profiles/minikube/client.key <span class=se>\</span>
<a href=#__codelineno-23-5 id=__codelineno-23-5 name=__codelineno-23-5></a>  -X POST <span class=se>\</span>
<a href=#__codelineno-23-6 id=__codelineno-23-6 name=__codelineno-23-6></a>  -H <span class=s1>'Content-Type: application/yaml'</span> <span class=se>\</span>
<a href=#__codelineno-23-7 id=__codelineno-23-7 name=__codelineno-23-7></a>  -d <span class=s1>'---</span>
<a href=#__codelineno-23-8 id=__codelineno-23-8 name=__codelineno-23-8></a><span class=s1>apiVersion: apps/v1</span>
<a href=#__codelineno-23-9 id=__codelineno-23-9 name=__codelineno-23-9></a><span class=s1>kind: Deployment</span>
<a href=#__codelineno-23-10 id=__codelineno-23-10 name=__codelineno-23-10></a><span class=s1>metadata:</span>
<a href=#__codelineno-23-11 id=__codelineno-23-11 name=__codelineno-23-11></a><span class=s1>  name: sleep</span>
<a href=#__codelineno-23-12 id=__codelineno-23-12 name=__codelineno-23-12></a><span class=s1>spec:</span>
<a href=#__codelineno-23-13 id=__codelineno-23-13 name=__codelineno-23-13></a><span class=s1>  replicas: 1</span>
<a href=#__codelineno-23-14 id=__codelineno-23-14 name=__codelineno-23-14></a><span class=s1>  selector:</span>
<a href=#__codelineno-23-15 id=__codelineno-23-15 name=__codelineno-23-15></a><span class=s1>    matchLabels:</span>
<a href=#__codelineno-23-16 id=__codelineno-23-16 name=__codelineno-23-16></a><span class=s1>      app: sleep</span>
<a href=#__codelineno-23-17 id=__codelineno-23-17 name=__codelineno-23-17></a><span class=s1>  template:</span>
<a href=#__codelineno-23-18 id=__codelineno-23-18 name=__codelineno-23-18></a><span class=s1>    metadata:</span>
<a href=#__codelineno-23-19 id=__codelineno-23-19 name=__codelineno-23-19></a><span class=s1>      labels:</span>
<a href=#__codelineno-23-20 id=__codelineno-23-20 name=__codelineno-23-20></a><span class=s1>        app: sleep</span>
<a href=#__codelineno-23-21 id=__codelineno-23-21 name=__codelineno-23-21></a><span class=s1>    spec:</span>
<a href=#__codelineno-23-22 id=__codelineno-23-22 name=__codelineno-23-22></a><span class=s1>      containers:</span>
<a href=#__codelineno-23-23 id=__codelineno-23-23 name=__codelineno-23-23></a><span class=s1>      - name: sleep</span>
<a href=#__codelineno-23-24 id=__codelineno-23-24 name=__codelineno-23-24></a><span class=s1>        image: curlimages/curl</span>
<a href=#__codelineno-23-25 id=__codelineno-23-25 name=__codelineno-23-25></a><span class=s1>        command: ["/bin/sleep", "365d"]</span>
<a href=#__codelineno-23-26 id=__codelineno-23-26 name=__codelineno-23-26></a><span class=s1>'</span>
</code></pre></div> <p><strong>READ</strong></p> <p>以下是如何獲取默認命名空間中的所有對象：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-24-1 id=__codelineno-24-1 name=__codelineno-24-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/namespaces/default/deployments <span class=se>\</span>
<a href=#__codelineno-24-2 id=__codelineno-24-2 name=__codelineno-24-2></a>  --cacert ~/.minikube/ca.crt <span class=se>\</span>
<a href=#__codelineno-24-3 id=__codelineno-24-3 name=__codelineno-24-3></a>  --cert ~/.minikube/profiles/minikube/client.crt <span class=se>\</span>
<a href=#__codelineno-24-4 id=__codelineno-24-4 name=__codelineno-24-4></a>  --key ~/.minikube/profiles/minikube/client.key
</code></pre></div> <p>以及如何通過名稱和命名空間獲取對象：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-25-1 id=__codelineno-25-1 name=__codelineno-25-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/namespaces/default/deployments/sleep <span class=se>\</span>
<a href=#__codelineno-25-2 id=__codelineno-25-2 name=__codelineno-25-2></a>  --cacert ~/.minikube/ca.crt <span class=se>\</span>
<a href=#__codelineno-25-3 id=__codelineno-25-3 name=__codelineno-25-3></a>  --cert ~/.minikube/profiles/minikube/client.crt <span class=se>\</span>
<a href=#__codelineno-25-4 id=__codelineno-25-4 name=__codelineno-25-4></a>  --key ~/.minikube/profiles/minikube/client.key
</code></pre></div> <p>一種更高級的檢索 Kubernetes 資源的方法是持續觀察它們的變化：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-26-1 id=__codelineno-26-1 name=__codelineno-26-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/namespaces/default/deployments?watch<span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
<a href=#__codelineno-26-2 id=__codelineno-26-2 name=__codelineno-26-2></a>  --cacert ~/.minikube/ca.crt <span class=se>\</span>
<a href=#__codelineno-26-3 id=__codelineno-26-3 name=__codelineno-26-3></a>  --cert ~/.minikube/profiles/minikube/client.crt <span class=se>\</span>
<a href=#__codelineno-26-4 id=__codelineno-26-4 name=__codelineno-26-4></a>  --key ~/.minikube/profiles/minikube/client.key
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>請注意，只能監視一組資源。但是，您可以通過提供標籤或字段選擇器將結果集縮小到單個資源。</p> </div> <p><strong>UPDATE</strong></p> <p>以下是更新現有對象的方法：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-27-1 id=__codelineno-27-1 name=__codelineno-27-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/namespaces/default/deployments/sleep <span class=se>\</span>
<a href=#__codelineno-27-2 id=__codelineno-27-2 name=__codelineno-27-2></a>  --cacert ~/.minikube/ca.crt <span class=se>\</span>
<a href=#__codelineno-27-3 id=__codelineno-27-3 name=__codelineno-27-3></a>  --cert ~/.minikube/profiles/minikube/client.crt <span class=se>\</span>
<a href=#__codelineno-27-4 id=__codelineno-27-4 name=__codelineno-27-4></a>  --key ~/.minikube/profiles/minikube/client.key <span class=se>\</span>
<a href=#__codelineno-27-5 id=__codelineno-27-5 name=__codelineno-27-5></a>  -X PUT <span class=se>\</span>
<a href=#__codelineno-27-6 id=__codelineno-27-6 name=__codelineno-27-6></a>  -H <span class=s1>'Content-Type: application/yaml'</span> <span class=se>\</span>
<a href=#__codelineno-27-7 id=__codelineno-27-7 name=__codelineno-27-7></a>  -d <span class=s1>'---</span>
<a href=#__codelineno-27-8 id=__codelineno-27-8 name=__codelineno-27-8></a><span class=s1>apiVersion: apps/v1</span>
<a href=#__codelineno-27-9 id=__codelineno-27-9 name=__codelineno-27-9></a><span class=s1>kind: Deployment</span>
<a href=#__codelineno-27-10 id=__codelineno-27-10 name=__codelineno-27-10></a><span class=s1>metadata:</span>
<a href=#__codelineno-27-11 id=__codelineno-27-11 name=__codelineno-27-11></a><span class=s1>  name: sleep</span>
<a href=#__codelineno-27-12 id=__codelineno-27-12 name=__codelineno-27-12></a><span class=s1>spec:</span>
<a href=#__codelineno-27-13 id=__codelineno-27-13 name=__codelineno-27-13></a><span class=s1>  replicas: 1</span>
<a href=#__codelineno-27-14 id=__codelineno-27-14 name=__codelineno-27-14></a><span class=s1>  selector:</span>
<a href=#__codelineno-27-15 id=__codelineno-27-15 name=__codelineno-27-15></a><span class=s1>    matchLabels:</span>
<a href=#__codelineno-27-16 id=__codelineno-27-16 name=__codelineno-27-16></a><span class=s1>      app: sleep</span>
<a href=#__codelineno-27-17 id=__codelineno-27-17 name=__codelineno-27-17></a><span class=s1>  template:</span>
<a href=#__codelineno-27-18 id=__codelineno-27-18 name=__codelineno-27-18></a><span class=s1>    metadata:</span>
<a href=#__codelineno-27-19 id=__codelineno-27-19 name=__codelineno-27-19></a><span class=s1>      labels:</span>
<a href=#__codelineno-27-20 id=__codelineno-27-20 name=__codelineno-27-20></a><span class=s1>        app: sleep</span>
<a href=#__codelineno-27-21 id=__codelineno-27-21 name=__codelineno-27-21></a><span class=s1>    spec:</span>
<a href=#__codelineno-27-22 id=__codelineno-27-22 name=__codelineno-27-22></a><span class=s1>      containers:</span>
<a href=#__codelineno-27-23 id=__codelineno-27-23 name=__codelineno-27-23></a><span class=s1>      - name: sleep</span>
<a href=#__codelineno-27-24 id=__codelineno-27-24 name=__codelineno-27-24></a><span class=s1>        image: curlimages/curl</span>
<a href=#__codelineno-27-25 id=__codelineno-27-25 name=__codelineno-27-25></a><span class=s1>        command: ["/bin/sleep", "730d"]  # &lt;-- Making it sleep twice longer</span>
<a href=#__codelineno-27-26 id=__codelineno-27-26 name=__codelineno-27-26></a><span class=s1>'</span>
</code></pre></div> <p>以下是如何修補現有對象：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-28-1 id=__codelineno-28-1 name=__codelineno-28-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/namespaces/default/deployments/sleep <span class=se>\</span>
<a href=#__codelineno-28-2 id=__codelineno-28-2 name=__codelineno-28-2></a>  --cacert ~/.minikube/ca.crt <span class=se>\</span>
<a href=#__codelineno-28-3 id=__codelineno-28-3 name=__codelineno-28-3></a>  --cert ~/.minikube/profiles/minikube/client.crt <span class=se>\</span>
<a href=#__codelineno-28-4 id=__codelineno-28-4 name=__codelineno-28-4></a>  --key ~/.minikube/profiles/minikube/client.key <span class=se>\</span>
<a href=#__codelineno-28-5 id=__codelineno-28-5 name=__codelineno-28-5></a>  -X PATCH <span class=se>\</span>
<a href=#__codelineno-28-6 id=__codelineno-28-6 name=__codelineno-28-6></a>  -H <span class=s1>'Content-Type: application/merge-patch+json'</span> <span class=se>\</span>
<a href=#__codelineno-28-7 id=__codelineno-28-7 name=__codelineno-28-7></a>  -d <span class=s1>'{</span>
<a href=#__codelineno-28-8 id=__codelineno-28-8 name=__codelineno-28-8></a><span class=s1>  "spec": {</span>
<a href=#__codelineno-28-9 id=__codelineno-28-9 name=__codelineno-28-9></a><span class=s1>    "template": {</span>
<a href=#__codelineno-28-10 id=__codelineno-28-10 name=__codelineno-28-10></a><span class=s1>      "spec": {</span>
<a href=#__codelineno-28-11 id=__codelineno-28-11 name=__codelineno-28-11></a><span class=s1>        "containers": [</span>
<a href=#__codelineno-28-12 id=__codelineno-28-12 name=__codelineno-28-12></a><span class=s1>          {</span>
<a href=#__codelineno-28-13 id=__codelineno-28-13 name=__codelineno-28-13></a><span class=s1>            "name": "sleep",</span>
<a href=#__codelineno-28-14 id=__codelineno-28-14 name=__codelineno-28-14></a><span class=s1>            "image": "curlimages/curl",</span>
<a href=#__codelineno-28-15 id=__codelineno-28-15 name=__codelineno-28-15></a><span class=s1>            "command": ["/bin/sleep", "1d"]</span>
<a href=#__codelineno-28-16 id=__codelineno-28-16 name=__codelineno-28-16></a><span class=s1>          }</span>
<a href=#__codelineno-28-17 id=__codelineno-28-17 name=__codelineno-28-17></a><span class=s1>        ]</span>
<a href=#__codelineno-28-18 id=__codelineno-28-18 name=__codelineno-28-18></a><span class=s1>      }</span>
<a href=#__codelineno-28-19 id=__codelineno-28-19 name=__codelineno-28-19></a><span class=s1>    }</span>
<a href=#__codelineno-28-20 id=__codelineno-28-20 name=__codelineno-28-20></a><span class=s1>  }</span>
<a href=#__codelineno-28-21 id=__codelineno-28-21 name=__codelineno-28-21></a><span class=s1>}'</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>請注意 UPDATE 和 PATCH 是相當棘手的操作。第一個受到各種版本衝突的影響，第二個的行為因使用的補丁策略而異。</p> </div> <p><strong>DELETE</strong></p> <p>最後但同樣重要的是 - 以下是如何刪除對象集合：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-29-1 id=__codelineno-29-1 name=__codelineno-29-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/namespaces/default/deployments <span class=se>\</span>
<a href=#__codelineno-29-2 id=__codelineno-29-2 name=__codelineno-29-2></a>  --cacert ~/.minikube/ca.crt <span class=se>\</span>
<a href=#__codelineno-29-3 id=__codelineno-29-3 name=__codelineno-29-3></a>  --cert ~/.minikube/profiles/minikube/client.crt <span class=se>\</span>
<a href=#__codelineno-29-4 id=__codelineno-29-4 name=__codelineno-29-4></a>  --key ~/.minikube/profiles/minikube/client.key <span class=se>\</span>
<a href=#__codelineno-29-5 id=__codelineno-29-5 name=__codelineno-29-5></a>  -X DELETE
</code></pre></div> <p>以下是如何刪除單個對象：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-30-1 id=__codelineno-30-1 name=__codelineno-30-1></a>$ curl <span class=nv>$KUBE_API</span>/apis/apps/v1/namespaces/default/deployments/sleep <span class=se>\</span>
<a href=#__codelineno-30-2 id=__codelineno-30-2 name=__codelineno-30-2></a>  --cacert ~/.minikube/ca.crt <span class=se>\</span>
<a href=#__codelineno-30-3 id=__codelineno-30-3 name=__codelineno-30-3></a>  --cert ~/.minikube/profiles/minikube/client.crt <span class=se>\</span>
<a href=#__codelineno-30-4 id=__codelineno-30-4 name=__codelineno-30-4></a>  --key ~/.minikube/profiles/minikube/client.key <span class=se>\</span>
<a href=#__codelineno-30-5 id=__codelineno-30-5 name=__codelineno-30-5></a>  -X DELETE
</code></pre></div> <h2 id=how-to-call-kubernetes-api-using-kubectl>How to call Kubernetes API using kubectl<a class=headerlink href=#how-to-call-kubernetes-api-using-kubectl title="Permanent link">¶</a></h2> <p>上面使用證書和令牌來呼叫 Kubernetes API 很有趣。至少經歷一次是一個很好的練習，可以鞏固對客戶端和服務器移動部件的理解。但是，當你有一個可以使用的 <code>kubectl</code> 時，每天都這樣做可能會有點矯枉過正。</p> <h3 id=calling-kubernetes-api-using-kubectl-proxy>Calling Kubernetes API using kubectl proxy<a class=headerlink href=#calling-kubernetes-api-using-kubectl-proxy title="Permanent link">¶</a></h3> <p>使用正確配置的 <code>kubectl</code> 工具，您可以使用 <code>kubectl proxy</code> 命令大大簡化 API 訪問。</p> <p><code>kubectl proxy</code> 命令在您的 <code>localhost</code> 和 <code>Kubernetes API 服務器</code>之間創建一個代理服務器（或應用程序級網關）。但它必須不止於此。不然怎麼會這麼方便？</p> <p>代理 kubectl 從調用者那裡卸載了相互的客戶端-服務器身份驗證責任。由於調用者和代理之間的通信發生在本地主機上，因此它被認為是安全的。並且代理本身使用 kubeconfig 文件中選擇的當前上下文中的信息來處理客戶端-服務器身份驗證。</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-31-1 id=__codelineno-31-1 name=__codelineno-31-1></a>$ kubectl config current-context
<a href=#__codelineno-31-2 id=__codelineno-31-2 name=__codelineno-31-2></a>minikube
<a href=#__codelineno-31-3 id=__codelineno-31-3 name=__codelineno-31-3></a>
<a href=#__codelineno-31-4 id=__codelineno-31-4 name=__codelineno-31-4></a>$ kubectl proxy --port<span class=o>=</span><span class=m>8080</span> <span class=p>&amp;</span>
</code></pre></div> <p>啟動代理服務器後，調用 Kubernetes API 服務器就變得簡單多了：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-32-1 id=__codelineno-32-1 name=__codelineno-32-1></a>$ curl localhost:8080/apis/apps/v1/deployments
<a href=#__codelineno-32-2 id=__codelineno-32-2 name=__codelineno-32-2></a><span class=o>{</span>
<a href=#__codelineno-32-3 id=__codelineno-32-3 name=__codelineno-32-3></a>  <span class=s2>"kind"</span>: <span class=s2>"DeploymentList"</span>,
<a href=#__codelineno-32-4 id=__codelineno-32-4 name=__codelineno-32-4></a>  <span class=s2>"apiVersion"</span>: <span class=s2>"apps/v1"</span>,
<a href=#__codelineno-32-5 id=__codelineno-32-5 name=__codelineno-32-5></a>  <span class=s2>"metadata"</span>: <span class=o>{</span>
<a href=#__codelineno-32-6 id=__codelineno-32-6 name=__codelineno-32-6></a>    <span class=s2>"resourceVersion"</span>: <span class=s2>"660883"</span>
<a href=#__codelineno-32-7 id=__codelineno-32-7 name=__codelineno-32-7></a>  <span class=o>}</span>,
<a href=#__codelineno-32-8 id=__codelineno-32-8 name=__codelineno-32-8></a>  <span class=s2>"items"</span>: <span class=o>[</span>...<span class=o>]</span>
<a href=#__codelineno-32-9 id=__codelineno-32-9 name=__codelineno-32-9></a><span class=o>}</span>
</code></pre></div> <h2 id=calling-kubernetes-api-using-kubectl-raw-mode>Calling Kubernetes API using kubectl raw mode<a class=headerlink href=#calling-kubernetes-api-using-kubectl-raw-mode title="Permanent link">¶</a></h2> <p>我最近學到的另一個很酷的技巧是一些 kubectl 命令支持的原始模式：</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-33-1 id=__codelineno-33-1 name=__codelineno-33-1></a><span class=c1># Sends HTTP GET request</span>
<a href=#__codelineno-33-2 id=__codelineno-33-2 name=__codelineno-33-2></a>$ kubectl get --raw /api/v1/namespaces/default/pods
<a href=#__codelineno-33-3 id=__codelineno-33-3 name=__codelineno-33-3></a>
<a href=#__codelineno-33-4 id=__codelineno-33-4 name=__codelineno-33-4></a><span class=c1># Sends HTTP POST request</span>
<a href=#__codelineno-33-5 id=__codelineno-33-5 name=__codelineno-33-5></a>$ kubectl create --raw /api/v1/namespaces/default/pods -f file.yaml
<a href=#__codelineno-33-6 id=__codelineno-33-6 name=__codelineno-33-6></a>
<a href=#__codelineno-33-7 id=__codelineno-33-7 name=__codelineno-33-7></a><span class=c1># Sends HTTP PUT request</span>
<a href=#__codelineno-33-8 id=__codelineno-33-8 name=__codelineno-33-8></a>$ kubectl replace --raw /api/v1/namespaces/default/pods/mypod -f file.json
<a href=#__codelineno-33-9 id=__codelineno-33-9 name=__codelineno-33-9></a>
<a href=#__codelineno-33-10 id=__codelineno-33-10 name=__codelineno-33-10></a><span class=c1># Sends HTTP DELETE request</span>
<a href=#__codelineno-33-11 id=__codelineno-33-11 name=__codelineno-33-11></a>$ kubectl delete --raw /api/v1/namespaces/default/pods
</code></pre></div> <p>kubectl 是一個非常先進的工具，即使是像 kubectl 這樣的簡單命令也有大量代碼。但是，當使用 --raw 標誌時，實現歸結為將唯一的參數轉換為 API 端點 URL 並調用原始 REST API 客戶端。</p> <h2 id=wrapping-up>Wrapping up<a class=headerlink href=#wrapping-up title="Permanent link">¶</a></h2> <p>第一次訪問 Kubernetes API 的需求可能很可怕 - 有很多新概念，如資源、API 組、種類、對象、集群、上下文、證書，哦，天哪！但是一旦你在構建塊上分解它並通過執行一些瑣碎的任務（比如找出 API 服務器地址或使用 curl 調用一堆端點）獲得一些實踐經驗，你很快就會意識到這個想法動物園並不是真的一些新的東西——它只是多年來為我們服務的眾所周知的機制的組合 — REST 架構風格、TLS 證書、JWT 令牌、對象方案等。</p> <p>所以，不要害怕並運行一些查詢！</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>迫不及待想嘗試從代碼中調用 API？在 GitHub 上查看我收集的 <a href=https://github.com/iximiuz/client-go-examples>Kubernetes 客戶端示例</a> 😉</p> </div> <h3 id=resources>Resources<a class=headerlink href=#resources title="Permanent link">¶</a></h3> <ul> <li><a href=https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/ >Kubernetes Documentation - Access Clusters Using the Kubernetes API</a></li> <li><a href=https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/ >Kubernetes Documentation - Configure Access to Multiple Clusters</a></li> <li><a href=https://kubernetes.io/docs/reference/access-authn-authz/authentication/ >Kubernetes Documentation - Authenticating</a></li> <li><a href=https://kubernetes.io/docs/concepts/security/controlling-access/ >Kubernetes Documentation - Controlling Access to the Kubernetes API</a></li> <li><a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/ >Kubernetes Documentation - Configure Service Accounts for Pods</a></li> <li><a href=https://medium.com/programming-kubernetes/building-stuff-with-the-kubernetes-api-1-cc50a3642>Building stuff with the Kubernetes API — Exploring API objects</a></li> </ul> </article> </div> </div> <a class="md-top md-icon" data-md-component=top hidden href=#> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </a> </main> <footer class=md-footer> <nav aria-label=Footer class="md-footer__inner md-grid"> <a aria-label="Previous: K8S API 基礎" class="md-footer__link md-footer__link--prev" href=../kubernetes-api-structure-and-terminology/ rel=prev> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> K8S API 基礎 </div> </div> </a> <a aria-label="Next: Kubernetes RBAC 介詔" class="md-footer__link md-footer__link--next" href=../../access-authn-authz/rbac-intro/ rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Kubernetes RBAC 介詔 </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.6c7ad80a.min.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "width": "100%", "height": "auto", "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body> </html>